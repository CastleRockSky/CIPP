(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7356],{607:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var s=a(14232);let l=s.forwardRef(function(e,t){let{title:a,titleId:l,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},r),a?s.createElement("title",{id:l},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))})},72349:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var s=a(37876),l=a(12435),r=a(22474),i=a(47737),n=a(5596),d=a(47866),o=a(70946),c=a(3034),m=a(77018),u=a(7957),x=a(88992),p=a(58105),h=a(22322),g=a(17825),A=a(84064),j=a(31540),b=a(14232),v=a(16652),f=a(37416),D=a(48504),y=a(59568),w=a(607);let F=["Received","Status","SenderAddress","RecipientAddress","Subject"],I=["Date","Event","Action","Detail"],C=()=>{let e=(0,g.t)().currentTenant,[t,a]=(0,b.useState)([]),[l,C]=(0,b.useState)(null),[T,S]=(0,b.useState)(null),[P,E]=(0,b.useState)(!1),[M,k]=(0,b.useState)([]),z=(0,x.mN)({defaultValues:{dateFilter:"relative",days:2,endDate:Math.floor(Date.now()/1e3),startDate:Math.floor(new Date().getTime()/1e3)-172800},mode:"onChange"}),N=(0,h.nN)({urlFromData:!0,queryKey:"MessageTrace",onResult:e=>{a(e)}}),_=(0,h.nN)({urlFromData:!0,queryKey:"MessageTraceDetail-".concat(l,"-").concat(T),onResult:e=>{k(e)}}),R=t=>{C(t.MessageTraceId),S(t.RecipientAddress),_.mutate({url:"/api/ListMessageTrace",data:{tenantFilter:e,id:t.MessageTraceId,recipient:t.RecipientAddress,traceDetail:!0}})},L=[{label:"View Details",noConfirm:!0,customFunction:e=>{R(e),E(!0)},icon:(0,s.jsx)(w.A,{})},{label:"View in Explorer",noConfirm:!0,link:"https://security.microsoft.com/realtimereportsv3?tid=".concat(e,"&dltarget=Explorer&dlstorage=Url&viewid=allemail&query-NetworkMessageId=[MessageTraceId]"),icon:(0,s.jsx)(w.A,{})}],V=()=>{let t=z.getValues();var a={tenantFilter:e};t.messageId?a.messageId=t.messageId:(a.fromIP=t.fromIP,a.recipient=t.recipient,a.sender=t.sender,a.status=t.status,a.toIP=t.toIP,"startEnd"===z.watch("dateFilter")?(a.startDate=t.startDate,a.endDate=t.endDate):a.days=t.days),N.mutate({url:"/api/ListMessageTrace",data:a})},O={validate:e=>!e||/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)||/^([0-9a-fA-F]{1,4}:){7}([0-9a-fA-F]{1,4}|:)$/.test(e)||"This is not a valid IP address"},q=!!z.watch("messageId");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(r.A,{spacing:2,sx:{p:3,mt:1},children:[(0,s.jsx)(A.A,{component:"accordion",title:"Message Trace Options",accordionExpanded:!0,children:(0,s.jsxs)(y.A,{container:!0,spacing:2,children:[(0,s.jsx)(y.A,{size:12,children:(0,s.jsx)(p.A,{type:"radio",row:!0,name:"dateFilter",label:"Date Filter Type",options:[{label:"Relative",value:"relative"},{label:"Start / End",value:"startEnd"}],formControl:z,disabled:q})}),"relative"===z.watch("dateFilter")&&(0,s.jsx)(y.A,{size:12,children:(0,s.jsx)(p.A,{type:"number",name:"days",label:"Number of days to search",formControl:z,disabled:q})}),"startEnd"===z.watch("dateFilter")&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"datePicker",name:"startDate",label:"Start Date",dateTimeType:"datetime",formControl:z,disabled:q})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"datePicker",name:"endDate",label:"End Date",dateTimeType:"datetime",formControl:z,disabled:q})})]}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"autoComplete",freeSolo:!0,multiple:!0,creatable:!0,name:"sender",label:"Sender",formControl:z,disabled:q})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"autoComplete",freeSolo:!0,multiple:!0,creatable:!0,name:"recipient",label:"Recipient",formControl:z,disabled:q})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"textField",name:"messageId",label:"Message ID",formControl:z})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"autoComplete",name:"status",label:"Status",options:[{label:"None",value:"None"},{label:"Getting Status",value:"GettingStatus"},{label:"Failed",value:"Failed"},{label:"Pending",value:"Pending"},{label:"Delivered",value:"Delivered"},{label:"Expanded",value:"Expanded"},{label:"Quarantined",value:"Quarantined"},{label:"Filtered As Spam",value:"FilteredAsSpam"}],multiple:!0,formControl:z,disabled:q})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"textField",name:"fromIP",label:"From IP",formControl:z,validators:O,disabled:q})}),(0,s.jsx)(y.A,{size:{xs:12,md:6},children:(0,s.jsx)(p.A,{type:"textField",name:"toIP",label:"To IP",formControl:z,validators:O,disabled:q})}),(0,s.jsxs)(y.A,{size:12,sx:{display:"flex",gap:1},children:[(0,s.jsx)(i.A,{onClick:V,variant:"contained",color:"primary",startIcon:(0,s.jsx)(v.A,{}),children:"Search"}),(0,s.jsx)(i.A,{onClick:()=>{z.reset({dateFilter:"relative",days:2,endDate:null,fromIP:"",messageId:"",recipient:[],sender:[],startDate:null,status:[],toIP:""})},variant:"outlined",startIcon:(0,s.jsx)(f.A,{}),children:"Clear"})]})]})}),(0,s.jsx)(j.x,{title:"Message Trace"+(z.watch("messageId")?" - ID: ".concat(z.watch("messageId")):"relative"===z.watch("dateFilter")?" - Last ".concat(z.watch("days")," Days"):" - ".concat(new Date(1e3*z.watch("startDate")).toLocaleDateString()," to ").concat(new Date(1e3*z.watch("endDate")).toLocaleDateString())),simpleColumns:F,data:t,isFetching:N.isPending,refreshFunction:V,actions:L})]}),(0,s.jsxs)(n.A,{open:P,onClose:()=>E(!1),maxWidth:"lg",fullWidth:!0,children:[(0,s.jsxs)(d.A,{sx:{py:2},children:["Message Trace Details",(0,s.jsx)(o.A,{"aria-label":"close",onClick:()=>E(!1),sx:{position:"absolute",right:8,top:8},children:(0,s.jsx)(D.A,{})})]}),(0,s.jsxs)(c.A,{dividers:!0,children:[_.isPending&&(0,s.jsxs)(m.A,{variant:"body1",sx:{py:4},children:[(0,s.jsx)(u.A,{size:20,color:"inherit",sx:{mr:1}})," Loading message trace details..."]}),_.isSuccess&&(0,s.jsx)(j.x,{noCard:!0,title:"Message Trace Details",simpleColumns:I,data:null!=M?M:[],refreshFunction:()=>R({MessageTraceId:l,RecipientAddress:T}),isFetching:_.isPending})]})]})]})};C.getLayout=e=>(0,s.jsx)(l.P,{children:e});let T=C},87523:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/email/tools/message-trace",function(){return a(72349)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[636,6593,8792],()=>t(87523)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6946],{11648:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(93944),n=a(37876);let i=(0,l.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11H7v-2h10z"}),"RemoveCircle")},24916:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/cipp/advanced/table-maintenance",function(){return a(38162)}])},32591:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var l=a(93944),n=a(37876);let i=(0,l.A)((0,n.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m5 11h-4v4h-2v-4H7v-2h4V7h2v4h4z"}),"AddCircle")},38162:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var l=a(37876),n=a(12435),i=a(14232),r=a(22322),s=a(5419),o=a(31540),d=a(82836),c=a(5596),m=a(47866),u=a(3034),h=a(22474),x=a(67578),p=a(21220),A=a(6003),y=a(70946),b=a(47737),j=a(78523),f=a(94810),v=a(86650),w=a(77018),g=a(46061),T=a(22430),C=a(73362),F=a(41055),z=a(65868),E=a(11648),S=a(32591),N=a(95339),P=a(79259);let k=(0,a(93944).A)([(0,l.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,l.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber");var O=a(58105),R=a(88992),D=a(79803),K=a(59568),L=a(84064),_=a(68723);let B=e=>{let{formControl:t,open:a,onClose:n,onSubmit:r,defaultValues:s}=e,o=(0,R.FH)({control:t.control,name:"fields"});(0,i.useEffect)(()=>{a&&t.reset({fields:s.fields||[]})},[a,s,t]);let d=e=>{let a=o.filter((t,a)=>a!==e);t.reset({fields:a})},f=(e,a)=>{let l=o.map((t,l)=>l===e?{...t,type:a}:t);t.reset({fields:l})};return(0,l.jsxs)(c.A,{fullWidth:!0,maxWidth:"lg",open:a,onClose:n,width:"xl",children:[(0,l.jsx)(m.A,{children:"Add/Edit Row"}),(0,l.jsx)(u.A,{children:(0,l.jsxs)(h.A,{spacing:1.5,sx:{my:2,width:"100%"},children:[Array.isArray(o)&&(null==o?void 0:o.length)>0&&(0,l.jsx)(l.Fragment,{children:o.map((e,a)=>(0,l.jsxs)(h.A,{direction:"row",spacing:.5,alignItems:"center",width:"100%",children:[(0,l.jsx)(x.A,{width:"30%",children:(0,l.jsx)(O.A,{type:"textField",name:"fields[".concat(a,"].name"),formControl:t,label:"Name"})}),(0,l.jsx)(x.A,{width:"10%",children:(0,l.jsxs)(p.A,{value:e.type,onChange:e=>f(a,e.target.value),fullWidth:!0,sx:{py:1},children:[(0,l.jsx)(A.A,{value:"textField",children:"Text"}),(0,l.jsx)(A.A,{value:"number",children:"Number"}),(0,l.jsx)(A.A,{value:"switch",children:"Boolean"})]})}),(0,l.jsx)(x.A,{width:"50%",children:(0,l.jsx)(O.A,{type:e.type,name:"fields[".concat(a,"].value"),formControl:t,label:"Value",sx:()=>"switch"===e.type?{ml:2}:"number"===e.type?{width:"100%"}:{}})}),(0,l.jsx)(y.A,{onClick:()=>d(a),children:(0,l.jsx)(E.A,{})})]},a))}),(0,l.jsx)(b.A,{onClick:()=>{t.reset({fields:[...o,{name:"",value:"",type:"textField"}]})},startIcon:(0,l.jsx)(S.A,{}),children:"Add Property"})]})}),(0,l.jsxs)(j.A,{children:[(0,l.jsx)(b.A,{variant:"outlined",onClick:n,children:"Cancel"}),(0,l.jsx)(b.A,{variant:"contained",onClick:t.handleSubmit(r),children:"Save"})]})]})},H=()=>{let e="/api/ExecAzBobbyTables",[t,a]=(0,i.useState)([]),[n,c]=(0,i.useState)(null),[m,u]=(0,i.useState)([]),p=(0,d.s)(),A=(0,d.s)(),j=(0,d.s)(),[E,S]=(0,i.useState)({}),[H,I]=(0,i.useState)({First:1e3}),W=(0,R.mN)({mode:"onChange"}),[M,q]=(0,i.useState)(!1),V=(0,R.mN)({mode:"onChange"}),G=(0,R.mN)({mode:"onChange",defaultValues:{First:1e3}}),X=(0,R.FH)({control:W.control,name:"tableFilter"}),U=(0,r.nN)({queryKey:"CippTables",onResult:e=>a(e)}),Z=(0,r.nN)({queryKey:"CippTableData",onResult:e=>{u(e)}}),J=t=>{c(t),Z.mutate({url:e,data:{FunctionName:"Get-AzDataTableEntity",TableName:t,Parameters:G.getValues()}})},Q=()=>{n&&Z.mutate({url:e,data:{FunctionName:"Get-AzDataTableEntity",TableName:n,Parameters:H}})},Y=(0,r.nN)({queryKey:"CippTableRowAction",onResult:Q}),$=()=>{U.mutate({url:e,data:{FunctionName:"Get-AzDataTable",Parameters:{}}})},ee=e=>{if(null==e||!e.Property||!((null==e?void 0:e.Property.length)>0))return[];var t=["ETag","PartitionKey","RowKey"];return null==e||e.Property.map(e=>{-1===t.indexOf(e.value)&&t.push(e.value)}),t};(0,i.useEffect)(()=>{$()},[]);let et=t.filter(e=>""===X||void 0===X||e.toLowerCase().includes(X.toLowerCase())).map(e=>({label:"".concat(e),customFunction:()=>{u([]),J(e)},noConfirm:!0})),ea=[{label:"",value:(0,l.jsxs)(h.A,{direction:"row",spacing:1,alignItems:"center",sx:{my:1},children:[(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(C.A,{})}),(0,l.jsx)(O.A,{type:"textField",name:"tableFilter",formControl:W})]})}],el=()=>{if(0===m.length)return[];let e=m[0];return Object.keys(e).filter(e=>"ETag"!==e&&"Timestamp"!==e).map(t=>{let a=e[t],l="textField";return"number"==typeof a?l="number":"boolean"==typeof a&&(l="switch"),{name:t,label:t,type:l,required:!1}})};return(0,l.jsxs)(v.A,{maxWidth:!1,sx:{mt:4,width:"100%"},children:[(0,l.jsx)(w.A,{variant:"h4",gutterBottom:!0,children:"Table Maintenance"}),(0,l.jsx)(g.A,{severity:"warning",sx:{mb:2},children:"This page allows you to view and manage data in Azure Tables. This is advanced functionality that should only be used when directed by CyberDrain support."}),(0,l.jsxs)(K.A,{sx:{flexGrow:1,display:"flex"},container:!0,spacing:2,children:[(0,l.jsx)(K.A,{size:3,children:(0,l.jsx)(s.a,{title:"Tables",propertyItems:ea,actionItems:et.sort((e,t)=>e.label.localeCompare(t.label)),isFetching:U.isPending,cardSx:{maxHeight:"calc(100vh - 170px)",overflow:"auto"},actionButton:(0,l.jsxs)(h.A,{direction:"row",spacing:1,children:[(0,l.jsx)(T.A,{title:"Add Table",children:(0,l.jsx)(y.A,{variant:"contained",color:"primary",size:"small",onClick:p.handleOpen,children:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(N.A,{})})})}),(0,l.jsx)(T.A,{title:"Refresh Tables",children:(0,l.jsx)(y.A,{variant:"contained",color:"primary",size:"small",onClick:$,children:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(P.A,{})})})})]})})}),(0,l.jsx)(K.A,{size:9,children:n&&(0,l.jsx)(x.A,{sx:{width:"100%"},children:(0,l.jsxs)(h.A,{spacing:1,children:[(0,l.jsx)(L.A,{title:"Table Filters",accordionExpanded:M,component:"accordion",CardButton:(0,l.jsx)(b.A,{variant:"contained",color:"primary",size:"small",onClick:G.handleSubmit(e=>{var t=ee(e);I({...e,Property:t}),Q(),q(!1)}),children:"Apply Filters"}),children:(0,l.jsxs)(h.A,{spacing:1,children:[(0,l.jsx)(O.A,{type:"textField",name:"Filter",formControl:G,label:"OData Filter"}),(0,l.jsx)(O.A,{type:"autoComplete",name:"Property",formControl:G,label:"Property",options:el().map(e=>({label:null==e?void 0:e.label,value:null==e?void 0:e.name}))}),(0,l.jsxs)(h.A,{direction:"row",spacing:1,children:[(0,l.jsx)(O.A,{type:"number",name:"First",formControl:G,label:"First"}),(0,l.jsx)(O.A,{type:"number",name:"Skip",formControl:G,label:"Skip"})]})]})}),(0,l.jsx)(_.v,{apiObject:Y}),(0,l.jsx)(o.x,{title:"".concat(n),data:m,refreshFunction:Q,isFetching:Z.isPending,cardButton:(0,l.jsxs)(h.A,{direction:"row",spacing:1,children:[(0,l.jsx)(b.A,{variant:"contained",color:"primary",size:"small",onClick:()=>{S({fields:el().map(e=>({name:null==e?void 0:e.name,value:"",type:null==e?void 0:e.type}))}),j.handleOpen()},startIcon:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(N.A,{})}),children:"Add Row"}),(0,l.jsx)(b.A,{variant:"contained",color:"error",size:"small",onClick:A.handleOpen,startIcon:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(F.A,{})}),children:"Delete Table"})]}),actions:[{label:"Edit",type:"POST",icon:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(z.A,{})}),customFunction:e=>{S({fields:Object.keys(e).filter(e=>"ETag"!==e&&"Timestamp"!==e).map(t=>{let a=e[t],l="textField";return"number"==typeof a?l="number":"boolean"==typeof a&&(l="switch"),{name:t,value:a,type:l}})}),j.handleOpen()},noConfirm:!0,hideBulk:!0},{label:"Delete",type:"POST",icon:(0,l.jsx)(f.A,{fontSize:"small",children:(0,l.jsx)(F.A,{})}),url:e,customFunction:t=>{var a=[];a=Array.isArray(t)?t.map(e=>({RowKey:e.RowKey,PartitionKey:e.PartitionKey,ETag:e.ETag})):{RowKey:t.RowKey,PartitionKey:t.PartitionKey,ETag:t.ETag},Y.mutate({url:e,data:{FunctionName:"Remove-AzDataTableEntity",TableName:n,Parameters:{Entity:a}}})},confirmText:"Do you want to delete the selected row(s)? This action cannot be undone.",multiPost:!0}]})]})})})]}),(0,l.jsx)(D.B,{title:"Add Table",createDialog:p,fields:[{name:"TableName",label:"Table Name",type:"textField",required:!0}],api:{url:e,confirmText:"Use this form to create a new table in Azure Tables.",type:"POST",data:{FunctionName:"New-AzDataTable"},onSuccess:()=>{$()}}}),(0,l.jsx)(D.B,{title:"Delete Table",createDialog:A,fields:[],api:{url:e,confirmText:(0,l.jsxs)(h.A,{direction:"row",spacing:1,children:[(0,l.jsx)(k,{}),(0,l.jsx)(w.A,{variant:"body1",children:"Are you sure you want to delete this table? This is a destructive action that cannot be undone."})]}),type:"POST",data:{FunctionName:"Remove-AzDataTable",TableName:n,Parameters:{}},onSuccess:()=>{c(null),u([]),$()}}}),(0,l.jsx)(B,{formControl:V,open:j.open,onClose:j.handleClose,onSubmit:t=>{let a=t.fields.reduce((e,t)=>(e[t.name]=t.value,e),{});Y.mutate({url:e,data:{FunctionName:"Add-AzDataTableEntity",TableName:n,Parameters:{Entity:a,Force:!0}},onSuccess:Q}),j.handleClose()},defaultValues:E})]})};H.getLayout=e=>(0,l.jsx)(n.P,{children:e});let I=H},41055:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var l=a(14232);let n=l.forwardRef(function(e,t){let{title:a,titleId:n,...i}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),a?l.createElement("title",{id:n},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))})},65868:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var l=a(14232);let n=l.forwardRef(function(e,t){let{title:a,titleId:n,...i}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},i),a?l.createElement("title",{id:n},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[636,6593,8792],()=>t(24916)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3717],{717:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(93944),n=a(37876);let l=(0,i.A)((0,n.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload")},27938:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>S});var i=a(37876),n=a(24933),l=a(77018),c=a(67578),s=a(22474),o=a(47737),r=a(76776),d=a(12435),u=a(36577),h=a(22322),p=a(45297),x=a(41835),v=a(717),m=a(93944);let j=(0,m.A)((0,i.jsx)("path",{d:"M2 20h20v-4H2zm2-3h2v2H4zM2 4v4h20V4zm4 3H4V5h2zm-4 7h20v-4H2zm2-3h2v2H4z"}),"Storage"),A=(0,m.A)((0,i.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),k=(0,m.A)((0,i.jsx)("path",{d:"M21 12V6c0-1.1-.9-2-2-2h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h7v-2H5V10h14v2zm-5.36 8c.43 1.45 1.77 2.5 3.36 2.5 1.93 0 3.5-1.57 3.5-3.5s-1.57-3.5-3.5-3.5c-.95 0-1.82.38-2.45 1H18V18h-4v-4h1.5v1.43c.9-.88 2.14-1.43 3.5-1.43 2.76 0 5 2.24 5 5s-2.24 5-5 5c-2.42 0-4.44-1.72-4.9-4z"}),"EventRepeat"),B=(0,m.A)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m6 11.97h-5l2.26-2.26c-.91-1.06-2.25-1.74-3.76-1.74-2.37 0-4.35 1.66-4.86 3.88l-.96-.32c.64-2.62 3-4.56 5.82-4.56 1.78 0 3.37.79 4.47 2.03L18 8.97z"}),"NextPlan"),f=(0,m.A)((0,i.jsx)("path",{d:"M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12s4.48 10 10 10 10-4.48 10-10m-10 1H8v-2h4V8l4 4-4 4z"}),"ArrowCircleRight");var g=a(1068);let y=(0,m.A)((0,i.jsx)("path",{d:"m22.69 18.37 1.14-1-1-1.73-1.45.49q-.48-.405-1.08-.63L20 14h-2l-.3 1.49q-.6.225-1.08.63l-1.45-.49-1 1.73 1.14 1c-.08.5-.08.76 0 1.26l-1.14 1 1 1.73 1.45-.49q.48.405 1.08.63L18 24h2l.3-1.49q.6-.225 1.08-.63l1.45.49 1-1.73-1.14-1c.08-.51.08-.77 0-1.27M19 21c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2M11 7v5.41l2.36 2.36 1.04-1.79-1.4-1.39V7zm10 5c0-4.97-4.03-9-9-9-2.83 0-5.35 1.32-7 3.36V4H3v6h6V8H6.26C7.53 6.19 9.63 5 12 5c3.86 0 7 3.14 7 7zm-10.14 6.91c-2.99-.49-5.35-2.9-5.78-5.91H3.06c.5 4.5 4.31 8 8.94 8h.07z"}),"ManageHistory");var b=a(6706),w=a(31540),C=a(68723);let N=()=>{var e,t,a,d,m,N,S,z,H,F,P;let R=(0,h.R_)({url:"/api/ExecListBackup",data:{NameOnly:!0},queryKey:"BackupList"}),L=(0,h.R_)({url:"/api/ListScheduledItems",data:{Name:"Automated CIPP Backup"},queryKey:"ScheduledBackup"}),E=(0,h.nN)({urlFromData:!0}),I=(0,h.nN)({urlFromData:!0}),_=(0,h.nN)({urlFromData:!0,relatedQueryKeys:["BackupList","ScheduledBackup"]}),T=(0,h.nN)({urlFromData:!0,relatedQueryKeys:["ScheduledBackup"]}),V=[{label:"Restore Backup",icon:(0,i.jsx)(x.A,{}),type:"POST",url:"/api/ExecRestoreBackup",data:{BackupName:"BackupName"},confirmText:"Are you sure you want to restore this backup?",relatedQueryKeys:["BackupList"],multiPost:!1,hideBulk:!0},{label:"Download Backup",icon:(0,i.jsx)(v.A,{}),noConfirm:!0,customFunction:e=>{I.mutate({url:"/api/ExecListBackup?BackupName=".concat(e.BackupName),data:{}},{onSuccess:t=>{var a,i;let n=null==t?void 0:null===(i=t.data)||void 0===i?void 0:null===(a=i[0])||void 0===a?void 0:a.Backup;if(!n)return;let l=new Blob([n],{type:"application/json"}),c=URL.createObjectURL(l),s=document.createElement("a");s.href=c,s.download="".concat(e.BackupName,".json"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)}})}}];return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(u.A,{title:"CIPP Backup",backButtonTitle:"Settings",infoBar:(0,i.jsx)(p.s,{isFetching:R.isFetching,data:[{icon:(0,i.jsx)(j,{}),name:"Backup Count",data:null===(e=R.data)||void 0===e?void 0:e.length},{icon:(0,i.jsx)(A,{}),name:"Last Backup",data:(null===(a=R.data)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.Timestamp)?(0,i.jsx)(b.A,{date:null===(m=R.data)||void 0===m?void 0:null===(d=m[0])||void 0===d?void 0:d.Timestamp}):"No Backups"},{icon:(0,i.jsx)(k,{}),name:"Automatic Backups",data:(null===(S=L.data)||void 0===S?void 0:null===(N=S[0])||void 0===N?void 0:N.Name)==="Automated CIPP Backup"?"Enabled":"Disabled"},{icon:(0,i.jsx)(B,{}),name:"Next Backup",data:(0,i.jsx)(e=>{let t=new Date(e.date);return isNaN(t)?"Not Scheduled":(0,i.jsx)(b.A,{date:t})},{date:null===(H=L.data)||void 0===H?void 0:null===(z=H[0])||void 0===z?void 0:z.ScheduledTime})}]}),children:(0,i.jsxs)(n.A,{children:[(0,i.jsx)(l.A,{variant:"body2",sx:{mt:3,px:3},children:"Backups are stored in the storage account associated with your CIPP instance. You can download or restore specific points in time from the list below. Enable automatic backups to have CIPP create daily backups using the scheduler."}),R.isSuccess?(0,i.jsxs)(c.A,{sx:{mt:3},children:[(0,i.jsx)(C.v,{apiObject:_}),(0,i.jsx)(C.v,{apiObject:T}),(0,i.jsx)(C.v,{apiObject:E}),(0,i.jsx)(w.x,{title:"Backup List",data:R.data,simpleColumns:["BackupName","Timestamp"],refreshFunction:()=>R.refetch(),isFetching:R.isFetching,actions:V,cardButton:(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(s.A,{spacing:2,direction:"row",children:[(0,i.jsx)(o.A,{variant:"contained",color:"primary",startIcon:(0,i.jsx)(f,{}),onClick:()=>{_.mutate({url:"/api/ExecRunBackup",data:{}})},children:"Run Backup"}),(0,i.jsxs)(o.A,{component:"label",variant:"contained",color:"primary",startIcon:(0,i.jsx)(g.A,{}),children:["Restore From File",(0,i.jsx)("input",{hidden:!0,accept:".json",type:"file",id:"backup-upload",onChange:e=>{let t=e.target.files[0],a=new FileReader;a.onload=e=>{let t=JSON.parse(e.target.result);E.mutate({url:"/api/ExecRestoreBackup",data:t},{onSuccess:()=>{e.target.value=null}})},a.readAsText(t)}})]}),L.isSuccess&&(null===(P=L.data)||void 0===P?void 0:null===(F=P[0])||void 0===F?void 0:F.Name)!=="Automated CIPP Backup"&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(o.A,{variant:"contained",color:"primary",startIcon:(0,i.jsx)(y,{}),onClick:()=>{T.mutate({url:"/api/ExecSetCIPPAutoBackup",data:{Enabled:!0}})},children:"Schedule Backups"})})]})})})]}):(0,i.jsx)(c.A,{sx:{mt:3},children:(0,i.jsxs)(s.A,{spacing:2,children:[(0,i.jsx)(r.A,{variant:"rectangular",width:"100%",height:100}),(0,i.jsx)(r.A,{variant:"rectangular",width:"100%",height:400})]})})]})})})};N.getLayout=e=>(0,i.jsx)(d.P,{children:e});let S=N},31692:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/cipp/settings/backup",function(){return a(27938)}])},36577:(e,t,a)=>{"use strict";a.d(t,{A:()=>x});var i=a(37876),n=a(89099),l=a(67578),c=a(86650),s=a(22474),o=a(47737),r=a(94810),d=a(77018),u=a(54538),h=a(42120),p=a(2303);let x=e=>{let{title:t,backButtonTitle:a="Back",children:x,cardSize:v="xl",hideTitleText:m=!1,hideBackButton:j=!1,noTenantInHead:A=!1,infoBar:k}=e,B=(0,n.useRouter)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.v,{title:t,noTenant:A}),(0,i.jsx)(l.A,{sx:{flexGrow:1,py:4},children:(0,i.jsx)(c.A,{maxWidth:v,children:(0,i.jsxs)(s.A,{spacing:2,children:[(0,i.jsxs)(s.A,{spacing:2,children:[(0,i.jsx)("div",{children:!j&&(0,i.jsx)(o.A,{color:"inherit",onClick:()=>{B.back()},startIcon:(0,i.jsx)(r.A,{fontSize:"small",children:(0,i.jsx)(h.A,{})}),children:a})}),!0!==m&&(0,i.jsx)("div",{children:(0,i.jsx)(d.A,{variant:"h4",children:t})})]}),k,(0,i.jsx)(u.A,{children:x})]})})})]})}},41835:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(93944),n=a(37876);let l=(0,i.A)((0,n.jsx)("path",{d:"M14 12c0-1.1-.9-2-2-2s-2 .9-2 2 .9 2 2 2 2-.9 2-2m-2-9c-4.97 0-9 4.03-9 9H0l4 4 4-4H5c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.51 0-2.91-.49-4.06-1.3l-1.42 1.44C8.04 20.3 9.94 21 12 21c4.97 0 9-4.03 9-9s-4.03-9-9-9"}),"SettingsBackupRestore")},42120:(e,t,a)=>{"use strict";a.d(t,{A:()=>l});var i=a(93944),n=a(37876);let l=(0,i.A)((0,n.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")},45297:(e,t,a)=>{"use strict";a.d(t,{s:()=>v});var i=a(37876),n=a(14232),l=a(54538),c=a(22474),s=a(94810),o=a(22430),r=a(67578),d=a(77018),u=a(76776),h=a(59568),p=a(57016),x=a(5419);let v=e=>{let{data:t,isFetching:a}=e,[v,m]=(0,n.useState)(null);return(0,i.jsx)(l.A,{children:(0,i.jsx)(h.A,{container:!0,children:t.map((e,t)=>{var n,l,j,A,k;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.A,{size:{md:3,sm:6,xs:12},onClick:e.offcanvas?()=>m(t):void 0,sx:{cursor:e.offcanvas?"pointer":"default",borderBottom:e=>({xs:"1px solid ".concat(e.palette.divider),md:"none"}),borderRight:e=>({md:"1px solid ".concat(e.palette.divider)}),"&:nth-of-type(3)":{borderBottom:e=>({xs:"1px solid ".concat(e.palette.divider),sm:"none"})},"&:nth-of-type(4)":{borderBottom:"none",borderRight:"none"}},children:(0,i.jsxs)(c.A,{alignItems:"center",direction:"row",spacing:2,sx:{p:2},children:[(null==e?void 0:e.icon)&&(0,i.jsx)(s.A,{color:e.color?e.color:"primary",fontSize:"small",children:e.icon}),(null==e?void 0:e.toolTip)?(0,i.jsx)(o.A,{title:e.toolTip,children:(0,i.jsxs)(r.A,{sx:()=>{if(!(null==e?void 0:e.icon))return{pl:2}},children:[(0,i.jsx)(d.A,{color:"text.secondary",variant:"overline",children:e.name}),(0,i.jsx)(d.A,{variant:"h6",children:a?(0,i.jsx)(u.A,{width:"100%"}):e.data})]})}):(0,i.jsxs)(r.A,{sx:()=>{if(!(null==e?void 0:e.icon))return{pl:2}},children:[(0,i.jsx)(d.A,{color:"text.secondary",variant:"overline",children:e.name}),(0,i.jsx)(d.A,{variant:"h6",children:a?(0,i.jsx)(u.A,{width:"100%"}):e.data})]})]})},e.name),e.offcanvas&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(p.w,{title:(null==e?void 0:null===(n=e.offcanvas)||void 0===n?void 0:n.title)||"Details",size:"md",visible:v===t,onClose:()=>m(null),children:(0,i.jsx)(r.A,{sx:{overflowY:"auto",maxHeight:"100%",display:"flex",flexDirection:"column"},children:(0,i.jsx)(h.A,{container:!0,spacing:1,children:(0,i.jsx)(h.A,{size:{xs:12},children:(null==e?void 0:null===(j=e.offcanvas)||void 0===j?void 0:null===(l=j.propertyItems)||void 0===l?void 0:l.length)>0&&(0,i.jsx)(x.a,{isFetching:a,align:"vertical",title:null==e?void 0:null===(A=e.offcanvas)||void 0===A?void 0:A.title,propertyItems:null!==(k=e.offcanvas.propertyItems)&&void 0!==k?k:[]})})})})})})]})})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,6593,8792],()=>t(31692)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3784],{14305:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/identity/administration/users/user",function(){return i(29668)}])},29668:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>q});var a=i(37876),o=i(12435),s=i(17825),n=i(89099),l=i(22322),r=i(86508),d=i(49259),c=i(86795),u=i(34124),p=i(34295),v=i(15692);let x=(0,i(93944).A)((0,a.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"Group");var m=i(46950),g=i(50387),h=i(81699),b=i(84177),A=i(89037),y=i(82179),L=i(59568),f=i(16221),j=i(94810),C=i(77018),D=i(15698),T=i(43225),w=i(14232),N=i(44344),S=i(22875),E=i(65868),I=i(31540),B=i(18847),F=i.n(B),k=i(5596),M=i(47866),P=i(70946),U=i(3034),_=i(47737),G=i(48504),R=i(33862),O=i(24921);let z=F()(()=>Promise.all([i.e(789),i.e(1805),i.e(8402),i.e(5389)]).then(i.bind(i,35389)),{loadableGenerated:{webpack:()=>[35389]},ssr:!1}),V=e=>{let{open:t,onClose:i,userId:o,tenantFilter:s}=e;return(0,a.jsxs)(k.A,{open:t,onClose:i,maxWidth:"lg",fullWidth:!0,children:[(0,a.jsxs)(M.A,{sx:{py:2},children:["Sign-In Logs",(0,a.jsx)(P.A,{"aria-label":"close",onClick:i,sx:{position:"absolute",right:8,top:8},children:(0,a.jsx)(G.A,{})})]}),(0,a.jsx)(U.A,{dividers:!0,children:(0,a.jsx)(I.x,{noCard:!0,title:"Sign-In Logs",simpleColumns:["createdDateTime","status","ipAddress","clientAppUsed","resourceDisplayName","status.errorCode","location"],api:{url:"/api/ListUserSigninLogs",data:{UserId:o,tenantFilter:s,top:50},queryKey:"ListSignIns-".concat(o)}})})]})},H=()=>{var e,t,i,o,I,B,F,k,M,P,U,G,H,q,W,$,J,K,X,Z,Q,Y,ee,et,ei,ea,eo;let es=(0,s.t)(),en=(0,n.useRouter)(),{userId:el}=en.query,[er,ed]=(0,w.useState)(!1),[ec,eu]=(0,w.useState)(!1);(0,w.useEffect)(()=>{el&&ed(!0)},[el]);let ep=(0,l.R_)({url:"/api/ListUsers?UserId=".concat(el,"&tenantFilter=").concat(null!==(q=en.query.tenantFilter)&&void 0!==q?q:es.currentTenant),queryKey:"ListUsers-".concat(el),waiting:er}),ev=(0,l.nN)({urlFromData:!0});(0,w.useEffect)(()=>{el&&es.currentTenant&&!ev.isSuccess&&ev.mutate({url:"/api/ListGraphBulkRequest",data:{Requests:[{id:"userMemberOf",url:"/users/".concat(el,"/memberOf"),method:"GET"},{id:"mfaDevices",url:"/users/".concat(el,"/authentication/methods?$top=99"),method:"GET"},{id:"signInLogs",url:"/auditLogs/signIns?$filter=(userId eq '".concat(el,"')&$top=1"),method:"GET"}],tenantFilter:es.currentTenant,noPaginateIds:["signInLogs"]}})},[el,es.currentTenant,ev.isSuccess]);let ex=null!==(W=null==ev?void 0:null===(e=ev.data)||void 0===e?void 0:e.data)&&void 0!==W?W:[],em=null==ex?void 0:ex.find(e=>"signInLogs"===e.id),eg=null==ex?void 0:ex.find(e=>"userMemberOf"===e.id),eh=null==ex?void 0:ex.find(e=>"mfaDevices"===e.id),eb=(null==em?void 0:null===(t=em.body)||void 0===t?void 0:t.value)||[],eA=(null==eg?void 0:null===(i=eg.body)||void 0===i?void 0:i.value)||[],ey=(null==eh?void 0:null===(o=eh.body)||void 0===o?void 0:o.value)||[],eL=ep.isSuccess?(0,a.jsx)(a.Fragment,{children:null===(B=ep.data)||void 0===B?void 0:null===(I=B[0])||void 0===I?void 0:I.displayName}):"Loading...",ef=ep.isSuccess?[{icon:(0,a.jsx)(c.A,{}),text:(0,a.jsx)(b.R,{type:"chip",text:null===(k=ep.data)||void 0===k?void 0:null===(F=k[0])||void 0===F?void 0:F.userPrincipalName})},{icon:(0,a.jsx)(u.A,{}),text:(0,a.jsx)(b.R,{type:"chip",text:null===(P=ep.data)||void 0===P?void 0:null===(M=P[0])||void 0===M?void 0:M.id})},{icon:(0,a.jsx)(d.A,{}),text:(0,a.jsxs)(a.Fragment,{children:["Created: ",(0,a.jsx)(T.z,{data:null===(G=ep.data)||void 0===G?void 0:null===(U=G[0])||void 0===U?void 0:U.createdDateTime})]})},{icon:(0,a.jsx)(p.A,{style:{color:"#667085"}}),text:(0,a.jsx)(_.A,{color:"muted",style:{paddingLeft:0},size:"small",href:"https://entra.microsoft.com/".concat(es.currentTenant,"/#view/Microsoft_AAD_UsersAndTenants/UserProfileMenuBlade/~/overview/userId/").concat(el),target:"_blank",rel:"noopener noreferrer",children:"View in Entra"})}]:[],ej=null===(H=ep.data)||void 0===H?void 0:H[0],eC=null,eD=[],eT=[];if(eb.length>0){let e=eb[0];if(eC={id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"Login ".concat(0===e.status.errorCode?"successful":"failed"," from ").concat(e.ipAddress||"unknown location"),subtext:"Logged into application ".concat(e.resourceDisplayName||"Unknown Application"),statusColor:0===e.status.errorCode?"success.main":"error.main",statusText:0===e.status.errorCode?"Success":"Failed",actionButton:(0,a.jsx)(_.A,{variant:"contained",size:"small",onClick:()=>eu(!0),startIcon:(0,a.jsx)(j.A,{fontSize:"small",children:(0,a.jsx)(S.A,{})}),children:"More Sign-In Logs"}),propertyItems:[{label:"Client App Used",value:e.clientAppUsed||"N/A"},{label:"Device Detail",value:(null===($=e.deviceDetail)||void 0===$?void 0:$.operatingSystem)||(null===(J=e.deviceDetail)||void 0===J?void 0:J.browser)||"N/A"},{label:"MFA Type used",value:(null===(K=e.mfaDetail)||void 0===K?void 0:K.authMethod)||"N/A"},{label:"Additional Details",value:(null===(X=e.status)||void 0===X?void 0:X.additionalDetails)||"N/A"}],children:(0,a.jsx)(a.Fragment,{children:(null==e?void 0:e.location)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.A,{variant:"h6",children:"Location"}),(0,a.jsxs)(L.A,{container:!0,spacing:2,children:[(0,a.jsx)(L.A,{size:8,children:(0,a.jsx)(z,{markers:[{position:[e.location.geoCoordinates.latitude,e.location.geoCoordinates.longitude],popup:"".concat(e.location.city,", ").concat(e.location.state,", ").concat(e.location.countryOrRegion)}]})}),(0,a.jsx)(L.A,{size:4,children:(0,a.jsx)(R.E,{propertyItems:[{label:"City",value:e.location.city},{label:"State",value:e.location.state},{label:"Country/Region",value:e.location.countryOrRegion}]})})]})]})})},e.appliedConditionalAccessPolicies&&Array.isArray(e.appliedConditionalAccessPolicies)){let t=e.appliedConditionalAccessPolicies.filter(e=>"success"===e.result);eD=t.length>0?t.map(t=>({id:t.id,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:t.displayName,subtext:"Policy applied: ".concat(t.result),statusColor:"success.main",statusText:"Applied",propertyItems:[{label:"Grant Controls",value:t.enforcedGrantControls.length>0?t.enforcedGrantControls.join(", "):"None"},{label:"Session Controls",value:t.enforcedSessionControls.length>0?t.enforcedSessionControls.join(", "):"None"},{label:"Conditions Satisfied",value:t.conditionsSatisfied||"N/A"}]})):[{id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"No conditional access policies applied",subtext:"No conditional access policies were applied during this sign-in.",statusColor:"warning.main",statusText:"No Policies Applied",propertyItems:[]}]}else eD=[{id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"No conditional access policies available",subtext:"No conditional access policies data is available for this sign-in.",statusColor:"warning.main",statusText:"No Data",propertyItems:[]}]}else(null==em?void 0:em.status)!==200?(eC={id:1,cardLabelBox:"!",text:"Error loading sign-in logs. Do you have a P1 license?",subtext:(null==em?void 0:null===(Z=em.error)||void 0===Z?void 0:Z.message)||"Unknown error",statusColor:"error.main",statusText:"Error",propertyItems:[]},eD=[{id:1,cardLabelBox:"!",text:"Error loading conditional access policies. Do you have a P1 license?",subtext:(null==em?void 0:null===(Q=em.error)||void 0===Q?void 0:Q.message)||"Unknown error",statusColor:"error.main",statusText:"Error",propertyItems:[]}]):0===eb.length&&(eC={id:1,cardLabelBox:"-",text:"No sign-in logs available",subtext:"There are no sign-in logs for this user, or you do not have a P1 license to detect this data.",statusColor:"warning.main",statusText:"No Data",propertyItems:[{label:"Error",value:(null==em?void 0:null===(Y=em.error)||void 0===Y?void 0:Y.message)||"Unknown error"},{label:"Inner Error",value:(0,a.jsx)(O.x,{language:"json",code:JSON.stringify(null==em?void 0:null===(ee=em.error)||void 0===ee?void 0:ee.innerError,null,2)||"Unknown error"})}]},eD=[{id:1,cardLabelBox:"-",text:"No conditional access policies available",subtext:"There are no conditional access policies for this user, or you do not have a P1 license to detect this data.",statusColor:"warning.main",statusText:"No Data",propertyItems:[]}]);if(ey.length>0){let e=ey.filter(e=>"#microsoft.graph.passwordAuthenticationMethod"!==e["@odata.type"]);eT=e.length>0?e.map((e,t)=>{var i;return{id:t,cardLabelBox:{cardLabelBoxHeader:(0,a.jsx)(v.A,{})},text:e.displayName||"MFA Device",subtext:e.deviceTag||e.clientAppName||"Unknown device",statusColor:"success.main",statusText:"Enabled",propertyItems:[{label:"Device Name",value:e.displayName||"N/A"},{label:"App Version",value:e.phoneAppVersion||"N/A"},{label:"Created Date",value:e.createdDateTime?new Date(e.createdDateTime).toLocaleString():"N/A"},{label:"Authentication Method",value:(null===(i=e["@odata.type"])||void 0===i?void 0:i.split(".").pop())||"N/A"}]}}):[{id:1,cardLabelBox:"-",text:"No MFA devices available",subtext:"The user does not have any MFA devices registered.",statusColor:"warning.main",statusText:"No Devices",propertyItems:[]}]}else(null==eh?void 0:eh.status)!==200?eT=[{id:1,cardLabelBox:"!",text:"Error loading MFA devices",subtext:"Status code: ".concat(null==eh?void 0:eh.status),statusColor:"error.main",statusText:"Error",propertyItems:[{label:"Error",value:(null==eh?void 0:null===(ei=eh.body)||void 0===ei?void 0:null===(et=ei.error)||void 0===et?void 0:et.message)||"Unknown Error"},{label:"Inner Error",value:(0,a.jsx)(O.x,{language:"json",code:JSON.stringify(null==eh?void 0:null===(eo=eh.body)||void 0===eo?void 0:null===(ea=eo.error)||void 0===ea?void 0:ea.innerError,null,2)||"Unknown Error"})}]}]:0===ey.length&&(eT=[{id:1,cardLabelBox:"-",text:"No MFA devices available",subtext:"The user does not have any MFA devices registered.",statusColor:"warning.main",statusText:"No Devices",propertyItems:[]}]);let ew=eA?[{id:1,cardLabelBox:{cardLabelBoxHeader:(0,a.jsx)(x,{})},text:"Groups",subtext:"List of groups the user is a member of",table:{title:"Group Memberships",hideTitle:!0,actions:[{icon:(0,a.jsx)(E.A,{}),label:"Edit Group",link:"/identity/administration/groups/edit?groupId=[id]"}],data:null==eA?void 0:eA.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.group"),simpleColumns:["displayName","groupTypes","securityEnabled","mailEnabled"]}}]:[],eN=eA?[{id:1,cardLabelBox:{cardLabelBoxHeader:(0,a.jsx)(m.A,{})},text:"Admin Roles",subtext:"List of roles the user is a member of",table:{title:"Admin Roles",hideTitle:!0,data:null==eA?void 0:eA.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.directoryRole"),simpleColumns:["displayName","description"]}}]:[];return(0,a.jsxs)(g.f,{tabOptions:h,title:eL,actions:(0,N.A)(),actionsData:ej,subtitle:ef,isFetching:ep.isLoading,children:[ep.isLoading&&(0,a.jsx)(r.A,{layout:[2,1,2,2]}),ep.isSuccess&&(0,a.jsx)(A.A,{sx:{flexGrow:1,py:4},children:(0,a.jsxs)(L.A,{container:!0,spacing:2,children:[(0,a.jsx)(L.A,{size:4,children:(0,a.jsx)(f.M,{user:ej,tenant:es.currentTenant,isFetching:ep.isLoading})}),(0,a.jsx)(L.A,{size:8,children:(0,a.jsxs)(y.A,{spacing:3,children:[(0,a.jsx)(C.A,{variant:"h6",children:"Latest Logon"}),(0,a.jsx)(D.L,{isFetching:ev.isPending,items:eC?[eC]:[],isCollapsible:!!eC}),(0,a.jsx)(C.A,{variant:"h6",children:"Applied Conditional Access Policies"}),(0,a.jsx)(D.L,{isFetching:ev.isPending,items:eD,isCollapsible:eD.length>0}),(0,a.jsx)(C.A,{variant:"h6",children:"Multi-Factor Authentication Devices"}),(0,a.jsx)(D.L,{isFetching:ev.isPending,items:eT,isCollapsible:eT.length>0}),(0,a.jsx)(C.A,{variant:"h6",children:"Memberships"}),(0,a.jsx)(D.L,{isFetching:ev.isPending,items:ew,isCollapsible:ew.length>0}),(0,a.jsx)(D.L,{isFetching:ev.isPending,items:eN,isCollapsible:eN.length>0})]})})]})}),(0,a.jsx)(V,{open:ec,onClose:()=>eu(!1),userId:el,tenantFilter:es.currentTenant})]})};H.getLayout=e=>(0,a.jsx)(o.P,{children:e});let q=H},34295:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var a=i(93944),o=i(37876);let s=(0,a.A)((0,o.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch")},46950:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var a=i(93944),o=i(37876);let s=(0,a.A)([(0,o.jsx)("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),(0,o.jsx)("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings")},65868:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var a=i(14232);let o=a.forwardRef(function(e,t){let{title:i,titleId:o,...s}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":o},s),i?a.createElement("title",{id:o},i):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))})}},e=>{var t=t=>e(e.s=t);e.O(0,[2836,4344,6917,636,6593,8792],()=>t(14305)),_N_E=e.O()}]);
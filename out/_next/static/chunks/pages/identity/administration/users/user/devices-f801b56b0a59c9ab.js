(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2608],{29392:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>T});var i=a(37876),s=a(12435),o=a(17825),r=a(89099),n=a(22322),l=a(86508),d=a(49259),c=a(86795),u=a(34124),p=a(15692),x=a(50387),v=a(81699),g=a(6706),h=a(84177),m=a(89037),b=a(82179),A=a(59568),y=a(16221),L=a(77018),D=a(15698);let N=()=>{var e,t,a,s,N,T,C,f,w,j,S,B,F;let E=(0,o.t)(),{userId:I}=(0,r.useRouter)().query,P=(0,n.R_)({url:"/api/ListUsers?UserId=".concat(I,"&tenantFilter=").concat(E.currentTenant),queryKey:"ListUsers-".concat(I)}),_=(0,n.R_)({url:"/api/ListGraphRequest",data:{Endpoint:"/users/".concat(I,"/authentication/methods"),tenantFilter:E.currentTenant,noPagination:!0,$top:99},queryKey:"MFA-".concat(I)}),M=(0,n.R_)({url:"/api/ListUserSigninLogs?UserId=".concat(I,"&tenantFilter=").concat(E.currentTenant,"&top=1"),queryKey:"ListSignIns-".concat(I)}),R=P.isSuccess?null===(t=P.data)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.displayName:"Loading...",U=P.isSuccess?[{icon:(0,i.jsx)(c.A,{}),text:(0,i.jsx)(h.R,{type:"chip",text:null===(s=P.data)||void 0===s?void 0:null===(a=s[0])||void 0===a?void 0:a.userPrincipalName})},{icon:(0,i.jsx)(u.A,{}),text:(0,i.jsx)(h.R,{type:"chip",text:null===(T=P.data)||void 0===T?void 0:null===(N=T[0])||void 0===N?void 0:N.id})},{icon:(0,i.jsx)(d.A,{}),text:(0,i.jsxs)(i.Fragment,{children:["Created: ",(0,i.jsx)(g.A,{date:new Date(null===(f=P.data)||void 0===f?void 0:null===(C=f[0])||void 0===C?void 0:C.createdDateTime)})," "]})}]:[],k=null===(w=P.data)||void 0===w?void 0:w[0],q=null,G=[],H=[];if(M.isSuccess&&M.data&&M.data.length>0){let e=M.data[0];if(q={id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"Login ".concat(0===e.status.errorCode?"successful":"failed"," from ").concat(e.ipAddress||"unknown location"),subtext:"Logged into application ".concat(e.resourceDisplayName||"Unknown Application"),statusColor:0===e.status.errorCode?"success.main":"error.main",statusText:0===e.status.errorCode?"Success":"Failed",propertyItems:[{label:"Client App Used",value:e.clientAppUsed||"N/A"},{label:"Device Detail",value:(null===(j=e.deviceDetail)||void 0===j?void 0:j.operatingSystem)||(null===(S=e.deviceDetail)||void 0===S?void 0:S.browser)||"N/A"},{label:"MFA Type used",value:(null===(B=e.mfaDetail)||void 0===B?void 0:B.authMethod)||"N/A"},{label:"Additional Details",value:(null===(F=e.status)||void 0===F?void 0:F.additionalDetails)||"N/A"}]},e.appliedConditionalAccessPolicies&&Array.isArray(e.appliedConditionalAccessPolicies)){let t=e.appliedConditionalAccessPolicies.filter(e=>"success"===e.result);G=t.length>0?t.map(t=>({id:t.id,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:t.displayName,subtext:"Policy applied: ".concat(t.result),statusColor:"success.main",statusText:"Applied",propertyItems:[{label:"Grant Controls",value:t.enforcedGrantControls.length>0?t.enforcedGrantControls.join(", "):"None"},{label:"Session Controls",value:t.enforcedSessionControls.length>0?t.enforcedSessionControls.join(", "):"None"},{label:"Conditions Satisfied",value:t.conditionsSatisfied||"N/A"}]})):[{id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"No conditional access policies applied",subtext:"No conditional access policies were applied during this sign-in.",statusColor:"warning.main",statusText:"No Policies Applied",propertyItems:[]}]}else G=[{id:1,cardLabelBox:{cardLabelBoxHeader:new Date(e.createdDateTime).getDate().toString(),cardLabelBoxText:new Date(e.createdDateTime).toLocaleString("default",{month:"short",year:"numeric"})},text:"No conditional access policies available",subtext:"No conditional access policies data is available for this sign-in.",statusColor:"warning.main",statusText:"No Data",propertyItems:[]}]}else M.isError?(q={id:1,cardLabelBox:"!",text:"Error loading sign-in logs. Do you have a P1 license?",subtext:M.error.message,statusColor:"error.main",statusText:"Error",propertyItems:[]},G=[{id:1,cardLabelBox:"!",text:"Error loading conditional access policies. Do you have a P1 license?",subtext:M.error.message,statusColor:"error.main",statusText:"Error",propertyItems:[]}]):M.isSuccess&&(!M.data||0===M.data.length)&&(q={id:1,cardLabelBox:"-",text:"No sign-in logs available",subtext:"There are no sign-in logs for this user, or you do not have a P1 license to detect this data.",statusColor:"warning.main",statusText:"No Data",propertyItems:[]},G=[{id:1,cardLabelBox:"-",text:"No conditional access policies available",subtext:"There are no conditional access policies for this user, or you do not have a P1 license to detect this data.",statusColor:"warning.main",statusText:"No Data",propertyItems:[]}]);if(_.isSuccess&&_.data){let e=(_.data.Results||[]).filter(e=>"#microsoft.graph.passwordAuthenticationMethod"!==e["@odata.type"]);H=e.length>0?e.map((e,t)=>{var a;return{id:t,cardLabelBox:{cardLabelBoxHeader:(0,i.jsx)(p.A,{})},text:e.displayName||"MFA Device",subtext:e.deviceTag||e.clientAppName||"Unknown device",statusColor:"success.main",statusText:"Enabled",propertyItems:[{label:"Device Name",value:e.displayName||"N/A"},{label:"App Version",value:e.phoneAppVersion||"N/A"},{label:"Created Date",value:e.createdDateTime?new Date(e.createdDateTime).toLocaleString():"N/A"},{label:"Authentication Method",value:(null===(a=e["@odata.type"])||void 0===a?void 0:a.split(".").pop())||"N/A"}]}}):[{id:1,cardLabelBox:"-",text:"No MFA devices available",subtext:"The user does not have any MFA devices registered.",statusColor:"warning.main",statusText:"No Devices",propertyItems:[]}]}else _.isError?H=[{id:1,cardLabelBox:"!",text:"Error loading MFA devices",subtext:_.error.message,statusColor:"error.main",statusText:"Error",propertyItems:[]}]:!_.isSuccess||_.data&&_.data.Results||(H=[{id:1,cardLabelBox:"-",text:"No MFA devices available",subtext:"The user does not have any MFA devices registered.",statusColor:"warning.main",statusText:"No Devices",propertyItems:[]}]);return(0,i.jsxs)(x.f,{tabOptions:v,title:R,subtitle:U,isFetching:P.isLoading,children:[P.isLoading&&(0,i.jsx)(l.A,{layout:[2,1,2,2]}),P.isSuccess&&(0,i.jsx)(m.A,{sx:{flexGrow:1,py:4},children:(0,i.jsxs)(A.A,{container:!0,spacing:2,children:[(0,i.jsx)(A.A,{size:4,children:(0,i.jsx)(y.M,{user:k,isFetching:P.isLoading})}),(0,i.jsx)(A.A,{size:8,children:(0,i.jsxs)(b.A,{spacing:3,children:[(0,i.jsx)(L.A,{variant:"h6",children:"Latest Logon"}),(0,i.jsx)(D.L,{isFetching:M.isLoading,items:q?[q]:[],isCollapsible:!!q}),(0,i.jsx)(L.A,{variant:"h6",children:"Applied Conditional Access Policies"}),(0,i.jsx)(D.L,{isFetching:M.isLoading,items:G,isCollapsible:G.length>0}),(0,i.jsx)(L.A,{variant:"h6",children:"Multi-Factor Authentication Devices"}),(0,i.jsx)(D.L,{isFetching:_.isLoading,items:H,isCollapsible:H.length>0})]})})]})})]})};N.getLayout=e=>(0,i.jsx)(s.P,{children:e});let T=N},36150:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/identity/administration/users/user/devices",function(){return a(29392)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[2836,6917,636,6593,8792],()=>t(36150)),_N_E=e.O()}]);
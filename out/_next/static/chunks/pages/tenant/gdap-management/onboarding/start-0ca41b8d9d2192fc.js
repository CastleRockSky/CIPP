(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{535:(e,l,i)=>{"use strict";i.d(l,{A:()=>n});var a=i(93944),t=i(37876);let n=(0,a.A)((0,t.jsx)("path",{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8"}),"Replay")},25551:e=>{"use strict";e.exports=JSON.parse('[{"label":"Application Administrator","value":"9b895d92-2cd3-44c7-9d02-a6ac2d5ea5c3"},{"label":"Authentication Policy Administrator","value":"0526716b-113d-4c15-b2c8-68e3c22b9f80"},{"label":"Cloud App Security Administrator","value":"892c5842-a9a6-463a-8041-72aa08ca3cf6"},{"label":"Cloud Device Administrator","value":"7698a772-787b-4ac8-901f-60d6b08affd2"},{"label":"Exchange Administrator","value":"29232cdf-9323-42fd-ade2-1d097af3e4de"},{"label":"Intune Administrator","value":"3a2c62db-5318-420d-8d74-23affee5d9d5"},{"label":"Privileged Authentication Administrator","value":"7be44c8a-adaf-4e2a-84d6-ab2649e08a13"},{"label":"Privileged Role Administrator","value":"e8611ab8-c189-46e8-94e1-60213ab1f814"},{"label":"Security Administrator","value":"194ae4cb-b126-40b2-bd5b-6091b380977d"},{"label":"SharePoint Administrator","value":"f28a1f50-f6e7-4571-818b-6a12f2af6b6c"},{"label":"Teams Administrator","value":"69091246-20e8-4a56-aa4d-066075b2a7a8"},{"label":"User Administrator","value":"fe930be7-5e62-47db-91af-98c3a49a38b1"}]')},28134:(e,l,i)=>{"use strict";i.r(l),i.d(l,{default:()=>C});var a=i(37876),t=i(24933),n=i(46061),d=i(7881),s=i(88326),o=i(77018),r=i(37746),u=i(17675),v=i(47737),c=i(12435),p=i(88992),h=i(58105),m=i(62964),g=i(82179),f=i(89037),b=i(59568),A=i(33862),x=i(22322),j=i(14232),R=i(35936),y=i(89099),D=i(25551),S=i(66375),T=i(87505),w=i(535),P=i(7159),F=i(36577),I=i(41412),E=i(55791);let M=()=>{var e,l,i,c,M,C,N,O,G,L,_,k,q,K;let[V,U]=(0,j.useState)(null),[z,H]=(0,j.useState)(null),[W,B]=(0,j.useState)([]),[X,Z]=(0,j.useState)([]),[J,Y]=(0,j.useState)(!1),[Q,$]=(0,j.useState)(null),[ee,el]=(0,j.useState)(0),[ei,ea]=(0,j.useState)(!1),[et,en]=(0,j.useState)(!1),[ed,es]=(0,j.useState)(!1),eo=y.router.query.id,er=(0,p.mN)({mode:"onChange"}),eu=(0,x.Zs)({url:"/api/ListGDAPInvite",queryKey:"ListGDAPInvite"}),ev=(0,x.R_)({url:"/api/ListGraphRequest",data:{TenantFilter:"",Endpoint:"tenantRelationships/delegatedAdminRelationships"},queryKey:"GDAPRelationshipOnboarding"}),ec=(0,x.Zs)({url:"/api/ListTenantOnboarding",queryKey:"ListTenantOnboarding"}),ep=(0,x.nN)({urlFromData:!0,onResult:e=>{$(e);var l,i=0;e.OnboardingSteps.map(e=>{"pending"!==e.Status&&"running"!==e.Status&&"failed"!==e.Status&&i++}),el(i),((null==e?void 0:e.Status)==="succeeded"||(null==e?void 0:e.Status)==="failed")&&((null===(l=e.OnboardingSteps)||void 0===l?void 0:l.find(e=>"running"===e.Status))||ea(!1))}}),eh=(0,p.FH)({control:er.control,name:"id"}),em=(0,p.FH)({control:er.control,name:"gdapRoles"});(0,j.useEffect)(()=>{if(ev.isSuccess&&eu.isSuccess&&ec.isSuccess&&eh!==V){var e=eh;if(!(null==eh?void 0:eh.value)&&eo){var l,i,a,t,n,d,s,o,r,u,v,c=null==ev?void 0:null===(o=ev.data)||void 0===o?void 0:null===(s=o.Results)||void 0===s?void 0:s.find(e=>(null==e?void 0:e.id)===eo);!c||(null==c?void 0:c.status)!=="active"&&(null==c?void 0:c.status)!=="approvalPending"||(null==c?void 0:null===(r=c.customer)||void 0===r?void 0:r.displayName.startsWith("MLT_"))?es(!0):(e={label:(null!==(v=null==c?void 0:null===(u=c.customer)||void 0===u?void 0:u.displayName)&&void 0!==v?v:"Pending Invite")+" - ("+(null==c?void 0:c.id)+")",value:null==c?void 0:c.id,addedFields:{customer:null==c?void 0:c.customer,id:null==c?void 0:c.id,createdDateTime:null==c?void 0:c.createdDateTime,accessDetails:null==c?void 0:c.accessDetails,status:null==c?void 0:c.status,autoExtendDuration:null==c?void 0:c.autoExtendDuration,lastModifiedDateTime:null==c?void 0:c.lastModifiedDateTime}},er.setValue("id",e),er.trigger(),es(!1))}let m=null==eu?void 0:null===(a=eu.data)||void 0===a?void 0:null===(i=a.pages)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:l.find(l=>(null==l?void 0:l.RowKey)===(null==e?void 0:e.value)),g=null===(d=ec.data)||void 0===d?void 0:null===(n=d.pages)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.find(l=>(null==l?void 0:l.RowKey)===(null==e?void 0:e.value));if(g){$(g);var p,h=0;null==g||null===(p=g.OnboardingSteps)||void 0===p||p.map(e=>{(null==e?void 0:e.Status)!=="pending"&&(null==e?void 0:e.Status)!=="running"&&(null==e?void 0:e.Status)!=="failed"&&h++}),en(!0),el(h)}else null!==Q&&(en(!1),$(null),el(0));U(e),H(null!=m?m:null)}},[ev.isSuccess,eu.isSuccess,ec.isSuccess,eh,eo]),(0,j.useEffect)(()=>{if(null==V?void 0:V.value){var e=[];e=(null==z?void 0:z.RoleMappings)?null==z?void 0:z.RoleMappings:null==em?void 0:em.value;var l=V.addedFields.accessDetails.unifiedRoles,i=[],a=[];null==e||e.forEach(e=>{(null==l?void 0:l.find(l=>l.roleDefinitionId===e.roleDefinitionId))||i.push(e)}),null==l||l.forEach(l=>{if(!(null==e?void 0:e.find(e=>e.roleDefinitionId===l.roleDefinitionId))){var l=null==m?void 0:m.find(e=>e.ObjectId===l.roleDefinitionId);a.push(l)}});var t=[];D.forEach(e=>{(null==l?void 0:l.find(l=>(null==e?void 0:e.value)===(null==l?void 0:l.roleDefinitionId)))||t.push(e)}),Y(t.length>0),B(i),Z(a),es(!1)}},[em,z,V]),(0,j.useEffect)(()=>{if(ei&&ep.isSuccess){let e=setInterval(()=>{ep.mutate({url:"/api/ExecOnboardTenant",data:{id:null==V?void 0:V.value}})},5e3);return()=>clearInterval(e)}},[ei,ep.isSuccess,null==ep?void 0:null===(e=ep.data)||void 0===e?void 0:e.data]);let eg=()=>{if(!er.formState.errors.id){var e={id:null==V?void 0:V.value};z||(e.autoMapRoles=!0,e.gdapRoles=null==em?void 0:em.value),er.getValues("ignoreMissingRoles")&&(e.ignoreMissingRoles=!!er.getValues("ignoreMissingRoles")),ep.mutate({url:"/api/ExecOnboardTenant",data:e}),ea(!0),en(!0)}},ef=()=>{if(!er.formState.errors.id){var e={id:null==V?void 0:V.value,retry:!0};z||(e.autoMapRoles=!0,e.gdapRoles=null==em?void 0:em.value),er.getValues("ignoreMissingRoles")&&(e.IgnoreMissingRoles=!!er.getValues("ignoreMissingRoles")),ep.mutate({url:"/api/ExecOnboardTenant",data:e}),ea(!0)}};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(F.A,{title:"Start Tenant Onboarding",backButtonTitle:"Tenant Onboarding",children:[(0,a.jsx)(t.A,{children:(0,a.jsxs)(b.A,{container:!0,spacing:4,children:[(0,a.jsx)(b.A,{size:{sm:12,md:6},children:(0,a.jsxs)(g.A,{spacing:2,children:[(0,a.jsx)(n.A,{severity:"info",children:"This page will allow you to start the onboarding process for a tenant. To proceed, select a GDAP Relationship from the dropdown below. If the relationship has not been mapped, you will be prompted to select a GDAP Role Template."}),ed&&(0,a.jsxs)(n.A,{severity:"error",children:["The selected relationship (",eo,") is not eligible for onboarding. Please select a different relationship."]}),(0,a.jsx)(h.A,{formControl:er,name:"id",label:"Select GDAP Relationship",type:"autoComplete",api:{url:"/api/ListGraphRequest",data:{Endpoint:"tenantRelationships/delegatedAdminRelationships"},excludeTenantFilter:!0,queryKey:"GDAPRelationships",dataKey:"Results",labelField:e=>{var l,i;return(null!==(i=null==e?void 0:null===(l=e.customer)||void 0===l?void 0:l.displayName)&&void 0!==i?i:"Pending Invite")+" - ("+(null==e?void 0:e.id)+")"},valueField:"id",addedField:{customer:"customer",id:"id",displayName:"displayName",createdDateTime:"createdDateTime",accessDetails:"accessDetails",status:"status",autoExtendDuration:"autoExtendDuration",lastModifiedDateTime:"lastModifiedDateTime"},dataFilter:e=>null==e?void 0:e.filter(e=>{var l,i,a,t;return((null==e?void 0:null===(l=e.addedFields)||void 0===l?void 0:l.status)==="active"||(null==e?void 0:null===(i=e.addedFields)||void 0===i?void 0:i.status)==="approvalPending")&&!(null==e?void 0:null===(t=e.addedFields)||void 0===t?void 0:null===(a=t.displayName)||void 0===a?void 0:a.startsWith("MLT_"))}),showRefresh:!0},multiple:!1,creatable:!0,required:!0,validators:{validate:e=>!!e||"Please select a GDAP Relationship"}}),(null==V?void 0:V.value)&&!z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{formControl:er,name:"remapRoles",value:!0,type:"hidden"}),(0,a.jsx)(h.A,{formControl:er,name:"gdapRoles",label:"Assign a GDAP Role Template",type:"autoComplete",api:{url:"/api/ExecGDAPRoleTemplate",queryKey:"GDAPTemplates",dataKey:"Results",labelField:e=>null==e?void 0:e.TemplateId,valueField:"RoleMappings"},required:!0,validators:{validate:e=>!!e||"Please select a GDAP Role Template"},multiple:!1,creatable:!1})]}),J&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.A,{severity:"warning",children:"The selected relationship does not contain all the default roles. CIPP may not function correctly if this is the only relationship with the tenant. Onboarding will fail unless you ignore the missing default roles."}),(0,a.jsx)(h.A,{formControl:er,name:"ignoreMissingRoles",label:"Ignore Missing Default Roles",type:"switch",value:!1})]}),(null==V?void 0:V.value)&&(0,a.jsxs)(a.Fragment,{children:[(null==V?void 0:null===(i=V.addedFields)||void 0===i?void 0:null===(l=i.accessDetails)||void 0===l?void 0:l.unifiedRoles.some(e=>"62e90394-69f5-4237-9190-012177145e10"===e.roleDefinitionId))&&(0,a.jsx)(n.A,{severity:"warning",children:"The Company Administrator role is a highly privileged role that should be used with caution. GDAP Relationships with this role will not be eligible for auto-extend."}),(z||em)&&W.length>0&&(0,a.jsxs)(n.A,{severity:"warning",children:["The following roles are not available in the selected relationship and will not be mapped:"," ",W.map(e=>e.RoleName).join(", ")]}),(z||em)&&X.length>0&&(0,a.jsxs)(n.A,{severity:"warning",children:["The following roles are not mapped with the current template:"," ",X.map(e=>{var l;return null!==(l=null==e?void 0:e.Name)&&void 0!==l?l:"Unknown Role"}).join(", ")]}),(z||em)&&0===W.length&&0===X.length&&(0,a.jsx)(n.A,{severity:"success",children:"All roles are mapped correctly"}),(0,a.jsxs)(d.A,{variant:"outlined",defaultExpanded:!0,children:[(0,a.jsx)(s.A,{expandIcon:(0,a.jsx)(T.A,{}),children:(0,a.jsx)(o.A,{variant:"h6",children:"Current Relationship Details"})}),(0,a.jsx)(r.A,{children:(0,a.jsx)(A.E,{layout:"double",showDivider:!1,propertyItems:[{label:"Customer",value:null!==(q=null==V?void 0:null===(M=V.addedFields)||void 0===M?void 0:null===(c=M.customer)||void 0===c?void 0:c.displayName)&&void 0!==q?q:"Pending Invite"},{label:"Status",value:(0,R.i)(null==V?void 0:null===(C=V.addedFields)||void 0===C?void 0:C.status,"status","text")},{label:"Auto Extend Duration",value:(null==V?void 0:null===(N=V.addedFields)||void 0===N?void 0:N.autoExtendDuration)=="PT0S"?"Not eligible for auto-extend":(0,R.i)(null==V?void 0:null===(O=V.addedFields)||void 0===O?void 0:O.autoExtendDuration,"autoExtendDuration","text")},{label:"Pending Invite",value:(null==z?void 0:z.RowKey)?"Yes":"No"},{label:"Created Date",value:(0,R.i)(null==V?void 0:null===(G=V.addedFields)||void 0===G?void 0:G.createdDateTime,"createdDateTime","date")},{label:"Last Modified Date",value:(0,R.i)(null==V?void 0:null===(L=V.addedFields)||void 0===L?void 0:L.lastModifiedDateTime,"lastModifiedDateTime","date")},{label:"Invite URL",value:(0,R.i)("https://admin.microsoft.com/AdminPortal/Home#/partners/invitation/granularAdminRelationships/"+V.value,"InviteUrl","url")},{label:"Access Details",value:(0,R.i)(z?z.RoleMappings:null==V?void 0:null===(k=V.addedFields)||void 0===k?void 0:null===(_=k.accessDetails)||void 0===_?void 0:_.unifiedRoles,"unifiedRoles","object")}]})})]})]})]})}),et&&(0,a.jsx)(b.A,{size:{sm:12,md:6},children:(0,a.jsxs)(g.A,{spacing:2,children:[(0,a.jsxs)(f.A,{children:[(0,a.jsxs)(o.A,{variant:"h4",children:["Onboarding Status: ",(0,I.i)(null==Q?void 0:Q.Status)]}),(0,a.jsxs)(o.A,{variant:"subtitle2",color:"textSecondary",children:["Updated ",(0,R.i)(null==Q?void 0:Q.Timestamp,"Timestamp","date")]})]}),(0,a.jsx)(f.A,{children:(0,a.jsx)(E.A,{data:null==Q?void 0:Q.Logs,title:"Logs:"})}),(0,a.jsx)(S.L,{activeStep:ee,orientation:"vertical",steps:null!==(K=null==Q?void 0:Q.OnboardingSteps.map(e=>({title:e.Title,description:e.Message,error:"failed"===e.Status})))&&void 0!==K?K:[]})]})})]})}),(0,a.jsx)(u.A,{sx:{justifyContent:"flex-end"},children:(0,a.jsxs)(g.A,{spacing:1,direction:"row",children:[Q&&(0,a.jsx)(v.A,{variant:"outlined",onClick:()=>{er.trigger(),ef()},startIcon:(0,a.jsx)(w.A,{}),disabled:!er.formState.isValid||(null==Q?void 0:Q.Status)==="running",children:"Retry"}),(0,a.jsx)(v.A,{variant:"contained",onClick:()=>{er.trigger(),eg()},startIcon:(0,a.jsx)(P.A,{}),disabled:!er.formState.isValid||(null==Q?void 0:Q.Status)==="succeeded"||(null==Q?void 0:Q.Status)==="failed"||(null==Q?void 0:Q.Status)==="queued"||(null==Q?void 0:Q.Status)==="running",children:"Start"})]})})]})})};M.getLayout=e=>(0,a.jsx)(c.P,{children:e});let C=M},36577:(e,l,i)=>{"use strict";i.d(l,{A:()=>h});var a=i(37876),t=i(89099),n=i(67578),d=i(86650),s=i(22474),o=i(47737),r=i(94810),u=i(77018),v=i(54538),c=i(42120),p=i(2303);let h=e=>{let{title:l,backButtonTitle:i="Back",children:h,cardSize:m="xl",hideTitleText:g=!1,hideBackButton:f=!1,noTenantInHead:b=!1,infoBar:A}=e,x=(0,t.useRouter)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.v,{title:l,noTenant:b}),(0,a.jsx)(n.A,{sx:{flexGrow:1,py:4},children:(0,a.jsx)(d.A,{maxWidth:m,children:(0,a.jsxs)(s.A,{spacing:2,children:[(0,a.jsxs)(s.A,{spacing:2,children:[(0,a.jsx)("div",{children:!f&&(0,a.jsx)(o.A,{color:"inherit",onClick:()=>{x.back()},startIcon:(0,a.jsx)(r.A,{fontSize:"small",children:(0,a.jsx)(c.A,{})}),children:i})}),!0!==g&&(0,a.jsx)("div",{children:(0,a.jsx)(u.A,{variant:"h4",children:l})})]}),A,(0,a.jsx)(v.A,{children:h})]})})})]})}},42120:(e,l,i)=>{"use strict";i.d(l,{A:()=>n});var a=i(93944),t=i(37876);let n=(0,a.A)((0,t.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")},58340:(e,l,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenant/gdap-management/onboarding/start",function(){return i(28134)}])}},e=>{var l=l=>e(e.s=l);e.O(0,[636,6593,8792],()=>l(58340)),_N_E=e.O()}]);
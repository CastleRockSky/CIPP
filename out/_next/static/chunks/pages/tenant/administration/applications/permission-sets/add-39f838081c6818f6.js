(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8897],{75089:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>y});var s=i(37876),a=i(89099),o=i(12435),n=i(88992),l=i(22322),m=i(94861),r=i(36577),p=i(24933),d=i(22474),c=i(77018),u=i(46061),h=i(67578),f=i(47737),T=i(58105),N=i(14232),P=i(37460);let x=()=>{let e=(0,a.useRouter)(),{template:t,copy:i,name:o}=e.query,[x,y]=(0,N.useState)(null),[A,w]=(0,N.useState)([]),[j,v]=(0,N.useState)(0),S=(0,n.mN)({mode:"onBlur"}),{data:g,isFetching:I}=(0,l.R_)({url:t?"/api/ExecAppPermissionTemplate?TemplateId=".concat(t):null,queryKey:t?["execAppPermissionTemplateDetails",t,j]:null,enabled:!!t}),{data:_,isLoading:C}=(0,l.R_)({url:"/api/ExecAppPermissionTemplate",queryKey:"execAppPermissionTemplateList"});(0,N.useEffect)(()=>{_&&_.length>0&&w(_)},[_]),(0,N.useEffect)(()=>{if(t||i||x){if(g&&i&&!x){if(g[0]){let e="Copy of ".concat(g[0].TemplateName);y({Permissions:g[0].Permissions,TemplateName:e}),S.setValue("templateName",e)}}else g&&!x&&g[0]&&(y({TemplateId:g[0].TemplateId,Permissions:g[0].Permissions,TemplateName:g[0].TemplateName}),S.setValue("templateName",g[0].TemplateName))}else y({Permissions:{},TemplateName:"New Permission Set"}),S.setValue("templateName","New Permission Set")},[g,i,t]);let E=(0,l.nN)({urlFromData:!0,relatedQueryKeys:["ExecAppPermissionTemplate","execAppPermissionTemplate"]});return(0,s.jsx)(r.A,{hideBackButton:!1,title:i?"Copy Permission Set":"Add Permission Set",children:(0,s.jsx)(p.A,{children:(0,s.jsx)(d.A,{spacing:2,children:(!I||!t)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.A,{variant:"body2",children:i?"Create a copy of an existing permission set with your own modifications.":t?"Edit the permissions in this permission set.":"Create a new permission set to define a collection of application permissions."}),(0,s.jsx)(u.A,{severity:"info",children:"Permission sets allow you to define collections of permissions that can be applied to applications consistently."}),(0,s.jsx)(T.o,{formControl:S,name:"templateName",label:"Permission Set Name",type:"textField",required:!0,validators:{required:"Permission set name is required"}}),!t&&!i&&(0,s.jsxs)(d.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,s.jsx)(h.A,{sx:{flexGrow:1},children:(0,s.jsx)(T.o,{formControl:S,name:"importTemplate",label:"Import from Existing (optional)",placeholder:"Select a template to import",type:"autoComplete",options:A.map(e=>({label:e.TemplateName,value:e.TemplateId})),isFetching:C,multiple:!1})}),(0,s.jsx)(f.A,{variant:"outlined",onClick:()=>{let e=S.getValues("importTemplate");if(!e)return;let t=A.find(t=>t.TemplateId===e.value);t&&(y({Permissions:t.Permissions,TemplateName:"Import of ".concat(t.TemplateName)}),S.setValue("templateName","Import of ".concat(t.TemplateName)))},startIcon:(0,s.jsx)(P.A,{}),disabled:!S.watch("importTemplate"),children:"Import"})]}),x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{severity:"info",children:"Choose the permissions you want to assign to this permission set. Microsoft Graph is the default Service Principal added and you can choose to add additional Service Principals as needed. Note that some Service Principals do not have any published permissions to choose from."}),(0,s.jsx)(m.A,{formControl:S,currentPermissions:x,onSubmit:s=>{let a={...s};i?delete a.TemplateId:t&&!i&&(a.TemplateId=t),a.TemplateName=S.getValues("templateName"),E.mutate({url:"/api/ExecAppPermissionTemplate?Action=Save",data:a,queryKey:"execAppPermissionTemplate"},{onSuccess:s=>{if(i||!t){let t=s.data[0].Metadata.TemplateId;e.push({pathname:"/tenant/administration/applications/permission-sets/edit",query:{template:t,name:a.TemplateName}},void 0,{shallow:!0})}else v(e=>e+1)}})},updatePermissions:E,removePermissionConfirm:!0,appDisplayName:S.watch("templateName")||"New Permission Set"},j)]})]})})})})};x.getLayout=e=>(0,s.jsx)(o.P,{children:e});let y=x},93468:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenant/administration/applications/permission-sets/add",function(){return i(75089)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[888,8520,1949,636,6593,8792],()=>t(93468)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[106],{16452:e=>{"use strict";e.exports=JSON.parse('[{"label":"Saved Logs","path":"/tenant/administration/audit-logs"},{"label":"Log Searches","path":"/tenant/administration/audit-logs/searches"}]')},17055:(e,l,a)=>{"use strict";a.d(l,{L:()=>d});var t=a(37876),r=a(14e3),i=a(67578),o=a(22474),s=a(8578),n=a(76626),u=a(71538);let d=e=>{let{tabOptions:l,children:a}=e,d=(0,r.useRouter)(),c=(0,r.usePathname)(),m=l.find(e=>e.path===c);return(0,t.jsxs)(i.A,{sx:{flexGrow:1,py:4},children:[(0,t.jsx)(o.A,{spacing:2,children:(0,t.jsxs)("div",{children:[(0,t.jsx)(s.A,{onChange:(e,l)=>{d.push(l)},value:null==m?void 0:m.path,variant:"scrollable",children:l.map(e=>(0,t.jsx)(n.A,{label:e.label,value:e.path},e.path))}),(0,t.jsx)(u.A,{})]})}),a]})}},30604:(e,l,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenant/administration/audit-logs/searches",function(){return a(56788)}])},56788:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>C});var t=a(37876),r=a(14232),i=a(12435),o=a(17055),s=a(29390),n=a(79803),u=a(7881),d=a(88326),c=a(77018),m=a(37746),p=a(47737),v=a(87505),b=a(88992),h=a(58105),A=a(22875),y=a(59568),g=a(99439),f=a(95339),S=a(82836),F=a(16452),P=a(17825);let x=["displayName","status","filterStartDateTime","filterEndDateTime"],T=[{label:"View Results",link:"/tenant/administration/audit-logs/search-results?id=[id]&name=[displayName]",color:"primary",icon:(0,t.jsx)(A.A,{})},{label:"Process Logs",url:"/api/ExecAuditLogSearch",confirmText:"Process these logs? Note: This will only alert on logs that match your Alert Configuration rules.",type:"POST",data:{Action:"ProcessLogs",SearchId:"id"},icon:(0,t.jsx)(g.A,{})}],D=()=>{var e,l;let a=(0,S.s)(),i=(0,P.t)().currentTenant,o=(0,b.mN)({mode:"onChange",defaultValues:{StatusFilter:{label:"All",value:""},DateFilter:{label:"All Time",value:""}}}),[A,g]=(0,r.useState)(!1),[F,D]=(0,r.useState)("/api/ListAuditLogSearches?Type=Searches"),C=o.watch("StatusFilter"),L=o.watch("DateFilter");(0,r.useEffect)(()=>{let e=new URLSearchParams;e.set("Type","Searches"),(null==C?void 0:C.value)&&e.set("Status",C.value),(null==L?void 0:L.value)&&e.set("Days",L.value),D("/api/ListAuditLogSearches?".concat(e.toString()))},[C,L]);let w=[{type:"textField",name:"DisplayName",label:"Search Name"},{type:"autoComplete",name:"TenantFilter",label:"Tenant",multiple:!1,creatable:!1,api:{url:"/api/ListTenants?AllTenantSelector=false",labelField:e=>"".concat(e.displayName," (").concat(e.defaultDomainName,")"),valueField:"defaultDomainName",queryKey:"ListTenants-FormnotAllTenants",excludeTenantFilter:!0},validators:{validate:e=>!!(null==e?void 0:e.value)||"Please select a tenant"},required:!0},{type:"datePicker",name:"StartTime",label:"Start Date & Time",dateTimeType:"datetime-local",validators:{required:"Start time is required"},required:!0},{type:"datePicker",name:"EndTime",label:"End Date & Time",dateTimeType:"datetime-local",validators:{required:"End time is required"},required:!0},{type:"autoComplete",name:"ServiceFilters",label:"Services",multiple:!0,creatable:!1,options:[{label:"Azure Active Directory",value:"AzureActiveDirectory"},{label:"Dynamics 365",value:"CRM"},{label:"Exchange Online",value:"Exchange"},{label:"Microsoft Flow",value:"MicrosoftFlow"},{label:"Microsoft Teams",value:"MicrosoftTeams"},{label:"OneDrive for Business",value:"OneDrive"},{label:"Power BI",value:"PowerBI"},{label:"Security & Compliance",value:"ThreatIntelligence"},{label:"SharePoint Online",value:"SharePoint"},{label:"Yammer",value:"Yammer"}],validators:{validate:e=>(null==e?void 0:e.length)>0||"Please select at least one service"}},{type:"autoComplete",name:"RecordTypeFilters",label:"Record Types",multiple:!0,creatable:!1,options:[{label:"Azure Active Directory",value:"azureActiveDirectory"},{label:"Azure AD Account Logon",value:"azureActiveDirectoryAccountLogon"},{label:"Azure AD STS Logon",value:"azureActiveDirectoryStsLogon"},{label:"Compliance DLP Endpoint",value:"complianceDLPEndpoint"},{label:"Compliance DLP Exchange",value:"complianceDLPExchange"},{label:"Compliance DLP SharePoint",value:"complianceDLPSharePoint"},{label:"Data Governance",value:"dataGovernance"},{label:"Exchange Admin",value:"exchangeAdmin"},{label:"Exchange Item",value:"exchangeItem"},{label:"Exchange Item Group",value:"exchangeItemGroup"},{label:"Information Worker Protection",value:"informationWorkerProtection"},{label:"Label Content Explorer",value:"labelContentExplorer"},{label:"Microsoft Flow",value:"microsoftFlow"},{label:"Microsoft Forms",value:"microsoftForms"},{label:"Microsoft Stream",value:"microsoftStream"},{label:"Microsoft Teams",value:"microsoftTeams"},{label:"Microsoft Teams Admin",value:"microsoftTeamsAdmin"},{label:"Microsoft Teams Analytics",value:"microsoftTeamsAnalytics"},{label:"Microsoft Teams Device",value:"microsoftTeamsDevice"},{label:"Microsoft Teams Shifts",value:"microsoftTeamsShifts"},{label:"MIP Label",value:"mipLabel"},{label:"OneDrive",value:"oneDrive"},{label:"Power Apps App",value:"powerAppsApp"},{label:"Power Apps Plan",value:"powerAppsPlan"},{label:"Power BI Audit",value:"powerBIAudit"},{label:"Power BI DLP",value:"powerBIDlp"},{label:"Security & Compliance Alerts",value:"securityComplianceAlerts"},{label:"Security & Compliance Insights",value:"securityComplianceInsights"},{label:"Security & Compliance RBAC",value:"securityComplianceRBAC"},{label:"SharePoint",value:"sharePoint"},{label:"SharePoint File Operation",value:"sharePointFileOperation"},{label:"SharePoint List Operation",value:"sharePointListOperation"},{label:"SharePoint Sharing Operation",value:"sharePointSharingOperation"},{label:"Threat Intelligence",value:"threatIntelligence"},{label:"Threat Intelligence ATP Content",value:"threatIntelligenceAtpContent"},{label:"Threat Intelligence URL",value:"threatIntelligenceUrl"},{label:"Workplace Analytics",value:"workplaceAnalytics"}]},{type:"autoComplete",name:"KeywordFilter",label:"Keywords",multiple:!0,creatable:!0,freeSolo:!0,placeholder:"Enter keywords to search for",options:[]},{type:"autoComplete",name:"OperationsFilters",label:"Operations",multiple:!0,creatable:!0,placeholder:"Enter or select operations",options:[{label:"User Logged In",value:"UserLoggedIn"},{label:"Mailbox Login",value:"mailboxlogin"},{label:"Add User",value:"add user."},{label:"Update User",value:"update user."},{label:"Delete User",value:"delete user."},{label:"Reset User Password",value:"reset user password."},{label:"Change User Password",value:"change user password."},{label:"Change User License",value:"change user license."},{label:"Add Group",value:"add group."},{label:"Update Group",value:"update group."},{label:"Delete Group",value:"delete group."},{label:"Add Member to Group",value:"add member to group."},{label:"Remove Member from Group",value:"remove member from group."},{label:"New Mailbox",value:"New-Mailbox"},{label:"Set Mailbox",value:"Set-Mailbox"},{label:"Add Mailbox Permission",value:"add-mailboxpermission"},{label:"Remove Mailbox Permission",value:"remove-mailboxpermission"},{label:"Mail Items Accessed",value:"mailitemsaccessed"},{label:"Send Message",value:"send"},{label:"Send As",value:"sendas"},{label:"Send On Behalf",value:"sendonbehalf"},{label:"Create Item",value:"create"},{label:"Update Message",value:"update"},{label:"Copy Messages",value:"copy"},{label:"Move Messages",value:"move"},{label:"Move to Deleted Items",value:"movetodeleteditems"},{label:"Soft Delete",value:"softdelete"},{label:"Hard Delete",value:"harddelete"},{label:"New Inbox Rule",value:"new-inboxrule"},{label:"Set Inbox Rule",value:"set-inboxrule"},{label:"Update Inbox Rules",value:"updateinboxrules"},{label:"Add Folder Permissions",value:"addfolderpermissions"},{label:"Remove Folder Permissions",value:"removefolderpermissions"},{label:"Update Folder Permissions",value:"updatefolderpermissions"},{label:"Update Calendar Delegation",value:"updatecalendardelegation"},{label:"File Accessed",value:"FileAccessed"},{label:"File Modified",value:"FileModified"},{label:"File Deleted",value:"FileDeleted"},{label:"File Downloaded",value:"FileDownloaded"},{label:"File Uploaded",value:"FileUploaded"},{label:"Sharing Set",value:"SharingSet"},{label:"Anonymous Link Created",value:"AnonymousLinkCreated"},{label:"Add Member to Role",value:"add member to role."},{label:"Remove Member from Role",value:"remove member from role."},{label:"Add Service Principal",value:"add service principal."},{label:"Remove Service Principal",value:"remove service principal."},{label:"Add Domain to Company",value:"add domain to company."},{label:"Remove Domain from Company",value:"remove domain from company."},{label:"Verify Domain",value:"verify domain."},{label:"Set Company Information",value:"set company information."},{label:"Disable Strong Authentication",value:"Disable Strong Authentication."},{label:"Apply Record Label",value:"applyrecordlabel"},{label:"Update STS Refresh Token",value:"Update StsRefreshTokenValidFrom Timestamp."}]},{type:"autoComplete",name:"UserPrincipalNameFilters",label:"User Principal Names",multiple:!0,creatable:!0,freeSolo:!0,placeholder:"Enter user principal names",options:[]},{type:"autoComplete",name:"IPAddressFilters",label:"IP Addresses",multiple:!0,creatable:!0,freeSolo:!0,placeholder:"Enter IP addresses",options:[]},{type:"autoComplete",name:"ObjectIdFilters",label:"Object IDs",multiple:!0,creatable:!0,freeSolo:!0,placeholder:"Enter object IDs",options:[]},{type:"autoComplete",name:"AdministrativeUnitFilters",label:"Administrative Units",multiple:!0,creatable:!0,placeholder:"Enter administrative units",api:{url:"/api/ListGraphRequest",queryKey:"AdministrativeUnits",data:{Endpoint:"directoryObjects/microsoft.graph.administrativeUnit",$select:"id,displayName"},dataKey:"Results",labelField:"displayName",valueField:"id",addedField:{id:"id",displayName:"displayName"},showRefresh:!0}},{type:"switch",name:"ProcessLogs",label:"Process Logs for Alerts",helperText:"Enable to store this search for alert processing"}];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.a,{tableFilter:(0,t.jsxs)(u.A,{expanded:A,onChange:()=>g(!A),children:[(0,t.jsx)(d.A,{expandIcon:(0,t.jsx)(v.A,{}),children:(0,t.jsx)(c.A,{children:"Filter Search List"})}),(0,t.jsx)(m.A,{children:(0,t.jsxs)(y.A,{container:!0,spacing:2,children:[(0,t.jsx)(y.A,{size:{xs:12,md:6},children:(0,t.jsx)(h.A,{type:"autoComplete",name:"StatusFilter",label:"Status",multiple:!1,options:[{label:"All",value:""},{label:"Completed",value:"Completed"},{label:"In Progress",value:"InProgress"},{label:"Failed",value:"Failed"}],formControl:o})}),(0,t.jsx)(y.A,{size:{xs:12,md:6},children:(0,t.jsx)(h.A,{type:"autoComplete",name:"DateFilter",label:"Date Range",multiple:!1,options:[{label:"All Time",value:""},{label:"Last 24 Hours",value:"1"},{label:"Last 7 Days",value:"7"},{label:"Last 30 Days",value:"30"}],formControl:o})})]})})]}),title:"Log Searches",apiUrl:F,apiDataKey:"Results",simpleColumns:x,queryKey:"AuditLogSearches-".concat((null===(e=o.getValues().StatusFilter)||void 0===e?void 0:e.value)||"All","-").concat((null===(l=o.getValues().DateFilter)||void 0===l?void 0:l.value)||"AllTime","-").concat(i),actions:T,cardButton:(0,t.jsx)(p.A,{onClick:()=>a.handleOpen(),startIcon:(0,t.jsx)(f.A,{}),children:"New Search"})}),(0,t.jsx)(n.B,{createDialog:a,title:"Create New Audit Log Search",fields:w,api:{type:"POST",url:"/api/ExecAuditLogSearch",confirmText:"Create this audit log search? This may take several minutes to hours to complete.",relatedQueryKeys:["AuditLogSearches"],allowResubmit:!0,customDataformatter:(e,l,a)=>{var t;let r={...a};if(console.log("Formatted Data:",r),(null===(t=r.TenantFilter)||void 0===t?void 0:t.value)&&(r.TenantFilter=r.TenantFilter.value),Array.isArray(r.KeywordFilter)){let e=r.KeywordFilter.map(e=>"object"==typeof e?e.value:e).filter(Boolean);r.KeywordFilter=e.join(" ")}return Array.isArray(r.RecordTypeFilters)&&(r.RecordTypeFilters=r.RecordTypeFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.ServiceFilters)&&(r.ServiceFilters=r.ServiceFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.OperationsFilters)&&(r.OperationsFilters=r.OperationsFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.UserPrincipalNameFilters)&&(r.UserPrincipalNameFilters=r.UserPrincipalNameFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.IPAddressFilters)&&(r.IPAddressFilters=r.IPAddressFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.ObjectIdFilters)&&(r.ObjectIdFilters=r.ObjectIdFilters.map(e=>"object"==typeof e?e.value:e)),Array.isArray(r.AdministrativeUnitFilters)&&(r.AdministrativeUnitFilters=r.AdministrativeUnitFilters.map(e=>"object"==typeof e?e.value:e)),Object.keys(r).forEach(e=>{Array.isArray(r[e])&&0===r[e].length&&delete r[e],(""===r[e]||null===r[e]||void 0===r[e])&&delete r[e]}),r}}})]})};D.getLayout=e=>(0,t.jsx)(i.P,{children:(0,t.jsx)(o.L,{tabOptions:F,children:e})});let C=D},99439:(e,l,a)=>{"use strict";a.d(l,{A:()=>i});var t=a(93944),r=a(37876);let i=(0,t.A)((0,r.jsx)("path",{d:"M7 9H2V7h5zm0 3H2v2h5zm13.59 7-3.83-3.83c-.8.52-1.74.83-2.76.83-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5c0 1.02-.31 1.96-.83 2.75L22 17.59zM17 11c0-1.65-1.35-3-3-3s-3 1.35-3 3 1.35 3 3 3 3-1.35 3-3M2 19h10v-2H2z"}),"ManageSearch")}},e=>{var l=l=>e(e.s=l);e.O(0,[636,6593,8792],()=>l(30604)),_N_E=e.O()}]);
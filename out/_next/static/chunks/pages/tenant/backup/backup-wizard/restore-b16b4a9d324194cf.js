(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2025],{2474:(e,t,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenant/backup/backup-wizard/restore",function(){return i(43385)}])},42120:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var s=i(93944),n=i(37876);let r=(0,s.A)((0,n.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")},43385:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>b});var s=i(37876),n=i(14232),r=i(77018),a=i(46061),l=i(71538),o=i(59568),c=i(88992),d=i(12435),u=i(90240),h=i(58105),p=i(17825),x=i(46402),m=i(22474),A=i(59017);let j=()=>{var e;let t=(0,p.t)().currentTenant||"",i=(0,c.mN)({mode:"onChange",defaultValues:{tenantFilter:t,users:!0,groups:!0,ca:!0,intuneconfig:!0,intunecompliance:!0,intuneprotection:!0,antispam:!0,antiphishing:!0,CippWebhookAlerts:!0,CippScriptedAlerts:!0,CippStandards:!0,overwrite:!1,webhook:!1,email:!1,psa:!1,backup:null}}),[d,j]=(0,n.useState)([]),[b,w]=(0,n.useState)(null),[f,v]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=[{RowKey:"Backup1"},{RowKey:"Backup2"},{RowKey:"Backup3"}];t?(v(!0),setTimeout(()=>{j(e),v(!1)},500)):j([])},[t]),(0,s.jsxs)(u.A,{title:"Backup Restore Task",formControl:i,postUrl:"/api/AddScheduledItem",customDataformatter:e=>{var i;let s=Math.floor(new Date().getTime()/1e3)-45;return{TenantFilter:t,Name:"CIPP Restore ".concat(t),Command:{value:"New-CIPPRestore"},Parameters:{Type:"Scheduled",RestoreValues:{backup:(null===(i=e.backup)||void 0===i?void 0:i.value)||e.backup,users:e.users,groups:e.groups,ca:e.ca,intuneconfig:e.intuneconfig,intunecompliance:e.intunecompliance,intuneprotection:e.intuneprotection,antispam:e.antispam,antiphishing:e.antiphishing,CippWebhookAlerts:e.CippWebhookAlerts,CippScriptedAlerts:e.CippScriptedAlerts,overwrite:e.overwrite}},ScheduledTime:s,PostExecution:{Webhook:e.webhook,Email:e.email,PSA:e.psa},DisallowDuplicateName:!0}},backButtonTitle:"Backup Tasks",children:[(0,s.jsx)(r.A,{variant:"body1",sx:{mb:2},children:"Use this form to restore a backup for a tenant. Please select the tenant, backup, and restore options."}),(0,s.jsxs)(o.A,{container:!0,spacing:2,sx:{mb:2},children:[(0,s.jsx)(o.A,{size:{xs:12},children:(0,s.jsx)(h.A,{type:"autoComplete",label:"Backups for ".concat(t),name:"backup",multiple:!1,api:{url:"/api/ExecListBackup",queryKey:"BackupList-".concat(t),labelField:e=>{let t=e.BackupName.match(/.*_(\d{4}-\d{2}-\d{2})-(\d{2})(\d{2})/);return t?"".concat(t[1]," @ ").concat(t[2],":").concat(t[3]):e.BackupName},valueField:"BackupName",data:{Type:"Scheduled",NameOnly:!0}},formControl:i,required:!0,validators:{validate:e=>!!e||"Please select a backup"}})}),(0,s.jsx)(o.A,{size:{xs:12},children:(0,s.jsx)(r.A,{variant:"h6",children:"Restore Settings"})}),(0,s.jsxs)(o.A,{size:{md:6,xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Identity"}),(0,s.jsx)(h.A,{type:"switch",label:"User List",name:"users",formControl:i}),(0,s.jsx)(h.A,{type:"switch",label:"Groups",name:"groups",formControl:i})]}),(0,s.jsxs)(o.A,{size:{md:6,xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Conditional Access"}),(0,s.jsx)(h.A,{type:"switch",label:"Conditional Access Configuration",name:"ca",formControl:i})]}),(0,s.jsxs)(o.A,{size:{md:6,xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Intune"}),(0,s.jsx)(h.A,{type:"switch",label:"Intune Configuration Policies",name:"intuneconfig",formControl:i}),(0,s.jsx)(h.A,{type:"switch",label:"Intune Compliance Policies",name:"intunecompliance",formControl:i}),(0,s.jsx)(h.A,{type:"switch",label:"Intune Protection Policies",name:"intuneprotection",formControl:i})]}),(0,s.jsxs)(o.A,{size:{md:6,xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Email Security"}),(0,s.jsx)(h.A,{type:"switch",label:"Anti-Spam Policies",name:"antispam",formControl:i}),(0,s.jsx)(h.A,{type:"switch",label:"Anti-Phishing Policies",name:"antiphishing",formControl:i})]}),(0,s.jsxs)(o.A,{size:{md:6,xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"CIPP"}),(0,s.jsx)(h.A,{type:"switch",label:"Webhook Alerts Configuration",name:"CippWebhookAlerts",formControl:i}),(0,s.jsx)(h.A,{type:"switch",label:"Scripted Alerts Configuration",name:"CippScriptedAlerts",formControl:i})]}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(h.A,{type:"switch",label:"Overwrite existing entries",name:"overwrite",formControl:i}),(0,s.jsx)(x.A,{formControl:i,field:"overwrite",compareType:"is",compareValue:!0,children:(0,s.jsx)(o.A,{size:{xs:12},children:(0,s.jsxs)(a.A,{severity:"warning",children:[(0,s.jsx)("strong",{children:"Warning:"})," Overwriting existing entries will remove the current settings and replace them with the backup settings. If you have selected to restore users, all properties will be overwritten with the backup settings. To prevent and skip already existing entries, deselect the setting from the list above, or disable overwrite."]})})})]}),(0,s.jsx)(o.A,{size:{xs:12},children:(0,s.jsx)(r.A,{variant:"subtitle1",children:"Send Restore results to:"})}),(0,s.jsx)(o.A,{size:{md:4,xs:12},children:(0,s.jsx)(h.A,{type:"switch",label:"Webhook",name:"webhook",formControl:i})}),(0,s.jsx)(o.A,{size:{md:4,xs:12},children:(0,s.jsx)(h.A,{type:"switch",label:"E-mail",name:"email",formControl:i})}),(0,s.jsx)(o.A,{size:{md:4,xs:12},children:(0,s.jsx)(h.A,{type:"switch",label:"PSA",name:"psa",formControl:i})}),(0,s.jsx)(o.A,{size:{xs:12},children:(0,s.jsx)(l.A,{})}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(r.A,{variant:"h5",children:"Review and Confirm"}),(0,s.jsx)(r.A,{variant:"body1",color:"textSecondary",children:"Please review the selected options before submitting."})]}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Selected Tenant:"}),(0,s.jsx)(r.A,{variant:"body2",color:"textSecondary",children:t})]}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Selected Backup:"}),(0,s.jsx)(r.A,{variant:"body2",color:"textSecondary",children:(null===(e=i.watch("backup"))||void 0===e?void 0:e.label)||"None selected"})]}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Overwrite Existing Configuration:"}),(0,s.jsx)(r.A,{variant:"body2",color:"textSecondary",children:i.watch("overwrite")?"Yes":"No"})]}),(0,s.jsxs)(o.A,{size:{xs:12},children:[(0,s.jsx)(r.A,{variant:"subtitle1",children:"Send Results To:"}),(0,s.jsx)(r.A,{variant:"body2",color:"textSecondary",children:(0,s.jsxs)(m.A,{direction:"row",spacing:1,children:[i.watch("webhook")&&(0,s.jsx)(A.A,{color:"primary",label:"Webhook"}),i.watch("email")&&(0,s.jsx)(A.A,{color:"primary",label:"E-mail"}),i.watch("psa")&&(0,s.jsx)(A.A,{color:"primary",label:"PSA"}),!i.watch("webhook")&&!i.watch("email")&&!i.watch("psa")&&(0,s.jsx)(A.A,{color:"default",label:"None"})]})})]})]})]})};j.getLayout=e=>(0,s.jsx)(d.P,{children:e});let b=j},90240:(e,t,i)=>{"use strict";i.d(t,{A:()=>f});var s=i(37876),n=i(89099),r=i(67578),a=i(86650),l=i(22474),o=i(47737),c=i(94810),d=i(77018),u=i(54538),h=i(24933),p=i(17675),x=i(42120),m=i(22322),A=i(68723),j=i(14232),b=i(88992),w=i(2303);let f=e=>{let{title:t,backButtonTitle:i,titleButton:f,formPageType:v="Add",children:y,queryKey:g,formControl:k,postUrl:C,customDataformatter:S,resetForm:P=!1,hideBackButton:z=!1,hidePageType:N=!1,hideTitle:E=!1,hideSubmit:T=!1,allowResubmit:B=!1,addedButtons:_,...I}=e,R=(0,n.useRouter)(),W=(0,m.nN)({datafromUrl:!0,relatedQueryKeys:g}),{isValid:O,isDirty:F}=(0,b.lN)({control:k.control});return(0,j.useEffect)(()=>{if(delete R.query.tenantFilter,R.query){let e={...k.getValues(),...R.query};k.reset(e)}},[R]),(0,j.useEffect)(()=>{W.isSuccess&&P&&k.reset()},[W.isSuccess]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.v,{title:t}),(0,s.jsx)(r.A,{sx:{flexGrow:1,py:4},children:(0,s.jsx)(a.A,{maxWidth:"lg",children:(0,s.jsxs)(l.A,{spacing:4,children:[!E&&(0,s.jsxs)(l.A,{spacing:2,children:[!z&&(0,s.jsx)("div",{children:(0,s.jsx)(o.A,{color:"inherit",onClick:()=>{R.back()},startIcon:(0,s.jsx)(c.A,{fontSize:"small",children:(0,s.jsx)(x.A,{})}),children:i})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)(d.A,{variant:"h4",children:[!N&&(0,s.jsxs)(s.Fragment,{children:[v," - "]}),t]}),f&&f]})]}),(0,s.jsxs)(u.A,{children:[(0,s.jsxs)(h.A,{children:[y,(0,s.jsx)(A.v,{apiObject:W})]}),!T&&(0,s.jsx)(p.A,{sx:{justifyContent:"flex-end"},children:(0,s.jsxs)(l.A,{spacing:2,direction:"row",children:[_&&_,(0,s.jsx)(o.A,{disabled:W.isPending||!O||!B&&!F,onClick:k.handleSubmit(()=>{if(k.trigger(),!O)return;let e=S?S(k.getValues()):k.getValues();Object.keys(e).forEach(t=>{(""===e[t]||null===e[t])&&delete e[t]}),W.mutate({url:C,data:e})}),type:"submit",variant:"contained",children:"Submit"})]})})]})]})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,6593,8792],()=>t(2474)),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5760],{50030:(e,l,a)=>{"use strict";a.r(l),a.d(l,{default:()=>S});var t=a(37876),n=a(12435),s=a(67578),o=a(86650),r=a(22474),i=a(47737),c=a(94810),d=a(77018),m=a(70946),x=a(59568),u=a(14232),h=a(60455),p=a(88992),A=a(84064),j=a(58105),b=a(88917),f=a(89099),F=a(46402),C=a(22322),y=a(68723),v=a(2303),g=a(409),w=a(95339);let P=()=>{let e=(0,f.useRouter)(),l=(0,C.nN)({relatedQueryKeys:"ListBPATemplates"}),a=(0,C.R_)({url:"/api/ListBPATemplates?RawJson=true",queryKey:"ListBPATemplates-Raw"}),n=(0,p.mN)({defaultValues:{name:"",style:"Table",Fields:[{UseExistingInfo:!1}]}});(0,u.useEffect)(()=>{if(a.isSuccess){let l=e.query.id,t=a.data.find(e=>e.name===l);if(t){e.query.clone&&(t.name="".concat(t.name," (Clone)")),E(t.style),I(t.Fields.map((e,l)=>({id:"block-".concat(l)})));let l={...t,Fields:t.Fields.map(e=>({...e,ExtractFields:e.ExtractFields?e.ExtractFields.map(e=>({label:e,value:e})):[]}))};n.reset(l)}}},[a.isSuccess]);let{watch:P,handleSubmit:S}=n,T="BPA Report Builder",[z,E]=(0,u.useState)("Table"),[k,I]=(0,u.useState)([{id:"table-card"}]),B=e=>{I(l=>l.filter(l=>l.id!==e));let l=e.split("-")[1];n.setValue("Fields.".concat(l),null)},N=e=>{E(e),"Table"===e?I([{id:"table-card"}]):I([{id:"block-default"}])},O=(0,p.FH)({control:n.control,name:"style"});(0,u.useEffect)(()=>{O&&O!==z&&N(O)},[O]);let _=e=>{};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.v,{title:T}),(0,t.jsx)(s.A,{sx:{flexGrow:1,py:4},children:(0,t.jsxs)(o.A,{maxWidth:!1,children:[(0,t.jsxs)(r.A,{spacing:4,children:[(0,t.jsx)(r.A,{direction:"row",justifyContent:"space-between",alignItems:"center",children:(0,t.jsx)(i.A,{color:"inherit",onClick:()=>e.back(),startIcon:(0,t.jsx)(c.A,{fontSize:"small",children:(0,t.jsx)(b.A6,{})}),children:"Back to Templates"})}),(0,t.jsx)(d.A,{variant:"h4",gutterBottom:!0,children:T})]}),(0,t.jsx)(A.A,{CardButton:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(i.A,{variant:"contained",onClick:()=>{let e=n.getValues(),a=e=>{if(Array.isArray(e))return e.map(a).filter(e=>null!=e&&""!==e);if("object"==typeof e&&null!==e){let l={};return Object.keys(e).forEach(t=>{let n=a(e[t]);"FrontendFields"===t||Array.isArray(n)?l[t]=n:null!=n&&""!==n&&(l[t]=n)}),0===Object.keys(l).length?null:l}return"string"==typeof e?""===e.trim()?null:e:e},t=a(e),s=e=>{Object.keys(e).forEach(l=>{"object"==typeof e[l]&&null!==e[l]&&void 0!==e[l].value&&void 0!==e[l].label?e[l]=e[l].value:"object"==typeof e[l]&&s(e[l])})};s(t),JSON.stringify(t,null,2),l.mutate({url:"/api/AddBPATemplate",data:t})},startIcon:(0,t.jsx)(g.A,{}),children:"Save Report"})}),title:"Report Settings",children:(0,t.jsxs)(x.A,{container:!0,spacing:2,children:[(0,t.jsx)(x.A,{size:{md:12,sm:12,xs:12},children:(0,t.jsx)(j.A,{label:"Report Name",name:"name",formControl:n})}),(0,t.jsx)(x.A,{size:{md:12,sm:12,xs:12},children:(0,t.jsx)(j.A,{label:"Layout Mode",name:"style",type:"select",options:[{label:"Block",value:"Tenant"},{label:"Table",value:"Table"}],formControl:n})}),(0,t.jsx)(x.A,{size:{md:12,sm:12,xs:12},children:(0,t.jsx)(y.v,{apiObject:l})})]})}),(0,t.jsxs)(r.A,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{my:3},children:[(0,t.jsx)(d.A,{variant:"h5",children:"Fields"}),(0,t.jsx)(i.A,{variant:"outlined",size:"small",onClick:()=>{I(e=>[...e,{id:"block-".concat(e.length+1)}])},startIcon:(0,t.jsx)(w.A,{}),children:"Add Field"})]}),(0,t.jsx)(x.A,{container:!0,spacing:2,children:k.map((e,l)=>{var s,o;return(0,t.jsx)(x.A,{size:{md:"Table"===z?12:4,sm:"Table"===z?12:6,xs:10},children:(0,t.jsx)(A.A,{title:"".concat("Table"===z?"Table Column":"Block"," - ").concat(P("Fields.".concat(l,".FrontendFields.0.name"))||"New Field"),cardActions:(0,t.jsx)(m.A,{"aria-label":"delete",onClick:()=>B(e.id),children:(0,t.jsx)(h.A,{})}),children:(0,t.jsx)("form",{onSubmit:S(_),children:(0,t.jsxs)(x.A,{container:!0,spacing:2,children:[(0,t.jsx)(x.A,{size:{xs:6},children:(0,t.jsx)(j.A,{label:"Card Name",name:"Fields.".concat(l,".FrontendFields.0.name"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:6},children:(0,t.jsx)(j.A,{label:"Card Description",name:"Fields.".concat(l,".FrontendFields.0.desc"),formControl:n,type:"textField"})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Use information CIPP has previously gathered in another report",name:"Fields.".concat(l,".UseExistingInfo"),formControl:n,type:"switch"})}),(0,t.jsxs)(F.A,{field:"Fields.".concat(l,".UseExistingInfo"),compareType:"isNot",compareValue:!0,formControl:n,children:[(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Data source",name:"Fields.".concat(l,".API"),formControl:n,multiple:!1,options:[{label:"Graph",value:"Graph"},{label:"Exchange Online PowerShell",value:"Exchange"},{label:"CIPP Function",value:"CIPPFunction"}],type:"autoComplete"})}),(0,t.jsxs)(F.A,{field:"Fields.".concat(l,".API"),compareType:"is",compareValue:"Graph",formControl:n,children:[(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Graph URL",name:"Fields.".concat(l,".URL"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Where Object (PowerShell Syntax, optional)",name:"Fields.".concat(l,".where"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Use Application Permissions",name:"Fields.".concat(l,".Parameters.asApp"),formControl:n,type:"switch"})})]}),(0,t.jsxs)(F.A,{field:"Fields.".concat(l,".API"),compareType:"is",compareValue:"Exchange",formControl:n,children:[(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Exchange Command (PowerShell Syntax)",name:"Fields.".concat(l,".Command"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Where Object (PowerShell Syntax, optional)",name:"Fields.".concat(l,".where"),formControl:n})})]}),(0,t.jsxs)(F.A,{field:"Fields.".concat(l,".API"),compareType:"is",compareValue:"CIPPFunction",formControl:n,children:[(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"CIPP Command (Get- only)",name:"Fields.".concat(l,".Command"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Where Object (PowerShell Syntax, optional)",name:"Fields.".concat(l,".where"),formControl:n})})]}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"What fields from the API response should we save?",name:"Fields.".concat(l,".ExtractFields"),formControl:n,type:"autoComplete"})}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Store this data as",name:"Fields.".concat(l,".StoreAs"),formControl:n,multiple:!1,options:[{label:"String - Useful if you are extracting a specific string.",value:"string"},{label:"JSON - Useful when storing as a complex object",value:"JSON"},{label:"Bool - useful to store true/false values.",value:"bool"}],type:"autoComplete"})})]}),(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{label:"Datasource Reference Name - This is the name stored in the database.",name:"Fields.".concat(l,".name"),formControl:n})}),(0,t.jsx)(x.A,{size:{xs:12},children:"Table"===z?null:(0,t.jsx)(j.A,{label:"Card Formatter",name:"Fields.".concat(l,".FrontendFields.0.formatter"),formControl:n,multiple:!1,options:[{label:"String - Show as text",value:"string"},{label:"Boolean - Show a true/false check",value:"bool"},{label:"Warn Boolean - Show a true/false check that is orange when false",value:"warnBool"},{label:"Reverse Boolean - False is green, True is red.",value:"reverseBool"},{label:"Table - Show the data in a table",value:"table"},{label:"Number - Show the value as a number",value:"number"},{label:"Percentage - Show the value as a percentage",value:"percentage"}],type:"autoComplete"})}),(0,t.jsx)(F.A,{field:"Fields.".concat(l,".UseExistingInfo"),compareValue:!0,formControl:n,children:(0,t.jsx)(x.A,{size:{xs:12},children:(0,t.jsx)(j.A,{name:"Fields.".concat(l,".FrontendFields.0.value"),label:"Card Content",type:"autoComplete",formControl:n,multiple:!1,options:null!==(o=null===(s=a.data)||void 0===s?void 0:s.flatMap(e=>{var l,a;return null!==(a=null===(l=e.Fields)||void 0===l?void 0:l.map(e=>e.name))&&void 0!==a?a:[]}).filter((e,l,a)=>e&&a.indexOf(e)===l).map(e=>({label:e,value:e})).sort((e,l)=>e.label.localeCompare(l.label)))&&void 0!==o?o:[]})})}),(0,t.jsx)(F.A,{field:"Fields.".concat(l,".UseExistingInfo"),compareValue:!1,formControl:n,children:(0,t.jsx)(x.A,{size:{xs:12},children:"Table"===z?null:(0,t.jsx)(j.A,{label:"Card Value",name:"Fields.".concat(l,".FrontendFields.0.value"),formControl:n,type:"textField"})})})]})})})},e.id)})})]})})]})};P.getLayout=e=>(0,t.jsx)(n.P,{children:e});let S=P},68824:(e,l,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tenant/standards/bpa-report/builder",function(){return a(50030)}])}},e=>{var l=l=>e(e.s=l);e.O(0,[636,6593,8792],()=>l(68824)),_N_E=e.O()}]);
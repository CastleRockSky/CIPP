"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9365],{14304:(e,s,i)=>{i.d(s,{A:()=>t});var l=i(93944),n=i(37876);let t=(0,l.A)((0,n.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning")},17055:(e,s,i)=>{i.d(s,{L:()=>u});var l=i(37876),n=i(14e3),t=i(67578),a=i(22474),o=i(8578),r=i(76626),d=i(71538);let u=e=>{let{tabOptions:s,children:i}=e,u=(0,n.useRouter)(),c=(0,n.usePathname)(),v=s.find(e=>e.path===c);return(0,l.jsxs)(t.A,{sx:{flexGrow:1,py:4},children:[(0,l.jsx)(a.A,{spacing:2,children:(0,l.jsxs)("div",{children:[(0,l.jsx)(o.A,{onChange:(e,s)=>{u.push(s)},value:null==v?void 0:v.path,variant:"scrollable",children:s.map(e=>(0,l.jsx)(r.A,{label:e.label,value:e.path},e.path))}),(0,l.jsx)(d.A,{})]})}),i]})}},56372:(e,s,i)=>{i.d(s,{A:()=>n});var l=i(14232);let n=l.forwardRef(function(e,s){let{title:i,titleId:n,...t}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":n},t),i?l.createElement("title",{id:n},i):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))})},80479:(e,s,i)=>{i.d(s,{A:()=>z});var l=i(37876),n=i(22474),t=i(47737),a=i(94810),o=i(67578),r=i(77018),d=i(59017),u=i(37224),c=i(46061),v=i(70946),h=i(84064),m=i(22322),p=i(14232),x=i(94760),g=i(76776),A=i(63009),j=i(34126),f=i(27418),R=i(14628),y=i(33862),b=i(56372),P=i(45936),F=i(57016),C=i(5419),M=i(31540),T=i(68723);let D=e=>{let{executeCheck:s,setSkipCache:i,offcanvasVisible:n,setOffcanvasVisible:o,importReport:d,setCardIcon:u}=e,[c,v]=(0,p.useState)({});(0,p.useEffect)(()=>{d?v(d):v(null==s?void 0:s.data)},[s,d]),(0,p.useEffect)(()=>{var e,s,i,n;(null==c?void 0:null===(s=c.Results)||void 0===s?void 0:null===(e=s.MissingPermissions)||void 0===e?void 0:e.length)>0||(null==c?void 0:null===(n=c.Results)||void 0===n?void 0:null===(i=n.ErrorMessages)||void 0===i?void 0:i.length)>0?u((0,l.jsx)(f.A,{})):u((0,l.jsx)(R.A,{}))},[c]);let h=(0,m.nN)({urlFromData:!0,relatedQueryKeys:["ExecAccessChecks-Permissions"]}),D=(0,m.nN)({urlFromData:!0,relatedQueryKeys:["ExecAccessChecks-Permissions"]});var k,E,I,S,G,w,L,N,z,O,V,_,K,B,U,W,q,Q,H,$,J,X,Y=[];return["Name","UserPrincipalName","IPAddress"].forEach(e=>{var s,i;Y.push({label:e,value:null==c?void 0:null===(i=c.Results)||void 0===i?void 0:null===(s=i.AccessTokenDetails)||void 0===s?void 0:s[e]})}),Y.push({label:"App Registration",value:(0,l.jsx)(x.A,{href:"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationMenuBlade/Overview/appId/".concat(null==c?void 0:null===(E=c.Results)||void 0===E?void 0:null===(k=E.AccessTokenDetails)||void 0===k?void 0:k.AppId),target:"_blank",children:null==c?void 0:null===(S=c.Results)||void 0===S?void 0:null===(I=S.AccessTokenDetails)||void 0===I?void 0:I.AppName})}),(0,l.jsxs)(l.Fragment,{children:[Y.length>0&&(0,l.jsx)(y.E,{isFetching:!d&&s.isFetching,propertyItems:Y,layout:"double",showDivider:!1}),!d&&s.isFetching?(0,l.jsx)(g.A,{variant:"rectangular",height:100,sx:{borderRadius:1,ml:3,mr:1}}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(A.A,{children:[null==c?void 0:null===(G=c.Results)||void 0===G?void 0:G.Messages.map((e,s)=>(0,l.jsx)(j.Ay,{sx:{py:0},children:(0,l.jsxs)(r.A,{variant:"body2",children:[(0,l.jsx)(a.A,{fontSize:"sm",style:{marginRight:4},children:(0,l.jsx)(R.A,{})}),e]})},s)),null==c?void 0:null===(w=c.Results)||void 0===w?void 0:w.ErrorMessages.map((e,s)=>(0,l.jsx)(j.Ay,{sx:{py:0},children:(0,l.jsxs)(r.A,{variant:"body2",children:[(0,l.jsx)(a.A,{fontSize:"sm",style:{marginRight:4},children:(0,l.jsx)(b.A,{})}),e]})},s)),(null==c?void 0:null===(L=c.Results)||void 0===L?void 0:L.MissingPermissions.length)>0&&(0,l.jsx)(j.Ay,{sx:{py:0},children:(0,l.jsxs)(r.A,{variant:"body2",children:[(0,l.jsx)(a.A,{fontSize:"sm",style:{marginRight:4},children:(0,l.jsx)(b.A,{})}),"There are new permissions to apply."]})})]}),(0,l.jsxs)(F.w,{size:"lg",title:"Permission Details",visible:n,onClose:()=>{o(!1)},extendedInfo:[],children:[(0,l.jsx)(r.A,{variant:"h4",sx:{mx:3},children:"Permission Details"}),(null==c?void 0:null===(N=c.Results)||void 0===N?void 0:N.Links.length)>0&&(0,l.jsx)(C.a,{title:"Documentation",showDivider:!1,cardSx:{p:0,m:0},propertyItems:null==c?void 0:null===(z=c.Results)||void 0===z?void 0:z.Links.map(e=>({value:(0,l.jsx)(x.A,{href:e.Href,target:"_blank",children:e.Href}),label:e.Text}))}),(0,l.jsx)(T.v,{apiObject:h}),(null==c?void 0:null===(O=c.Results)||void 0===O?void 0:O.MissingPermissions.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Missing Permissions",isFetching:!d&&s.isFetching,refreshFunction:s,cardButton:(0,l.jsx)(t.A,{variant:"contained",color:"primary",size:"small",onClick:e=>{i(!0),h.mutate({url:"/api/ExecPermissionRepair",data:{},queryKey:"RepairPermissions"})},startIcon:(0,l.jsx)(a.A,{fontSize:"sm",children:(0,l.jsx)(P.A,{})}),children:"Repair Permissions"}),data:null==c?void 0:null===(V=c.Results)||void 0===V?void 0:V.MissingPermissions,simpleColumns:["Application","Type","Permission"]})}),(0,l.jsx)(T.v,{apiObject:D}),(null==c?void 0:null===(K=c.Results)||void 0===K?void 0:null===(_=K.CPVRefreshList)||void 0===_?void 0:_.length)>0&&(0,l.jsx)(M.x,{title:"Tenants needing CPV Refresh",cardButton:(0,l.jsx)(t.A,{variant:"contained",color:"primary",size:"small",onClick:()=>{D.mutate({url:"/api/ExecCPVRefresh",data:{},queryKey:"CPVRefresh"})},startIcon:(0,l.jsx)(a.A,{fontSize:"sm",children:(0,l.jsx)(P.A,{})}),children:"Refresh CPV"}),isFetching:!d&&s.isFetching,refreshFunction:s,data:null==c?void 0:null===(B=c.Results)||void 0===B?void 0:B.CPVRefreshList,simpleColumns:["DisplayName","DefaultDomainName","LastRefresh"]}),(null==c?void 0:null===(W=c.Results)||void 0===W?void 0:null===(U=W.AccessTokenDetails)||void 0===U?void 0:U.Scope.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Current Delegated Scopes",isFetching:!d&&s.isFetching,refreshFunction:s,data:null==c?void 0:null===(Q=c.Results)||void 0===Q?void 0:null===(q=Q.AccessTokenDetails)||void 0===q?void 0:q.Scope.map(e=>({Scope:e})),simpleColumns:["Scope"]})}),(null==c?void 0:null===($=c.Results)||void 0===$?void 0:null===(H=$.ApplicationTokenDetails)||void 0===H?void 0:H.Roles.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Current Application Roles",isFetching:!d&&s.isFetching,refreshFunction:s,data:null==c?void 0:null===(X=c.Results)||void 0===X?void 0:null===(J=X.ApplicationTokenDetails)||void 0===J?void 0:J.Roles.map(e=>({Role:e})),simpleColumns:["Role"]})})]})]})]})};var k=i(14304);let E=e=>{var s,i,n,t,o,d,u,c,v,h,m,x,P,C;let{executeCheck:T,offcanvasVisible:D,setOffcanvasVisible:E,importReport:I,setCardIcon:S}=e,[G,w]=(0,p.useState)({});(0,p.useEffect)(()=>{I?w(I):w(null==T?void 0:T.data)},[T,I]),(0,p.useEffect)(()=>{var e,s,i,n;(null==G?void 0:null===(s=G.Results)||void 0===s?void 0:null===(e=s.GDAPIssues)||void 0===e?void 0:e.length)>0||(null==G?void 0:null===(n=G.Results)||void 0===n?void 0:null===(i=n.MissingGroups)||void 0===i?void 0:i.length)>0?S((0,l.jsx)(f.A,{})):S((0,l.jsx)(R.A,{}))},[G]);let L=e=>{let{results:s,type:i,match:n}=e;var t,o,r,d,u=[];return i&&(u=null==s?void 0:null===(o=s.Results)||void 0===o?void 0:null===(t=o.GDAPIssues.filter(e=>e.Type===i))||void 0===t?void 0:t.length),n&&(u=null==s?void 0:null===(d=s.Results)||void 0===d?void 0:null===(r=d.GDAPIssues.filter(e=>new RegExp(n).test(e.Issue)))||void 0===r?void 0:r.length),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(a.A,{fontSize:"sm",style:{marginRight:4},children:[i&&(0,l.jsx)(l.Fragment,{children:"Warning"===i?(0,l.jsx)(k.A,{}):(0,l.jsx)(b.A,{})}),n&&(0,l.jsx)(l.Fragment,{children:u>0?(0,l.jsx)(k.A,{}):(0,l.jsx)(R.A,{})})]}),u]})},N=[{label:"Warnings",value:(0,l.jsx)(L,{results:G,type:"Warning"})},{label:"Errors",value:(0,l.jsx)(L,{results:G,type:"Error"})},{label:"Microsoft Led Transition Relationships",value:(0,l.jsx)(L,{results:G,match:".+Microsoft Led Transition.+"})},{label:"Global Admin Relationships",value:(0,l.jsx)(L,{results:G,match:".+global administrator.+"})}];return(0,l.jsxs)(l.Fragment,{children:[N.length>0&&(0,l.jsx)(y.E,{direction:"row",isFetching:!I&&(null==T?void 0:T.isFetching),propertyItems:N,showDivider:!1,layout:!0}),!I&&T.isFetching?(0,l.jsx)(g.A,{variant:"rectangular",height:100,sx:{borderRadius:1,ml:3,mr:1}}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(A.A,{children:[{resultProperty:"Memberships",matchProperty:"displayName",match:"AdminAgents",count:1,successMessage:"User is a member of the AdminAgents group",failureMessage:"User is not a member of the AdminAgents group"},{resultProperty:"Memberships",matchProperty:"displayName",match:"^M365 GDAP.+",count:12,successMessage:"User is a member of the 12 CIPP Recommended GDAP groups",failureMessage:"User is not a member of the 12 CIPP Recommended GDAP groups"},{resultProperty:"GDAPIssues",matchProperty:"Issue",match:".+Microsoft Led Transition.+$",count:0,successMessage:"No Microsoft Led Transition relationships found",failureMessage:"Microsoft Led Transition relationships found"},{resultProperty:"GDAPIssues",matchProperty:"Issue",match:".+global administrator.+$",count:0,successMessage:"No Global Admin relationships found",failureMessage:"Global Admin relationships found"}].map((e,s)=>{var i,n,t=null==G?void 0:null===(n=G.Results)||void 0===n?void 0:null===(i=n[e.resultProperty])||void 0===i?void 0:i.filter(s=>new RegExp(e.match).test(null==s?void 0:s[e.matchProperty])),o=!1;return o=e.count>1?(null==t?void 0:t.length)>=e.count:(null==t?void 0:t.length)===e.count,(0,l.jsx)(j.Ay,{sx:{py:0},children:(0,l.jsxs)(r.A,{variant:"body2",children:[(0,l.jsx)(a.A,{fontSize:"sm",style:{marginRight:4},children:o?(0,l.jsx)(R.A,{}):(0,l.jsx)(b.A,{})}),o?e.successMessage:e.failureMessage]})},s)})}),(0,l.jsxs)(F.w,{size:"xl",title:"GDAP Details",visible:D,onClose:()=>{E(!1)},extendedInfo:[],children:[(0,l.jsx)(r.A,{variant:"h4",sx:{mx:3},children:"GDAP Details"}),(null==G?void 0:null===(i=G.Results)||void 0===i?void 0:null===(s=i.GDAPIssues)||void 0===s?void 0:s.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"GDAP Issues",isFetching:!I&&T.isFetching,refreshFunction:T,data:null==G?void 0:null===(n=G.Results)||void 0===n?void 0:n.GDAPIssues,simpleColumns:["Tenant","Type","Issue","Link"]})}),(null==G?void 0:null===(o=G.Results)||void 0===o?void 0:null===(t=o.MissingGroups)||void 0===t?void 0:t.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Missing Groups",isFetching:!I&&T.isFetching,refreshFunction:T,data:null==G?void 0:null===(d=G.Results)||void 0===d?void 0:d.MissingGroups,simpleColumns:["Name","Type"]})}),(null==G?void 0:null===(c=G.Results)||void 0===c?void 0:null===(u=c.Memberships)||void 0===u?void 0:u.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.group").length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Group Memberships",isFetching:!I&&T.isFetching,refreshFunction:T,data:null==G?void 0:null===(h=G.Results)||void 0===h?void 0:null===(v=h.Memberships)||void 0===v?void 0:v.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.group"),simpleColumns:["displayName"]})}),(null==G?void 0:null===(x=G.Results)||void 0===x?void 0:null===(m=x.Memberships)||void 0===m?void 0:m.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.directoryRole").length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Directory Roles",isFetching:!I&&T.isFetching,refreshFunction:T,data:null==G?void 0:null===(C=G.Results)||void 0===C?void 0:null===(P=C.Memberships)||void 0===P?void 0:P.filter(e=>(null==e?void 0:e["@odata.type"])==="#microsoft.graph.directoryRole"),simpleColumns:["displayName"]})})]})]})]})};var I=i(79259),S=i(48504);let G=(0,i(93944).A)([(0,l.jsx)("path",{d:"m19.28 4.93-2.12-2.12c-.78-.78-2.05-.78-2.83 0L11.5 5.64l2.12 2.12 2.12-2.12 3.54 3.54c1.17-1.18 1.17-3.08 0-4.25M5.49 13.77c.59.59 1.54.59 2.12 0l2.47-2.47-2.12-2.13-2.47 2.47c-.59.59-.59 1.54 0 2.13"},"0"),(0,l.jsx)("path",{d:"m15.04 7.76-.71.71-.71.71L10.44 6c-.59-.6-1.54-.6-2.12-.01-.59.59-.59 1.54 0 2.12l3.18 3.18-.71.71-6.36 6.36c-.78.78-.78 2.05 0 2.83s2.05.78 2.83 0L16.45 12c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41z"},"1")],"Plumbing"),w=e=>{var s;let{importReport:i=!1}=e;return(0,l.jsxs)(l.Fragment,{children:[(null==i?void 0:null===(s=i.Results)||void 0===s?void 0:s.length)>0&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(M.x,{title:"Imported Report",noCard:!0,data:i.Results,actions:[],simpleColumns:["TenantName","LastRun","GraphStatus","ExchangeStatus","MissingRoles","GDAPRoles"],offCanvas:{extendedInfoFields:["TenantName","TenantId","DefaultDomainName","LastRun","GraphTest","ExchangeTest","OrgManagementRepairNeeeded","OrgManagementRoles","OrgManagementRolesMissing"]}})}),!i&&(0,l.jsx)(M.x,{title:"Tenant Results",noCard:!0,api:{url:"/api/ExecAccessChecks",data:{Type:"Tenants"},dataKey:"Results",queryKey:"ExecAccessChecks-Tenants"},actions:[{label:"Check Tenant",type:"POST",url:"/api/ExecAccessChecks?Type=Tenants",data:{TenantId:"TenantId"},icon:(0,l.jsx)(I.A,{}),confirmText:"Execute the access check for the selected tenant(s)?",relatedQueryKeys:"ExecAccessChecks-Tenants",multiPost:!1},{label:"Repair Exchange Roles",type:"POST",url:"/api/ExecExchangeRoleRepair",data:{TenantId:"TenantId"},icon:(0,l.jsx)(G,{}),confirmText:"Repair Exchange roles for [TenantName]?",condition:e=>!0===e.OrgManagementRepairNeeded}],simpleColumns:["TenantName","LastRun","GraphStatus","ExchangeStatus","MissingRoles","GDAPRoles"],offCanvas:{extendedInfoFields:["TenantName","TenantId","DefaultDomainName","LastRun","GraphTest","ExchangeTest"]}})]})};var L=i(43225),N=i(7222);let z=e=>{let{type:s,importReport:i=!1,variant:x}=e,[g,A]=(0,p.useState)(!1),[j,f]=(0,p.useState)(null),[R,y]=(0,p.useState)(!1),[b,P]=(0,p.useState)(!0);var F,C,M,T,k,G=!0;"Tenants"===s&&(G=!1);let z=(0,m.R_)({url:"/api/ExecAccessChecks",data:{Type:s,SkipCache:g},waiting:!i,queryKey:"ExecAccessChecks-".concat(s)}),O=()=>{A(!0),g&&z.refetch()};return(0,p.useEffect)(()=>{g&&z.refetch()},[g]),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(h.A,{variant:x,title:(0,l.jsxs)(n.A,{direction:"row",alignContent:"center",justifyContent:"space-between",sx:{mb:0},children:[(0,l.jsxs)(o.A,{children:[s," Check"]}),(0,l.jsxs)(n.A,{direction:"row",spacing:2,children:[(null==i?void 0:i[s])&&(0,l.jsx)(d.A,{size:"small",label:"Imported",variant:"outlined"}),j&&(0,l.jsx)(a.A,{children:j})]})]}),cardSx:{display:"flex",flexDirection:"column",height:"100%",p:0,marginBottom:"auto"},CardButton:(0,l.jsx)(()=>{var e,d,u,c;return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(n.A,{direction:"row",spacing:3,display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",children:[(0,l.jsxs)(n.A,{direction:"row",spacing:1,children:[(0,l.jsx)(t.A,{variant:"contained",size:"small",startIcon:(0,l.jsx)(a.A,{fontSize:"small",children:(0,l.jsx)(I.A,{})}),onClick:O,disabled:z.isPending||z.isFetching||i,children:"Refresh"}),G&&(0,l.jsxs)(t.A,{onClick:()=>{y(!0)},variant:"outlined",color:"primary",size:"small",disabled:z.isPending||z.isFetching,children:[(0,l.jsx)(a.A,{fontSize:"small",style:{marginRight:4},children:(0,l.jsx)(N.A,{})}),"Details"]})]}),(0,l.jsx)(o.A,{component:r.A,variant:"caption",children:z.isSuccess&&(0,l.jsxs)(l.Fragment,{children:["Last run"," ",(0,l.jsx)(L.z,{data:(null==i?void 0:i[s])?null==i?void 0:null===(d=i[s])||void 0===d?void 0:null===(e=d.Metadata)||void 0===e?void 0:e.LastRun:null===(c=z.data)||void 0===c?void 0:null===(u=c.Metadata)||void 0===u?void 0:u.LastRun})]})})]})})},{}),children:(z.isSuccess||z.isLoading)&&(0,l.jsxs)(l.Fragment,{children:[(null===(C=z.data)||void 0===C?void 0:null===(F=C.Metadata)||void 0===F?void 0:F.AlertMessage)&&(0,l.jsx)(u.A,{in:b,unmountOnExit:!0,children:(0,l.jsx)(c.A,{severity:null!==(k=null==z?void 0:null===(T=z.data)||void 0===T?void 0:null===(M=T.Metadata)||void 0===M?void 0:M.AlertSeverity)&&void 0!==k?k:"info",sx:{mb:2},action:(0,l.jsx)(v.A,{"aria-label":"close",color:"inherit",size:"small",onClick:()=>P(!1),children:(0,l.jsx)(S.A,{fontSize:"inherit"})}),children:z.data.Metadata.AlertMessage})}),"Permissions"===s&&(0,l.jsx)(D,{executeCheck:z,importReport:null==i?void 0:i[s],setSkipCache:A,offcanvasVisible:R,setOffcanvasVisible:y,setCardIcon:f}),"GDAP"===s&&(0,l.jsx)(E,{executeCheck:z,importReport:null==i?void 0:i[s],offcanvasVisible:R,setOffcanvasVisible:y,setCardIcon:f}),"Tenants"===s&&(0,l.jsx)(w,{importReport:null==i?void 0:i[s]})]})})})}}}]);
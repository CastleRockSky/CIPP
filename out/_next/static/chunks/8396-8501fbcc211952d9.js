"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8396],{68396:(e,i,s)=>{s.d(i,{A:()=>F});var n=s(37876),r=s(14232),a=s(77018),l=s(76776),t=s(46061),d=s(22474),o=s(67578),c=s(50694),p=s(59017),h=s(94810),u=s(8578),x=s(76626),m=s(63009),v=s(34126),g=s(93256),A=s(7881),y=s(88326),j=s(37746),b=s(81514),f=s(87505),P=s(68978),w=s(22322);let S=e=>{var i,s;let{resource:r,servicePrincipalId:t,expandedResource:c,handleAccordionChange:u}=e,{data:x,isSuccess:P,isFetching:S,isLoading:I}=(0,w.R_)({url:"/api/ExecServicePrincipals",data:{Id:t},queryKey:"execServicePrincipal-details-".concat(t),waiting:!!t}),F=null==x?void 0:x.Results,W=(e,i)=>{var s,n;if(!F)return{name:e,description:"Loading..."};if("Role"===i){let i=null===(s=F.appRoles)||void 0===s?void 0:s.find(i=>i.id===e);return{name:(null==i?void 0:i.value)||e,description:(null==i?void 0:i.description)||"No description available"}}{let i=null===(n=F.publishedPermissionScopes)||void 0===n?void 0:n.find(i=>i.id===e);return{name:(null==i?void 0:i.value)||e,description:(null==i?void 0:i.userConsentDescription)||(null==i?void 0:i.description)||"No description available"}}},R=(null==F?void 0:F.displayName)||r.resourceAppId,N=(null===(i=r.resourceAccess)||void 0===i?void 0:i.filter(e=>"Role"===e.type))||[],T=(null===(s=r.resourceAccess)||void 0===s?void 0:s.filter(e=>"Scope"===e.type))||[];return(0,n.jsxs)(A.A,{expanded:c===r.resourceAppId,onChange:u(r.resourceAppId),variant:"outlined",sx:{mb:1},children:[(0,n.jsx)(y.A,{expandIcon:(0,n.jsx)(f.A,{}),children:(0,n.jsxs)(d.A,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",sx:{width:"100%",mr:1},children:[(0,n.jsx)(a.A,{variant:"subtitle2",children:I||S?"Loading...":R}),(0,n.jsx)(d.A,{direction:"row",spacing:1,alignItems:"center",children:(0,n.jsx)(p.A,{color:"info",variant:"outlined",size:"small",label:"".concat(N.length,"/").concat(T.length),icon:(0,n.jsx)(h.A,{fontSize:"small",children:(0,n.jsx)(b.A,{})}),title:"Application/Delegated Permissions"})})]})}),(0,n.jsxs)(j.A,{children:[(I||S)&&(0,n.jsx)(l.A,{variant:"rectangular",height:100,sx:{mb:1}}),P&&F&&(0,n.jsxs)(n.Fragment,{children:[N.length>0&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsxs)(a.A,{variant:"body2",color:"primary",fontWeight:"medium",sx:{mb:1},children:["Application Permissions (",N.length,")"]}),(0,n.jsx)(m.A,{dense:!0,children:N.map((e,i)=>{let s=W(e.id,"Role");return(0,n.jsx)(v.Ay,{sx:{py:.5},children:(0,n.jsx)(g.A,{primary:s.name,secondary:s.description,primaryTypographyProps:{variant:"body2",fontWeight:"medium"},secondaryTypographyProps:{variant:"caption"}})},"app-".concat(e.id||i))})})]}),T.length>0&&(0,n.jsxs)(o.A,{children:[(0,n.jsxs)(a.A,{variant:"body2",color:"secondary",fontWeight:"medium",sx:{mb:1},children:["Delegated Permissions (",T.length,")"]}),(0,n.jsx)(m.A,{dense:!0,children:T.map((e,i)=>{let s=W(e.id,"Scope");return(0,n.jsx)(v.Ay,{sx:{py:.5},children:(0,n.jsx)(g.A,{primary:s.name,secondary:s.description,primaryTypographyProps:{variant:"body2",fontWeight:"medium"},secondaryTypographyProps:{variant:"caption"}})},"delegated-".concat(e.id||i))})})]})]})]})]},r.resourceAppId)},I=e=>{var i,s;let{applicationManifest:p,title:h,maxHeight:u}=e,[x,A]=(0,r.useState)(!1);null===(i=p.requiredResourceAccess)||void 0===i||i.map(e=>e.resourceAppId);let{data:y=[],isSuccess:j,isFetching:b,isLoading:f}=(0,w.R_)({url:"/api/ExecServicePrincipals",data:{Select:"appId,displayName,id"},queryKey:"execServicePrincipalList-cipp-permission-preview",waiting:!0}),P=e=>{if(j&&(null==y?void 0:y.Results)){let i=y.Results.find(i=>i.appId===e);return(null==i?void 0:i.id)||null}return null},I=e=>(i,s)=>{A(!!s&&e)};return(0,n.jsxs)(d.A,{spacing:2,children:[(0,n.jsx)(a.A,{variant:"subtitle1",children:h}),(0,n.jsx)(o.A,{sx:{height:"100%",overflow:"auto",maxHeight:u},children:(0,n.jsxs)(c.A,{variant:"outlined",sx:{p:2,borderLeftWidth:4,borderLeftColor:"warning.main"},children:[(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"h6",sx:{mb:1},children:p.displayName||"Custom Application"}),p.description&&(0,n.jsx)(a.A,{variant:"body2",color:"text.secondary",sx:{mb:2},children:p.description})]}),(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Application Properties:"}),(0,n.jsxs)(m.A,{dense:!0,children:[p.signInAudience&&(0,n.jsx)(v.Ay,{children:(0,n.jsx)(g.A,{primary:"Sign-in Audience",secondary:p.signInAudience})}),(null===(s=p.web)||void 0===s?void 0:s.redirectUris)&&p.web.redirectUris.length>0&&(0,n.jsx)(v.Ay,{children:(0,n.jsx)(g.A,{primary:"Redirect URIs",secondary:p.web.redirectUris.join(", ")})})]})]}),p.requiredResourceAccess&&p.requiredResourceAccess.length>0&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Required Permissions:"}),(f||b)&&(0,n.jsx)(l.A,{variant:"rectangular",height:100,sx:{mb:1}}),j&&(null==y?void 0:y.Results)&&p.requiredResourceAccess.map((e,i)=>{let s=P(e.resourceAppId);return(0,n.jsx)(S,{resource:e,servicePrincipalId:s,expandedResource:x,handleAccordionChange:I},e.resourceAppId)})]}),p.signInAudience&&"AzureADMyOrg"!==p.signInAudience&&(0,n.jsxs)(t.A,{severity:"error",sx:{mt:2,mb:2},children:[(0,n.jsxs)(a.A,{variant:"body2",fontWeight:"medium",children:['Invalid signInAudience: "',p.signInAudience,'"']}),(0,n.jsx)(a.A,{variant:"body2",children:'For security reasons, Application Manifests must have signInAudience set to "AzureADMyOrg" or not defined in the JSON. This template cannot be deployed with the current signInAudience value.'})]}),(0,n.jsx)(t.A,{severity:"warning",sx:{mt:2},children:"This application will be created from a custom manifest. All permissions and configuration are defined within the manifest JSON."})]})})]})},F=e=>{let{permissions:i,title:s="Permission Preview",isLoading:A=!1,maxHeight:y="100%",showAppIds:j=!0,galleryTemplate:f=null,applicationManifest:w=null}=e,[S,F]=(0,r.useState)(0),[W,R]=(0,r.useState)({}),[N,T]=(0,r.useState)([]),[C,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{i&&"object"==typeof i&&T(Object.keys(i))},[i]);let E=(0,r.useCallback)(async e=>{try{let i=await fetch("/api/ExecServicePrincipals?AppId=".concat(e)),s=await i.json();(null==s?void 0:s.Results)&&R(i=>({...i,[e]:s.Results}))}catch(i){console.error("Error fetching details for ".concat(e,":"),i)}},[]);(0,r.useEffect)(()=>{(async()=>{if(N.length>0){O(!0);let e=N.map(e=>E(e));await Promise.all(e),O(!1)}})()},[N,E]);let L=e=>{if(!e)return{app:0,delegated:0};let i=0,s=0;return Object.entries(e).forEach(e=>{var n,r,a,l;let[t,d]=e;d.applicationPermissions&&(i+=null!==(r=null==d?void 0:null===(n=d.applicationPermissions)||void 0===n?void 0:n.length)&&void 0!==r?r:0),d.delegatedPermissions&&(s+=null!==(l=null==d?void 0:null===(a=d.delegatedPermissions)||void 0===a?void 0:a.length)&&void 0!==l?l:0)}),{app:i,delegated:s}},k=e=>{let i=W[e];return(null==i?void 0:i.displayName)||e},D=(e,i,s)=>{var n,r;let a=W[e];if(!a)return null;if("application"===s){let e=null===(n=a.appRoles)||void 0===n?void 0:n.find(e=>e.id===i);return(null==e?void 0:e.description)||null}{let e=null===(r=a.publishedPermissionScopes)||void 0===r?void 0:r.find(e=>e.id===i);return(null==e?void 0:e.userConsentDescription)||(null==e?void 0:e.description)||null}};if(A||C)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.A,{variant:"subtitle1",children:s}),(0,n.jsx)(l.A,{variant:"rectangular",height:300})]});if(!i&&!f&&!w)return(0,n.jsx)(t.A,{severity:"info",children:"Select a template with permissions to see what will be consented."});if(f){var z,M,U,q,_,K,B,H,J;return(0,n.jsxs)(d.A,{spacing:2,children:[(0,n.jsx)(a.A,{variant:"subtitle1",children:s}),(0,n.jsx)(o.A,{sx:{height:"100%",overflow:"auto",maxHeight:y},children:(0,n.jsxs)(c.A,{variant:"outlined",sx:{p:2,borderLeftWidth:4,borderLeftColor:"primary.main"},children:[(0,n.jsxs)(o.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(null===(z=f.addedFields)||void 0===z?void 0:z.logoUrl)&&(0,n.jsx)(o.A,{sx:{mr:2},children:(0,n.jsx)("img",{src:f.addedFields.logoUrl,alt:(null===(M=f.addedFields)||void 0===M?void 0:M.displayName)||f.label,style:{width:48,height:48,objectFit:"contain",borderRadius:4},onError:e=>{e.target.style.display="none"}})}),(0,n.jsxs)(o.A,{children:[(0,n.jsx)(a.A,{variant:"h6",fontWeight:"bold",children:(null===(U=f.addedFields)||void 0===U?void 0:U.displayName)||f.label}),(null===(q=f.addedFields)||void 0===q?void 0:q.publisher)&&(0,n.jsxs)(a.A,{variant:"body2",color:"text.secondary",children:["by ",f.addedFields.publisher]})]})]}),(null===(_=f.addedFields)||void 0===_?void 0:_.description)&&(0,n.jsx)(o.A,{sx:{mb:2},children:(0,n.jsx)(a.A,{variant:"body2",color:"text.primary",children:f.addedFields.description})}),(null===(K=f.addedFields)||void 0===K?void 0:K.categories)&&f.addedFields.categories.length>0&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Categories:"}),(0,n.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.addedFields.categories.map((e,i)=>(0,n.jsx)(p.A,{label:e,size:"small",variant:"outlined",color:"primary"},i))})]}),(null===(B=f.addedFields)||void 0===B?void 0:B.supportedSingleSignOnModes)&&f.addedFields.supportedSingleSignOnModes.length>0&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Supported SSO Modes:"}),(0,n.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.addedFields.supportedSingleSignOnModes.map((e,i)=>(0,n.jsx)(p.A,{label:e,size:"small",variant:"outlined",color:"secondary"},i))})]}),(null===(H=f.addedFields)||void 0===H?void 0:H.supportedProvisioningTypes)&&f.addedFields.supportedProvisioningTypes.length>0&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Supported Provisioning:"}),(0,n.jsx)(o.A,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:f.addedFields.supportedProvisioningTypes.map((e,i)=>(0,n.jsx)(p.A,{label:e,size:"small",variant:"outlined",color:"info"},i))})]}),(null===(J=f.addedFields)||void 0===J?void 0:J.homePageUrl)&&(0,n.jsxs)(o.A,{sx:{mb:2},children:[(0,n.jsx)(a.A,{variant:"body2",fontWeight:"medium",sx:{mb:1},children:"Home Page:"}),(0,n.jsx)(a.A,{variant:"body2",component:"a",href:f.addedFields.homePageUrl,target:"_blank",rel:"noopener noreferrer",sx:{color:"primary.main",textDecoration:"none"},children:f.addedFields.homePageUrl})]}),(0,n.jsx)(o.A,{sx:{mt:2,pt:2,borderTop:1,borderColor:"divider"},children:(0,n.jsxs)(a.A,{variant:"caption",color:"text.secondary",children:["Template ID: ",f.value]})}),(0,n.jsx)(t.A,{severity:"info",sx:{mt:2},children:"Gallery templates will automatically consent to the required permissions defined in the template's app registration. No manual permission configuration needed."})]})})]})}return w?(0,n.jsx)(I,{applicationManifest:w,title:s,maxHeight:y}):"object"!=typeof i||null===i||0===Object.keys(i).length?(0,n.jsx)(t.A,{severity:"warning",children:"No permissions data available in this template."}):(0,n.jsxs)(d.A,{spacing:2,children:[(0,n.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(a.A,{variant:"subtitle1",children:s}),(0,n.jsx)(p.A,{color:"info",variant:"outlined",size:"small",label:"".concat(L(i).app,"/").concat(L(i).delegated),icon:(0,n.jsx)(h.A,{fontSize:"small",children:(0,n.jsx)(b.A,{})}),title:"Application/Delegated Permissions"})]}),(0,n.jsxs)(o.A,{sx:{height:"100%",overflow:"auto",maxHeight:y},children:[(0,n.jsx)(o.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,n.jsxs)(u.A,{value:S,onChange:(e,i)=>{F(i)},"aria-label":"permission tabs",size:"small",children:[(0,n.jsx)(x.A,{label:"All Permissions"}),(0,n.jsx)(x.A,{label:"Application"}),(0,n.jsx)(x.A,{label:"Delegated"})]})}),(0,n.jsx)(P.K,{value:S,index:0,children:(0,n.jsx)(o.A,{children:Object.entries(i).map(e=>{let[i,s]=e,r=k(i),l=s.applicationPermissions&&s.applicationPermissions.length>0,t=s.delegatedPermissions&&s.delegatedPermissions.length>0;return(0,n.jsx)(o.A,{sx:{my:2},children:(0,n.jsxs)(c.A,{variant:"outlined",sx:{p:2,borderLeftWidth:4,borderLeftColor:"00000003-0000-0000-c000-000000000000"===i?"primary.main":"secondary.main"},children:[(0,n.jsxs)(a.A,{variant:"subtitle2",fontWeight:"bold",children:[r,j&&(0,n.jsx)(a.A,{component:"span",variant:"caption",sx:{ml:1,color:"text.secondary"},children:i})]}),l&&(0,n.jsxs)(o.A,{sx:{mt:1},children:[(0,n.jsxs)(a.A,{variant:"body2",color:"primary",fontWeight:"medium",children:["Application Permissions (",s.applicationPermissions.length,")"]}),(0,n.jsx)(m.A,{dense:!0,disablePadding:!0,children:s.applicationPermissions.map((e,s)=>{let r=D(i,e.id,"application")||e.description||"No description available";return(0,n.jsx)(v.Ay,{sx:{py:0},children:(0,n.jsx)(g.A,{primary:e.value||e.id,secondary:r,primaryTypographyProps:{variant:"caption"},secondaryTypographyProps:{variant:"caption"}})},"app-".concat(e.id||s))})})]}),t&&(0,n.jsxs)(o.A,{sx:{mt:+!!l},children:[(0,n.jsxs)(a.A,{variant:"body2",color:"secondary",fontWeight:"medium",children:["Delegated Permissions (",s.delegatedPermissions.length,")"]}),(0,n.jsx)(m.A,{dense:!0,disablePadding:!0,children:s.delegatedPermissions.map((e,s)=>{let r=D(i,e.id,"delegated")||e.description||"No description available";return(0,n.jsx)(v.Ay,{sx:{py:0},children:(0,n.jsx)(g.A,{primary:e.value||e.id,secondary:r,primaryTypographyProps:{variant:"caption"},secondaryTypographyProps:{variant:"caption"}})},"delegated-".concat(e.id||s))})})]})]})},i)})})}),(0,n.jsx)(P.K,{value:S,index:1,children:(0,n.jsxs)(o.A,{children:[Object.entries(i).filter(e=>{let[i,s]=e;return s.applicationPermissions&&s.applicationPermissions.length>0}).map(e=>{let[i,s]=e,r=k(i);return(0,n.jsx)(o.A,{sx:{my:2},children:(0,n.jsxs)(c.A,{variant:"outlined",sx:{p:1},children:[(0,n.jsxs)(a.A,{variant:"subtitle2",fontWeight:"bold",children:[r,j&&(0,n.jsx)(a.A,{component:"span",variant:"caption",sx:{ml:1,color:"text.secondary"},children:i})]}),(0,n.jsx)(m.A,{dense:!0,disablePadding:!0,children:s.applicationPermissions.map((e,s)=>{let r=D(i,e.id,"application")||e.description||"No description available";return(0,n.jsx)(v.Ay,{sx:{py:0},children:(0,n.jsx)(g.A,{primary:e.value||e.id,secondary:r,primaryTypographyProps:{variant:"caption"},secondaryTypographyProps:{variant:"caption"}})},"app-".concat(e.id||s))})})]})},"app-".concat(i))}),!Object.values(i).some(e=>e.applicationPermissions&&e.applicationPermissions.length>0)&&(0,n.jsx)(t.A,{severity:"info",children:"No application permissions in this template."})]})}),(0,n.jsx)(P.K,{value:S,index:2,children:(0,n.jsxs)(o.A,{children:[Object.entries(i).filter(e=>{let[i,s]=e;return s.delegatedPermissions&&s.delegatedPermissions.length>0}).map(e=>{let[i,s]=e,r=k(i);return(0,n.jsx)(o.A,{sx:{my:2},children:(0,n.jsxs)(c.A,{variant:"outlined",sx:{p:1},children:[(0,n.jsxs)(a.A,{variant:"subtitle2",fontWeight:"bold",children:[r,j&&(0,n.jsx)(a.A,{component:"span",variant:"caption",sx:{ml:1,color:"text.secondary"},children:i})]}),(0,n.jsx)(m.A,{dense:!0,disablePadding:!0,children:s.delegatedPermissions.map((e,s)=>{let r=D(i,e.id,"delegated")||e.description||"No description available";return(0,n.jsx)(v.Ay,{sx:{py:0},children:(0,n.jsx)(g.A,{primary:e.value||e.id,secondary:r,primaryTypographyProps:{variant:"caption"},secondaryTypographyProps:{variant:"caption"}})},"delegated-".concat(e.id||s))})})]})},"delegated-".concat(i))}),!Object.values(i).some(e=>e.delegatedPermissions&&e.delegatedPermissions.length>0)&&(0,n.jsx)(t.A,{severity:"info",children:"No delegated permissions in this template."})]})})]})]})}},68978:(e,i,s)=>{s.d(i,{K:()=>a});var n=s(37876),r=s(67578);let a=e=>{let{children:i,value:s,index:a,...l}=e;return(0,n.jsx)("div",{role:"tabpanel",hidden:s!==a,id:"simple-tabpanel-".concat(a),"aria-labelledby":"simple-tab-".concat(a),...l,children:s===a&&(0,n.jsx)(r.A,{children:i})})}},81514:(e,i,s)=>{s.d(i,{A:()=>r});var n=s(14232);let r=n.forwardRef(function(e,i){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z"}))})}}]);
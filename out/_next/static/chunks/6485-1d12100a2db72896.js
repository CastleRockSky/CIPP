"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6485],{1759:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(14232);let l=i.forwardRef(function(e,t){let{title:a,titleId:l,...r}=e;return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},r),a?i.createElement("title",{id:l},a):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))})},42120:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(93944),l=a(37876);let r=(0,i.A)((0,l.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")},58181:(e,t,a)=>{a.d(t,{H:()=>s});var i=a(37876),l=a(58105),r=a(88992),n=a(17825);let s=e=>{let{formControl:t,name:a,label:s,allTenants:o=!1,multiple:c=!1,type:d="multiple",select:m,addedField:u,valueField:p,dataFilter:x=null,...f}=e,h=(0,r.FH)({control:t.control,name:"tenantFilter"}),b=(0,n.t)().currentTenant;return(0,i.jsx)(l.o,{name:a,label:s,type:"autoComplete",formControl:t,multiple:c,api:{addedField:u,tenantFilter:h?h.value:b,url:"/api/ListGraphRequest",dataKey:"Results",labelField:e=>"".concat(e.displayName," (").concat(e.userPrincipalName,")"),valueField:p||"id",queryKey:"ListUsers-".concat((null==h?void 0:h.value)?h.value:b,"-").concat(m||"default"),data:{Endpoint:"users",manualPagination:!0,$select:m||"id,userPrincipalName,displayName",$count:!0,$orderby:"displayName",$top:999},dataFilter:e=>x?e.filter(x):e},creatable:!1,...f})}},58656:(e,t,a)=>{a.d(t,{w:()=>s});var i=a(37876),l=a(58105),r=a(88992),n=a(17825);let s=e=>{let{formControl:t,name:a,label:s,allTenants:o=!1,type:c="multiple",multiple:d=!1,...m}=e,u=(0,r.FH)({control:t.control,name:"tenantFilter"}),p=(0,n.t)().currentTenant;return(0,i.jsx)(l.o,{name:a,label:s,type:"autoComplete",formControl:t,multiple:d,api:{autoSelectFirstItem:!0,tenantFilter:u?u.value:p,queryKey:"listDomains-".concat((null==u?void 0:u.value)?u.value:p),url:"/api/ListGraphRequest",dataKey:"Results",labelField:e=>"".concat(e.id),valueField:"id",data:{Endpoint:"domains",manualPagination:!0,$count:!0,$top:99}},...m})}},79026:(e,t,a)=>{a.d(t,{H:()=>D,uF:()=>k});var i=a(37876),l=a(14232),r=a(59568),n=a(58105),s=a(77018),o=a(58181),c=a(88992),d=a(17825);let m=e=>{let{formControl:t,name:a,label:l,allTenants:r=!1,multiple:s=!1,type:o="multiple",select:m,addedField:u,creatable:p=!1,...x}=e,f=(0,c.FH)({control:t.control,name:"tenantFilter"}),h=(0,d.t)().currentTenant;return(0,i.jsx)(n.o,{name:a,label:l,type:"autoComplete",formControl:t,multiple:s,api:{addedField:u,tenantFilter:f?f.value:h,url:"/api/ListGraphRequest",dataKey:"Results",labelField:e=>e.displayName,valueField:"id",queryKey:"ListGroups-".concat((null==f?void 0:f.value)?f.value:h),data:{Endpoint:"groups",manualPagination:!0,$select:m||"id,displayName,description",$count:!0,$orderby:"displayName",$top:999}},creatable:p,...x})};var u=a(58656),p=a(95062),x=a.n(p),f=a(54538),h=a(22474),b=a(24422),A=a(94810),y=a(76776),j=a(71538),g=a(17675),S=a(47737),v=a(94760);let T=l.forwardRef(function(e,t){let{title:a,titleId:i,...r}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":i},r),a?l.createElement("title",{id:i},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9"}))});var C=a(72448);let E=e=>{let{isFetching:t,actionLink:a,actionText:l,value:r,icon:n,label:o,cardSize:c,...d}=e;return(0,i.jsxs)(f.A,{...d,children:[(0,i.jsxs)(h.A,{alignItems:"center",direction:"row",spacing:2,sx:{p:2},children:[(0,i.jsx)(b.A,{sx:{backgroundColor:"primary.alpha12",color:"primary.main"},children:(0,i.jsx)(A.A,{fontSize:"small",children:n||(0,i.jsx)(T,{})})}),(0,i.jsxs)("div",{children:[(0,i.jsx)(s.A,{color:"text.secondary",variant:"overline",children:t?(0,i.jsx)(y.A,{width:150}):o}),(0,i.jsx)(s.A,{variant:"h6",children:t?(0,i.jsx)(y.A,{width:200}):r})]})]}),a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.A,{}),(0,i.jsx)(g.A,{sx:{px:3,py:1},children:(0,i.jsx)(S.A,{color:"inherit",component:v.A,endIcon:(0,i.jsx)(A.A,{fontSize:"small",children:(0,i.jsx)(C.A,{})}),href:a,size:"small",children:l})})]})]})};E.propTypes={action:x().node,icon:x().node,label:x().string.isRequired,value:x().number.isRequired};var F=a(1759),w=a(66113),N=a(22322);let k={formatStringToArray:e=>e&&""!==e?"string"==typeof e?e.split(",").map(e=>e.trim()).filter(e=>""!==e):e:[],processDomainField:e=>e?"string"==typeof e?k.formatStringToArray(e):Array.isArray(e)?e.length>0&&"string"==typeof e[0]?e:e.map(e=>e.id||e):[]:[],processGroupField:e=>Array.isArray(e)?e.length>0&&"string"==typeof e[0]?e:e.map(e=>e.id||e):[],createDataFormatter:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i=>{let l=e.getValues(),r={PolicyName:i.PolicyName,tenantFilter:i.tenantFilter,EnableSafeLinksForEmail:i.EnableSafeLinksForEmail,EnableSafeLinksForTeams:i.EnableSafeLinksForTeams,EnableSafeLinksForOffice:i.EnableSafeLinksForOffice,TrackClicks:i.TrackClicks,AllowClickThrough:i.AllowClickThrough,ScanUrls:i.ScanUrls,EnableForInternalSenders:i.EnableForInternalSenders,DeliverMessageAfterScan:i.DeliverMessageAfterScan,DisableUrlRewrite:i.DisableUrlRewrite,DoNotRewriteUrls:Array.isArray(i.DoNotRewriteUrls)?i.DoNotRewriteUrls:[],AdminDisplayName:i.AdminDisplayName,CustomNotificationText:i.CustomNotificationText,EnableOrganizationBranding:i.EnableOrganizationBranding,RuleName:l.RuleName,Priority:l.Priority,Comments:l.Comments,SentTo:l.SentTo,ExceptIfSentTo:l.ExceptIfSentTo,SentToMemberOf:k.processGroupField(l.SentToMemberOf),ExceptIfSentToMemberOf:k.processGroupField(l.ExceptIfSentToMemberOf),RecipientDomainIs:k.processDomainField(l.RecipientDomainIs),ExceptIfRecipientDomainIs:k.processDomainField(l.ExceptIfRecipientDomainIs)};switch(t){case"add":case"edit":return{...r,State:l.State};case"template":return{...r,ID:a.ID,TemplateName:i.TemplateName,TemplateDescription:i.TemplateDescription,State:l.State?"Enabled":"Disabled"};case"createTemplate":return{...r,TemplateName:i.TemplateName,TemplateDescription:i.TemplateDescription,AdminDisplayName:i.AdminDisplayName||i.Description,State:l.State};default:return r}}},populateFormData:function(e,t,a){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"edit",l={tenantFilter:a.currentTenant,PolicyName:t.PolicyName,EnableSafeLinksForEmail:t.EnableSafeLinksForEmail,EnableSafeLinksForTeams:t.EnableSafeLinksForTeams,EnableSafeLinksForOffice:t.EnableSafeLinksForOffice,TrackClicks:t.TrackClicks,AllowClickThrough:t.AllowClickThrough,ScanUrls:t.ScanUrls,EnableForInternalSenders:t.EnableForInternalSenders,DeliverMessageAfterScan:t.DeliverMessageAfterScan,DisableUrlRewrite:t.DisableUrlRewrite,DoNotRewriteUrls:t.DoNotRewriteUrls,AdminDisplayName:t.AdminDisplayName,CustomNotificationText:t.CustomNotificationText,EnableOrganizationBranding:t.EnableOrganizationBranding,RuleName:t.RuleName,Priority:t.Priority,Comments:t.Comments,State:t.State,SentTo:t.SentTo||[],ExceptIfSentTo:t.ExceptIfSentTo||[],SentToMemberOf:t.SentToMemberOf||[],ExceptIfSentToMemberOf:t.ExceptIfSentToMemberOf||[],RecipientDomainIs:t.RecipientDomainIs||[],ExceptIfRecipientDomainIs:t.ExceptIfRecipientDomainIs||[]};"template"===i&&(l.TemplateName=t.TemplateName,l.TemplateDescription=t.TemplateDescription),e.reset(l)}},D=e=>{let{formControl:t,formType:a="add"}=e,{watch:c,setError:p,clearErrors:x}=t,f=c("DoNotRewriteUrls"),h=c("PolicyName"),[b,A]=(0,l.useState)(!0),y=(0,d.t)(),j="add"===a||"createTemplate"===a,g=(0,N.R_)({url:"/api/ListSafeLinksPolicy?tenantFilter=".concat(y.currentTenant),queryKey:"SafeLinksPolicy-List-".concat(y.currentTenant),enabled:j}),S="createTemplate"===a,v=(0,N.R_)({url:"/api/ListSafeLinksPolicyTemplates",queryKey:"SafeLinksTemplates-List",enabled:S}),T=e=>{if(!e)return!0;if(e.includes("*")||e.includes("~")){let t=(0,w.n)(e,"wildcardUrl"),a=(0,w.n)(e,"wildcardDomain");return!0===t||!0===a}let t=(0,w.n)(e,"hostname"),a=(0,w.n)(e,"url"),i=(0,w.n)(e,"domain");return!0===t||!0===a||!0===i};return(0,l.useEffect)(()=>{j&&(g.isSuccess||g.error)&&t.trigger("PolicyName")},[g.isSuccess,g.error,g.data,j,t]),(0,l.useEffect)(()=>{S&&(v.isSuccess||v.error)&&t.trigger("TemplateName")},[v.isSuccess,v.error,v.data,S,t]),(0,l.useEffect)(()=>{if(!f||0===f.length){x("DoNotRewriteUrls"),A(!0);return}let e=!1;for(let t of f){let a="string"==typeof t?t:(null==t?void 0:t.value)||(null==t?void 0:t.label)||"";if(a&&!T(a)){e=!0;break}}e?(p("DoNotRewriteUrls",{type:"validate",message:"Not a valid URL, domain, or pattern"}),A(!1)):(x("DoNotRewriteUrls"),A(!0))},[f,p,x]),(0,l.useEffect)(()=>{if(h&&(t.setValue("SafeLinksPolicy",h),"add"===a||"createTemplate"===a)){let e="".concat(h,"_Rule");t.setValue("RuleName",e)}},[h,a,t]),(0,i.jsxs)(r.A,{container:!0,spacing:2,children:[("template"===a||"createTemplate"===a)&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h5",sx:{mb:2},children:"Template Information"})}),(0,i.jsx)(r.A,{size:{xs:12,md:6},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Template Name",name:"TemplateName",required:!0,formControl:t,helperText:v.isFetching&&S?"Checking for duplicate names...":void 0,validators:{required:"Template name is required",validate:{duplicateName:e=>!S||!e||!!v.isFetching||!!v.error||!(v.isSuccess&&v.data&&v.data.map(e=>{var t;return null===(t=e.name)||void 0===t?void 0:t.toLowerCase()}).filter(Boolean).includes(e.toLowerCase()))||"A template with this name already exists"}}})}),(0,i.jsx)(r.A,{size:{xs:12,md:6},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Template Description",name:"TemplateDescription",formControl:t,helperText:"Describe what this template is used for"})})]}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h5",sx:{mb:2},children:"Safe Links Policy Configuration"})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h6",children:"Policy Settings"})}),(0,i.jsx)(r.A,{size:{xs:12,md:6},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Policy Name",name:"PolicyName",required:!0,formControl:t,disabled:"edit"===a||"template"===a,validators:{required:"Policy name is required",validate:{validatePolicyName:e=>{if(!j||!e||g.isFetching||g.error)return!0;if(g.isSuccess&&g.data){if(g.data.map(e=>{var t;return null===(t=e.PolicyName)||void 0===t?void 0:t.toLowerCase()}).filter(Boolean).includes(e.toLowerCase()))return"A policy with this name already exists";let t=e.toLowerCase();if(t.startsWith("built-in protection policy")||t.startsWith("standard preset security policy")||t.startsWith("strict preset security policy"))return"This name is reserved for built-in policies"}return!0}}}})}),(0,i.jsx)(r.A,{size:{xs:12,md:6},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Description",name:"AdminDisplayName",formControl:t})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable Safe Links For Email",name:"EnableSafeLinksForEmail",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable Safe Links For Teams",name:"EnableSafeLinksForTeams",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable Safe Links For Office",name:"EnableSafeLinksForOffice",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Track Clicks",name:"TrackClicks",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Scan URLs",name:"ScanUrls",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable For Internal Senders",name:"EnableForInternalSenders",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Allow Click Through",name:"AllowClickThrough",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Disable URL Rewrite",name:"DisableUrlRewrite",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable Organization Branding",name:"EnableOrganizationBranding",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:3},sx:{my:2},children:(0,i.jsx)(n.A,{type:"switch",label:"Deliver Message After Scan",name:"DeliverMessageAfterScan",formControl:t,defaultValue:!1})}),(0,i.jsx)(r.A,{size:{xs:12,md:9},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Custom Notification Text",name:"CustomNotificationText",formControl:t,multiline:!0,rows:2,disabled:!c("DeliverMessageAfterScan")})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(n.A,{type:"autoComplete",createable:!0,formControl:t,name:"DoNotRewriteUrls",label:"Do Not Rewrite URLs",placeholder:"Enter domain patterns (one per line for multiple entries)",helperText:"Enter URLs, domains, or wildcard patterns (e.g., *.example.com, https://example.com)",validators:{validate:{format:()=>b||"Not a valid URL, domain, or pattern"}}})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h5",sx:{mb:2},children:"Safe Links Rule Configuration"})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h6",children:"Rule Information"})}),(0,i.jsx)(r.A,{size:{xs:12,md:6},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,disabled:!0,label:"Rule Name (Auto-generated)",name:"RuleName",formControl:t})}),(0,i.jsx)(r.A,{size:{xs:12,md:4},children:(0,i.jsx)(n.A,{type:"number",fullWidth:!0,label:"Priority",name:"Priority",formControl:t,validators:{type:"number",min:{value:0,message:"Priority must be a non-negative number"}},helperText:"Lower numbers have higher priority"})}),(0,i.jsx)(r.A,{size:{xs:12,md:2},children:(0,i.jsx)(n.A,{type:"switch",label:"Enable Rule",name:"State",formControl:t,defaultValue:!0})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(n.A,{type:"textField",fullWidth:!0,label:"Comments",name:"Comments",formControl:t,multiline:!0,rows:2})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h6",children:"Applies To:"})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(u.w,{formControl:t,name:"RecipientDomainIs",label:"Domains",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(m,{formControl:t,name:"SentToMemberOf",label:"Groups",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(o.H,{formControl:t,name:"SentTo",label:"Recipients",valueField:"userPrincipalName",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(s.A,{variant:"h6",children:"Exceptions:"})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(u.w,{formControl:t,name:"ExceptIfRecipientDomainIs",label:"Domains",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(m,{formControl:t,name:"ExceptIfSentToMemberOf",label:"Groups",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(o.H,{formControl:t,name:"ExceptIfSentTo",label:"Recipients",valueField:"userPrincipalName",multiple:!0,createable:!1})}),(0,i.jsx)(r.A,{size:{xs:12},children:(0,i.jsx)(E,{icon:(0,i.jsx)(F.A,{}),label:"Propagation Time",value:"Changes to Safe Links policies and rules may take up to 6 hours to propagate throughout your organization.",isFetching:!1})})]})}},90240:(e,t,a)=>{a.d(t,{A:()=>j});var i=a(37876),l=a(89099),r=a(67578),n=a(86650),s=a(22474),o=a(47737),c=a(94810),d=a(77018),m=a(54538),u=a(24933),p=a(17675),x=a(42120),f=a(22322),h=a(68723),b=a(14232),A=a(88992),y=a(2303);let j=e=>{let{title:t,backButtonTitle:a,titleButton:j,formPageType:g="Add",children:S,queryKey:v,formControl:T,postUrl:C,customDataformatter:E,resetForm:F=!1,hideBackButton:w=!1,hidePageType:N=!1,hideTitle:k=!1,hideSubmit:D=!1,allowResubmit:R=!1,addedButtons:L,...z}=e,I=(0,l.useRouter)(),P=(0,f.nN)({datafromUrl:!0,relatedQueryKeys:v}),{isValid:U,isDirty:O}=(0,A.lN)({control:T.control});return(0,b.useEffect)(()=>{if(delete I.query.tenantFilter,I.query){let e={...T.getValues(),...I.query};T.reset(e)}},[I]),(0,b.useEffect)(()=>{P.isSuccess&&F&&T.reset()},[P.isSuccess]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(y.v,{title:t}),(0,i.jsx)(r.A,{sx:{flexGrow:1,py:4},children:(0,i.jsx)(n.A,{maxWidth:"lg",children:(0,i.jsxs)(s.A,{spacing:4,children:[!k&&(0,i.jsxs)(s.A,{spacing:2,children:[!w&&(0,i.jsx)("div",{children:(0,i.jsx)(o.A,{color:"inherit",onClick:()=>{I.back()},startIcon:(0,i.jsx)(c.A,{fontSize:"small",children:(0,i.jsx)(x.A,{})}),children:a})}),(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)(d.A,{variant:"h4",children:[!N&&(0,i.jsxs)(i.Fragment,{children:[g," - "]}),t]}),j&&j]})]}),(0,i.jsxs)(m.A,{children:[(0,i.jsxs)(u.A,{children:[S,(0,i.jsx)(h.v,{apiObject:P})]}),!D&&(0,i.jsx)(p.A,{sx:{justifyContent:"flex-end"},children:(0,i.jsxs)(s.A,{spacing:2,direction:"row",children:[L&&L,(0,i.jsx)(o.A,{disabled:P.isPending||!U||!R&&!O,onClick:T.handleSubmit(()=>{if(T.trigger(),!U)return;let e=E?E(T.getValues()):T.getValues();Object.keys(e).forEach(t=>{(""===e[t]||null===e[t])&&delete e[t]}),P.mutate({url:C,data:e})}),type:"submit",variant:"contained",children:"Submit"})]})})]})]})})})]})}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[319],{36271:(e,l,i)=>{i.d(l,{A:()=>v});var a=i(37876),p=i(14232),t=i(22474),s=i(77018),n=i(76776),r=i(46061),o=i(67578),d=i(47737),m=i(58105),u=i(46402),c=i(68723),y=i(59568),A=i(68396),f=i(88992);let v=e=>{var l;let{formControl:i,templateData:v,templateLoading:T,isEditing:I,isCopy:g,updatePermissions:h,onSubmit:x,refetchKey:N}=e,[M,b]=(0,p.useState)(null),[j,S]=(0,p.useState)(!1),P=(0,f.FH)({control:null==i?void 0:i.control,name:"appType",defaultValue:"EnterpriseApp"}),F=(0,f.FH)({control:null==i?void 0:i.control,name:"galleryTemplateId"}),G=(0,f.FH)({control:null==i?void 0:i.control,name:"applicationManifest"}),V=(0,f.FH)({control:null==i?void 0:i.control,name:"appId"});(0,p.useEffect)(()=>{if(i){if(I||g){if(v&&g){if(v[0]){let e="Copy of ".concat(v[0].TemplateName);i.setValue("templateName",e);let l=v[0].AppType||(v[0].GalleryTemplateId?"GalleryTemplate":v[0].ApplicationManifest?"ApplicationManifest":"EnterpriseApp");if(i.setValue("appType",l),"GalleryTemplate"===l?i.setValue("galleryTemplateId",{label:v[0].AppName||"Unknown",value:v[0].GalleryTemplateId,addedFields:{displayName:v[0].AppName,applicationId:v[0].AppId,...v[0].GalleryInformation||{}}}):"ApplicationManifest"===l?v[0].ApplicationManifest&&i.setValue("applicationManifest",JSON.stringify(v[0].ApplicationManifest,null,2)):i.setValue("appId",{label:"".concat(v[0].AppName||"Unknown"," (").concat(v[0].AppId,")"),value:v[0].AppId,addedFields:{displayName:v[0].AppName}}),"EnterpriseApp"===l){let e={label:v[0].PermissionSetName||"Custom Permissions",value:v[0].PermissionSetId,addedFields:{Permissions:v[0].Permissions||{}}};i.setValue("permissionSetId",e),b(e),S(!0)}else b(null),S(!1)}}else if(v&&v[0]){i.setValue("templateName",v[0].TemplateName);let e=v[0].AppType||(v[0].GalleryTemplateId?"GalleryTemplate":v[0].ApplicationManifest?"ApplicationManifest":"EnterpriseApp");if(i.setValue("appType",e),"GalleryTemplate"===e?i.setValue("galleryTemplateId",{label:v[0].AppName||"Unknown",value:v[0].GalleryTemplateId,addedFields:{displayName:v[0].AppName,applicationId:v[0].AppId,...v[0].GalleryInformation||{}}}):"ApplicationManifest"===e?v[0].ApplicationManifest&&i.setValue("applicationManifest",JSON.stringify(v[0].ApplicationManifest,null,2)):i.setValue("appId",{label:"".concat(v[0].AppName||"Unknown"," (").concat(v[0].AppId,")"),value:v[0].AppId,addedFields:{displayName:v[0].AppName}}),"EnterpriseApp"===e){let e={label:v[0].PermissionSetName||"Custom Permissions",value:v[0].PermissionSetId,addedFields:{Permissions:v[0].Permissions||{}}};i.setValue("permissionSetId",e),b(e),S(!0)}else b(null),S(!1)}}else i.setValue("templateName","New App Deployment Template"),i.setValue("appType","EnterpriseApp"),S(!1)}},[v,g,I,i]),(0,p.useEffect)(()=>{if(i&&!I&&!g){let l=i.getValues("templateName");if("New App Deployment Template"===l||!l){let l=null;if("GalleryTemplate"===P&&F){var e;l=(null===(e=F.addedFields)||void 0===e?void 0:e.displayName)||F.label}else"EnterpriseApp"===P&&V&&(l=V.label.split(" (")[0]);l&&i.setValue("templateName","".concat(l," Template"))}}},[V,F,P,I,g,i]);let E=(0,f.FH)({control:null==i?void 0:i.control,name:"permissionSetId"});return(0,p.useEffect)(()=>{(null==E?void 0:E.value)?(b(E),S(!0)):(b(null),S(!1))},[E]),(0,p.useEffect)(()=>{if(I||g){var e;(null==v?void 0:null===(e=v[0])||void 0===e?void 0:e.Permissions)&&S(!0)}},[I,g,v]),(0,a.jsxs)(y.A,{container:!0,spacing:2,sx:{mb:2},children:[(0,a.jsx)(y.A,{size:{xs:12,sm:6},children:(0,a.jsxs)(t.A,{spacing:2,children:[(0,a.jsx)(s.A,{variant:"h6",children:"App Approval Template Details"}),T&&(0,a.jsx)(n.A,{variant:"rectangular",height:300}),(!T||!I)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r.A,{severity:"info",children:["App approval templates allow you to define an application with its permissions that can be deployed to multiple tenants. Choose from three template types:",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"• Enterprise Application:"}),' Deploy existing multi-tenant apps from your tenant. Requires "Multiple organizations" or "Personal Microsoft accounts" in App Registration settings.',(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"• Gallery Template:"})," Deploy pre-configured applications from Microsoft's Enterprise Application Gallery with standard permissions.",(0,a.jsx)("br",{}),(0,a.jsx)("strong",{children:"• Application Manifest:"})," Deploy custom applications using JSON manifests. For security, only single-tenant apps (AzureADMyOrg) are supported."]}),(0,a.jsx)(m.o,{formControl:i,name:"templateName",label:"Template Name",type:"textField",validators:{required:"Template name is required"}}),(0,a.jsx)(m.o,{formControl:i,name:"appType",label:"Application Type",type:"select",clearable:!1,options:[{label:"Enterprise Application",value:"EnterpriseApp"},{label:"Gallery Template",value:"GalleryTemplate"},{label:"Application Manifest",value:"ApplicationManifest"}],creatable:!1,required:!0,validators:{required:"Application type is required"}}),(0,a.jsx)(u.A,{field:"appType",compareType:"is",compareValue:"EnterpriseApp",formControl:i,children:(0,a.jsx)(m.o,{formControl:i,name:"appId",label:"Select Enterprise Application",type:"autoComplete",api:{url:"/api/ExecServicePrincipals",queryKey:"execServicePrincipals",dataKey:"Results",labelField:e=>"".concat(e.displayName," (").concat(e.appId,")"),valueField:"appId",addedField:{displayName:"displayName",signInAudience:"signInAudience"},dataFilter:e=>e.filter(e=>{var l,i;return(null===(l=e.addedFields)||void 0===l?void 0:l.signInAudience)==="AzureADMultipleOrgs"||(null===(i=e.addedFields)||void 0===i?void 0:i.signInAudience)==="AzureADandPersonalMicrosoftAccount"}),showRefresh:!0},multiple:!1,creatable:!1,required:!0,validators:{required:"Application is required"}})}),(0,a.jsx)(u.A,{field:"appType",compareType:"is",compareValue:"GalleryTemplate",formControl:i,children:(0,a.jsx)(m.o,{formControl:i,name:"galleryTemplateId",label:"Select Gallery Template",type:"autoComplete",api:{url:"/api/ListGraphRequest",queryKey:"listApplicationTemplates",data:{Endpoint:"applicationTemplates",$select:"id,displayName,description,categories,publisher,logoUrl,homePageUrl,supportedSingleSignOnModes,supportedProvisioningTypes",$top:999},dataKey:"Results",labelField:e=>e.displayName,valueField:"id",addedField:{displayName:"displayName",applicationId:"applicationId",description:"description",categories:"categories",publisher:"publisher",logoUrl:"logoUrl",homePageUrl:"homePageUrl",supportedSingleSignOnModes:"supportedSingleSignOnModes",supportedProvisioningTypes:"supportedProvisioningTypes"},showRefresh:!0},multiple:!1,creatable:!1,required:!0,sortOptions:!0,validators:{required:"Gallery template is required"}})}),(0,a.jsx)(u.A,{field:"appType",compareType:"is",compareValue:"ApplicationManifest",formControl:i,children:(0,a.jsx)(m.o,{formControl:i,name:"applicationManifest",label:"Application Manifest (JSON)",type:"textField",multiline:!0,rows:10,helperText:"Paste your application manifest JSON here. Use the 'Microsoft Graph App Manifest' format. For security reasons, signInAudience must be 'AzureADMyOrg' or not specified.",validators:{required:"Application manifest is required",validate:e=>{try{let l=JSON.parse(e);if(!l.displayName)return"Application manifest must include a 'displayName' property";if(l.signInAudience&&"AzureADMyOrg"!==l.signInAudience)return"signInAudience must be null, undefined, or 'AzureADMyOrg' for security reasons";return!0}catch(e){return"Invalid JSON format"}}}})}),(0,a.jsx)(u.A,{field:"appType",compareType:"is",compareValue:"EnterpriseApp",formControl:i,children:(0,a.jsx)(m.o,{formControl:i,name:"permissionSetId",label:"Select Permission Set",type:"autoComplete",api:{url:"/api/ExecAppPermissionTemplate",queryKey:"execAppPermissionTemplate",labelField:e=>e.TemplateName,valueField:"TemplateId",addedField:{Permissions:"Permissions"},showRefresh:!0},multiple:!1,creatable:!1,required:!0,validators:{required:"Permission Set is required"}})}),(0,a.jsxs)(t.A,{spacing:2,sx:{mt:2},children:[(0,a.jsx)(o.A,{children:(0,a.jsx)(d.A,{variant:"contained",color:"primary",onClick:i.handleSubmit(e=>{var l,a,p,t,s,n,r,o,d,m,u,c,y,A,f;let T,h,N,M;if("GalleryTemplate"===e.appType)T=(null===(p=e.galleryTemplateId)||void 0===p?void 0:null===(a=p.addedFields)||void 0===a?void 0:a.displayName)||(null===(t=e.galleryTemplateId)||void 0===t?void 0:t.label),h=null===(n=e.galleryTemplateId)||void 0===n?void 0:null===(s=n.addedFields)||void 0===s?void 0:s.applicationId,N=null===(r=e.galleryTemplateId)||void 0===r?void 0:r.value;else if("ApplicationManifest"===e.appType)try{if((M=JSON.parse(e.applicationManifest)).signInAudience&&"AzureADMyOrg"!==M.signInAudience)return;T=M.displayName||M.appDisplayName||"Custom Application",h=null}catch(e){console.error("Failed to parse application manifest:",e);return}else T=(null===(d=e.appId)||void 0===d?void 0:null===(o=d.addedFields)||void 0===o?void 0:o.displayName)||((null===(m=e.appId)||void 0===m?void 0:m.label)?e.appId.label.split(" (")[0]:void 0),h=null===(u=e.appId)||void 0===u?void 0:u.value;let b={TemplateName:e.templateName,AppType:e.appType,AppId:h,AppName:T};"EnterpriseApp"===e.appType&&(b.PermissionSetId=null===(c=e.permissionSetId)||void 0===c?void 0:c.value,b.PermissionSetName=null===(y=e.permissionSetId)||void 0===y?void 0:y.label,b.Permissions=null===(f=e.permissionSetId)||void 0===f?void 0:null===(A=f.addedFields)||void 0===A?void 0:A.Permissions),"GalleryTemplate"===e.appType&&(b.Permissions=null,b.GalleryTemplateId=N,b.GalleryInformation=(null==F?void 0:F.addedFields)||{}),"ApplicationManifest"===e.appType&&(b.Permissions=null,b.ApplicationManifest=M),I&&!g&&(null==v?void 0:null===(l=v[0])||void 0===l?void 0:l.TemplateId)&&(b.TemplateId=v[0].TemplateId);let j={templateName:e.templateName,appType:e.appType,appId:e.appId,galleryTemplateId:e.galleryTemplateId,permissionSetId:e.permissionSetId,applicationManifest:e.applicationManifest};x(b),I||setTimeout(()=>{i.setValue("templateName",j.templateName,{shouldDirty:!1}),i.setValue("appType",j.appType,{shouldDirty:!1}),i.setValue("appId",j.appId,{shouldDirty:!1}),i.setValue("galleryTemplateId",j.galleryTemplateId,{shouldDirty:!1}),i.setValue("permissionSetId",j.permissionSetId,{shouldDirty:!1}),i.setValue("applicationManifest",j.applicationManifest,{shouldDirty:!1})},100)}),disabled:h.isPending,children:I?"Update Template":"Create Template"})}),(0,a.jsx)(c.v,{apiObject:h})]})]})]})}),(0,a.jsx)(y.A,{size:{xs:12,sm:6},children:(0,a.jsx)(A.A,{permissions:"GalleryTemplate"===P||"ApplicationManifest"===P?null:null==M?void 0:null===(l=M.addedFields)||void 0===l?void 0:l.Permissions,isLoading:T,title:"GalleryTemplate"===P?"Gallery Template Info":"ApplicationManifest"===P?"Application Manifest":"Permission Preview",galleryTemplate:"GalleryTemplate"===P?F:null,applicationManifest:"ApplicationManifest"===P&&G?(()=>{try{return JSON.parse(G)}catch(e){return null}})():null})})]})}},36577:(e,l,i)=>{i.d(l,{A:()=>y});var a=i(37876),p=i(89099),t=i(67578),s=i(86650),n=i(22474),r=i(47737),o=i(94810),d=i(77018),m=i(54538),u=i(42120),c=i(2303);let y=e=>{let{title:l,backButtonTitle:i="Back",children:y,cardSize:A="xl",hideTitleText:f=!1,hideBackButton:v=!1,noTenantInHead:T=!1,infoBar:I}=e,g=(0,p.useRouter)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.v,{title:l,noTenant:T}),(0,a.jsx)(t.A,{sx:{flexGrow:1,py:4},children:(0,a.jsx)(s.A,{maxWidth:A,children:(0,a.jsxs)(n.A,{spacing:2,children:[(0,a.jsxs)(n.A,{spacing:2,children:[(0,a.jsx)("div",{children:!v&&(0,a.jsx)(r.A,{color:"inherit",onClick:()=>{g.back()},startIcon:(0,a.jsx)(o.A,{fontSize:"small",children:(0,a.jsx)(u.A,{})}),children:i})}),!0!==f&&(0,a.jsx)("div",{children:(0,a.jsx)(d.A,{variant:"h4",children:l})})]}),I,(0,a.jsx)(m.A,{children:y})]})})})]})}},42120:(e,l,i)=>{i.d(l,{A:()=>t});var a=i(93944),p=i(37876);let t=(0,a.A)((0,p.jsx)("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft")}}]);
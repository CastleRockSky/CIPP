"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1949],{4673:(e,i,s)=>{s.d(i,{A:()=>o});var n=s(93944),l=s(37876);let o=(0,n.A)((0,l.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22zm1 14h-2v2h2zm0-6h-2v4h2z"}),"WarningAmberOutlined")},4755:(e,i,s)=>{s.d(i,{A:()=>o});var n=s(93944),l=s(37876);let o=(0,n.A)((0,l.jsx)("path",{d:"M4 8h4V4H4zm6 12h4v-4h-4zm-6 0h4v-4H4zm0-6h4v-4H4zm6 0h4v-4h-4zm6-10v4h4V4zm-6 4h4V4h-4zm6 6h4v-4h-4zm0 6h4v-4h-4z"}),"Apps")},36577:(e,i,s)=>{s.d(i,{A:()=>v});var n=s(37876),l=s(89099),o=s(67578),r=s(86650),a=s(22474),t=s(47737),d=s(94810),c=s(77018),p=s(54538),u=s(42120),m=s(2303);let v=e=>{let{title:i,backButtonTitle:s="Back",children:v,cardSize:h="xl",hideTitleText:x=!1,hideBackButton:j=!1,noTenantInHead:A=!1,infoBar:f}=e,g=(0,l.useRouter)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.v,{title:i,noTenant:A}),(0,n.jsx)(o.A,{sx:{flexGrow:1,py:4},children:(0,n.jsx)(r.A,{maxWidth:h,children:(0,n.jsxs)(a.A,{spacing:2,children:[(0,n.jsxs)(a.A,{spacing:2,children:[(0,n.jsx)("div",{children:!j&&(0,n.jsx)(t.A,{color:"inherit",onClick:()=>{g.back()},startIcon:(0,n.jsx)(d.A,{fontSize:"small",children:(0,n.jsx)(u.A,{})}),children:s})}),!0!==x&&(0,n.jsx)("div",{children:(0,n.jsx)(c.A,{variant:"h4",children:i})})]}),f,(0,n.jsx)(p.A,{children:v})]})})})]})}},37242:(e,i,s)=>{s.d(i,{g:()=>u});var n=s(37876),l=s(95062),o=s.n(l),r=s(30236),a=s(14563),t=s(67578),d=s(24422),c=s(94810),p=s(77018);let u=e=>{let{accept:i,caption:s,maxFiles:l,maxSize:o,minSize:u,onDrop:m,sx:v}=e,{getRootProps:h,getInputProps:x,isDragActive:j}=(0,r.VB)({accept:i,maxFiles:l,maxSize:o,minSize:u,onDrop:m});return(0,n.jsxs)(t.A,{sx:{alignItems:"center",borderColor:e=>"dark"===e.palette.mode?"neutral.800":"neutral.200",borderRadius:1,borderStyle:"dashed",borderWidth:1,cursor:"pointer",display:"flex",flexDirection:"column",flexWrap:"wrap",justifyContent:"center",outline:"none",width:"100%",py:2,...j&&{borderColor:"primary.main",backgroundColor:"action.hover"},"&:hover":{borderColor:"primary.main",backgroundColor:"action.hover"},...v},...h(),children:[(0,n.jsx)(d.A,{sx:{backgroundColor:"neutral.200",color:"text.secondary",height:42,width:42},children:(0,n.jsx)(c.A,{fontSize:"small",children:(0,n.jsx)(a.A,{})})}),s&&(0,n.jsx)(p.A,{align:"center",color:"text.secondary",sx:{mt:1},variant:"caption",children:s}),(0,n.jsx)("input",{...x()})]})};u.propTypes={accept:o().objectOf(o().arrayOf(o().string)),caption:o().string,maxFiles:o().number,maxSize:o().number,minSize:o().number,onDrop:o().func,sx:o().object}},50945:(e,i,s)=>{s.d(i,{A:()=>o});var n=s(93944),l=s(37876);let o=(0,n.A)((0,l.jsx)("path",{d:"M5 20h14v-2H5zm0-10h4v6h6v-6h4l-7-7z"}),"Upload")},68978:(e,i,s)=>{s.d(i,{K:()=>o});var n=s(37876),l=s(67578);let o=e=>{let{children:i,value:s,index:o,...r}=e;return(0,n.jsx)("div",{role:"tabpanel",hidden:s!==o,id:"simple-tabpanel-".concat(o),"aria-labelledby":"simple-tab-".concat(o),...r,children:s===o&&(0,n.jsx)(l.A,{children:i})})}},94861:(e,i,s)=>{s.d(i,{A:()=>en});var n=s(37876),l=s(14232),o=s(77018),r=s(67578),a=s(8578),t=s(76626),d=s(22474),c=s(22430),p=s(47737),u=s(94810),m=s(46061),v=s(76776),h=s(70946),x=s(7881),j=s(88326),A=s(59017),f=s(37746),g=s(59568),P=s(22322),b=s(31540),y=s(44681),S=s(45936),C=s(81514),I=s(58105),z=s(60455),w=s(4673),k=s(409),R=s(79259),M=s(93944);let N=(0,M.A)((0,n.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo");var O=s(80580),F=s(50945),D=s(83198);let E=(0,M.A)((0,n.jsx)("path",{d:"M22 5.18 10.59 16.6l-4.24-4.24 1.41-1.41 2.83 2.83 10-10zm-2.21 5.04c.13.57.21 1.17.21 1.78 0 4.42-3.58 8-8 8s-8-3.58-8-8 3.58-8 8-8c1.58 0 3.04.46 4.28 1.25l1.44-1.44C16.1 2.67 14.13 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-1.19-.22-2.33-.6-3.39z"}),"TaskAlt");var J=s(87505),L=s(4755),U=s(88992),T=s(68978),q=s(68723),H=s(82851),W=s.n(H),V=s(24921),K=s(57016),_=s(37242),B=s(95062),G=s.n(B),Y=s(73880),Q=s(43532),$=s(5596),X=s(47866),Z=s(3034),ee=s(78523);let ei={error:(0,n.jsx)(u.A,{color:"error",fontSize:"large",children:(0,n.jsx)(Y.A,{})}),warning:(0,n.jsx)(u.A,{color:"warning",fontSize:"large",children:(0,n.jsx)(Q.A,{})}),info:(0,n.jsx)(u.A,{color:"info",fontSize:"large",children:(0,n.jsx)(Y.A,{})})},es=e=>{let{message:i="",onCancel:s,onConfirm:l,open:r=!1,title:a,variant:t="info",...c}=e,u=ei[t];return(0,n.jsxs)($.A,{maxWidth:"sm",fullWidth:!0,onClose:s,open:r,...c,children:[(0,n.jsx)(X.A,{children:(0,n.jsxs)(d.A,{alignItems:"center",direction:"row",spacing:2,children:[u,(0,n.jsx)(o.A,{variant:"inherit",children:a})]})}),(0,n.jsx)(Z.A,{children:(0,n.jsx)(o.A,{children:i})}),(0,n.jsxs)(ee.A,{children:[(0,n.jsx)(p.A,{color:"inherit",onClick:s,children:"Cancel"}),(0,n.jsx)(p.A,{onClick:l,variant:"contained",children:"Confirm"})]})]})};es.propTypes={message:G().string,onCancel:G().func,onConfirm:G().func,open:G().bool,title:G().string,variant:G().oneOf(["error","warning","info"])};let en=e=>{var i;let{onSubmit:s,updatePermissions:M,currentPermissions:H={},removePermissionConfirm:B=!1,appDisplayName:G="CIPP-SAM",formControl:Y}=e,[Q,$]=(0,l.useState)([]),[X,Z]=(0,l.useState)(!1),[ee,ei]=(0,l.useState)({}),[en,el]=(0,l.useState)(null),[eo,er]=(0,l.useState)(!1),[ea,et]=(0,l.useState)(!1),[ed,ec]=(0,l.useState)(null),[ep,eu]=(0,l.useState)(),[em,ev]=(0,l.useState)(!1),[eh,ex]=(0,l.useState)([]),[ej,eA]=(0,l.useState)(!1),[ef,eg]=(0,l.useState)(null),[eP,eb]=(0,l.useState)(!1),[ey,eS]=(0,l.useState)(!1),eC=e=>(i,s)=>{eS(!!s&&e)},eI=(0,U.FH)({control:Y.control,name:"servicePrincipal"}),ez=eI&&["00000002-0000-0000-c000-000000000000","a0c73c16-a7e3-4564-9a95-2bdf47383716","1b730954-1685-4b74-9bfd-dac224a7b894"].includes(eI.value),{data:ew=[],isSuccess:ek,isFetching:eR,isLoading:eM,refetch:eN}=(0,P.R_)({url:"/api/ExecServicePrincipals",queryKey:"execServicePrincipalList",waiting:!0}),eO=(0,l.useCallback)((e,i)=>{let s=Q.filter(i=>(null==i?void 0:i.appId)!==e);if(!i&&B){eg(e),eA(!0);return}$(e=>e.length!==s.length?s:e),ei(i=>{if(i.Permissions[e]){let s={...i,Permissions:{...i.Permissions}};return delete s.Permissions[e],s}return i})},[Q,ee,B,ej]),eF=(0,P.nN)({urlFromData:!0,relatedQueryKeys:["execServicePrincipals"]}),eD=e=>{!e&&B?eb(!0):($([]),Z(!1),er(!1),ec("Permissions reset to default."))},eE=(e,i,s)=>{ei(n=>({...n,Permissions:{...n.Permissions,[e]:{applicationPermissions:i,delegatedPermissions:s}}})),eS(!1)},eJ=e=>{let{appDisplayName:i="CIPP-SAM",prompt:s=!1}=e;if(s||""===i)ModalService.prompt({title:"Generate Manifest",body:"Please enter the display name for the application.",onConfirm:e=>{eJ({appDisplayName:e})}});else{var n={isFallbackPublicClient:!0,signInAudience:"AzureADMultipleOrgs",displayName:i,web:{redirectUris:["https://login.microsoftonline.com/common/oauth2/nativeclient","https://localhost","http://localhost","http://localhost:8400"]},requiredResourceAccess:[]},l=[];Q.map(e=>{var i,s,o=null==ee?void 0:null===(i=ee.Permissions[e.appId])||void 0===i?void 0:i.applicationPermissions,r=null==ee?void 0:null===(s=ee.Permissions[e.appId])||void 0===s?void 0:s.delegatedPermissions,a={resourceAppId:e.appId,resourceAccess:[]},t={resourceAppId:e.appId,resourceAccess:[]};o&&o.map(e=>{a.resourceAccess.push({id:e.id,type:"Role"})}),r&&r.map(e=>{/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.id)?a.resourceAccess.push({id:e.id,type:"Scope"}):t.resourceAccess.push({id:e.id,type:"Scope"})}),a.resourceAccess.length>0&&n.requiredResourceAccess.push(a),t.resourceAccess.length>0&&l.push(t)});var o="".concat(i.replace(" ","-"),".json");"CIPP-SAM"===i&&(o="SAMManifest.json");var r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=URL.createObjectURL(r),t=document.createElement("a");t.href=a,t.download="".concat(o),t.click(),URL.revokeObjectURL(a),l.length>0&&(ev(!0),ex(l))}},eL=()=>{var e={Permissions:{}},i=en.requiredResourceAccess,s=[];i.map(i=>{var n,l=null==ew?void 0:null===(n=ew.Results)||void 0===n?void 0:n.find(e=>e.appId===i.resourceAppId);if(l){var o=[],r=[];s.push(l),i.resourceAccess.map(e=>{if("Role"===e.type){var i=l.appRoles.find(i=>i.id===e.id);i&&o.push({id:i.id,value:i.value})}else if("Scope"===e.type){var s=l.publishedPermissionScopes.find(i=>i.id===e.id);s&&r.push({id:s.id,value:s.value})}}),e.Permissions[l.appId]={applicationPermissions:o,delegatedPermissions:r}}}),ei(e),$(s),el(null),Z(!0),er(!1),ec("Manifest imported successfully.")},eU=(0,l.useCallback)(e=>{e.forEach(e=>{let i=new FileReader;i.onabort=()=>console.log("file reading was aborted"),i.onerror=()=>console.log("file reading has failed"),i.onload=()=>{try{var e=JSON.parse(i.result)}catch(e){et(!0);return}var s=!0;["isFallbackPublicClient","signInAudience","displayName","web","requiredResourceAccess"].forEach(i=>{if(!Object.keys(e).includes(i)){s=!1;return}}),s?(el(e),et(!1)):(et(!0),el(!1))},i.readAsText(e)})},[]);(0,l.useEffect)(()=>{if(ek){try{var e,i,s=Object.keys(null==H?void 0:H.Permissions)}catch(e){s=[]}if(0===Q.length&&0===s.length){var n,l=null==ew?void 0:null===(n=ew.Results)||void 0===n?void 0:n.find(e=>(null==e?void 0:e.appId)==="00000003-0000-0000-c000-000000000000");l&&($([l]),ei({Permissions:{"00000003-0000-0000-c000-000000000000":{applicationPermissions:[],delegatedPermissions:[]}}}),eS("00000003-0000-0000-c000-000000000000"))}else if(W().isEqual(H,ep)){if(s.length>0&&!X){let n=null==ew?void 0:null===(i=ew.Results)||void 0===i?void 0:null===(e=i.filter(e=>s.includes(e.appId)))||void 0===e?void 0:e.sort((e,i)=>e.displayName.localeCompare(i.displayName));W().isEqual(Q,n)||$(n),ei(H),eu(H),Z(!0),1===n.length&&eS(n[0].appId)}}else $([]),ei(H),eu(H),Z(!1)}},[H,ep,X,Q,ew,ek]);let eT=e=>{var i,s,n,l,o=null==ee?void 0:null===(i=ee.Permissions[e])||void 0===i?void 0:i.applicationPermissions,r=null==ee?void 0:null===(s=ee.Permissions[e])||void 0===s?void 0:s.delegatedPermissions;return"".concat(null!==(n=null==o?void 0:o.length)&&void 0!==n?n:0,"/").concat(null!==(l=null==r?void 0:r.length)&&void 0!==l?l:0)},eq=e=>{var i,s,v,h,x;let{servicePrincipal:j=null,spPermissions:A,formControl:f}=e,[S,C]=(0,l.useState)(0),[R,M]=(0,l.useState)(!1),[N,O]=(0,l.useState)([]),[F,D]=(0,l.useState)([]),[E,J]=(0,l.useState)(!1),{data:L=[],isSuccess:q,isFetching:H}=(0,P.R_)({url:"/api/ExecServicePrincipals?Id=".concat(j.id),queryKey:"execServicePrincipals-".concat(j.id),waiting:!0}),W=(0,U.FH)({control:f.control,name:"Permissions.".concat(j.appId,".applicationPermissions")}),V=(0,U.FH)({control:f.control,name:"Permissions.".concat(j.appId,".delegatedPermissions")});(0,l.useEffect)(()=>{if(q&&!R){var e,i,s,n;void 0!==N&&(null==N?void 0:N.length)===0&&O(null==A?void 0:null===(i=A.applicationPermissions)||void 0===i?void 0:null===(e=i.sort((e,i)=>e.value.localeCompare(i.value)))||void 0===e?void 0:e.map(e=>{var i,s;return{id:e.id,value:e.value,description:null==L?void 0:null===(s=L.Results)||void 0===s?void 0:null===(i=s.appRoles.find(i=>i.id===e.id))||void 0===i?void 0:i.description}})),void 0!==F&&0===F.length&&D(null==A?void 0:null===(n=A.delegatedPermissions)||void 0===n?void 0:null===(s=n.sort((e,i)=>e.value.localeCompare(i.value)))||void 0===s?void 0:s.map(e=>{var i,s,n;return{id:e.id,value:e.value,description:null!==(n=null==L?void 0:null===(s=L.Results)||void 0===s?void 0:null===(i=s.publishedPermissionScopes.find(i=>i.id===e.id))||void 0===i?void 0:i.userConsentDescription)&&void 0!==n?n:"Manually added"}})),M(!0)}},[R,q,N,F]),(0,l.useEffect)(()=>{if(q&&void 0!==N&&void 0!==F){var e=null==N?void 0:N.map(e=>e.id).sort(),i=null==F?void 0:F.map(e=>e.id).sort(),s=null==A?void 0:A.applicationPermissions.map(e=>e.id).sort(),n=null==A?void 0:A.delegatedPermissions.map(e=>e.id).sort();JSON.stringify(e)!==JSON.stringify(s)||JSON.stringify(i)!==JSON.stringify(n)?J(!0):J(!1)}},[N,F,q,A]);let K=(e,i)=>{var s,n,l,o;"applicationPermissions"===e?(O([...null!=N?N:[],{id:i.value,value:i.label,description:null==L?void 0:null===(n=L.Results)||void 0===n?void 0:null===(s=n.appRoles.find(e=>e.id===i.value))||void 0===s?void 0:s.description}]),f.setValue("Permissions.".concat(j.appId,".applicationPermissions"),null)):(D([...null!=F?F:[],{id:i.value,value:i.label,description:null==L?void 0:null===(o=L.Results)||void 0===o?void 0:null===(l=o.publishedPermissionScopes.find(e=>e.id===i.value))||void 0===l?void 0:l.userConsentDescription}]),f.setValue("Permissions.".concat(j.appId,".delegatedPermissions"),null))},_=(e,i)=>{(null==i?void 0:i.id)&&("applicationPermissions"===e?O(e=>e.filter(e=>e.id!==i.id)):D(e=>e.filter(e=>e.id!==i.id)))};function B(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.A,{variant:"body2",color:"textSecondary",sx:{mb:3},children:["Manage the permissions for the ",j.displayName,"."]}),(0,n.jsxs)(r.A,{sx:{width:"100%"},children:[(0,n.jsx)(r.A,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:(0,n.jsxs)(a.A,{value:S,onChange:(e,i)=>{C(i)},"aria-label":"Permissions for ".concat(j.displayName),children:[(0,n.jsx)(t.A,{label:"Application",...B(0)}),(0,n.jsx)(t.A,{label:"Delegated",...B(1)})]})}),(0,n.jsx)(T.K,{value:S,index:0,children:(null==j?void 0:null===(i=j.appRoles)||void 0===i?void 0:i.length)>0?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(d.A,{spacing:2,children:[(0,n.jsxs)(g.A,{container:!0,sx:{display:"flex",alignItems:"center"},spacing:2,children:[(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsx)(I.A,{type:"autoComplete",label:"Application Permissions",name:"Permissions.".concat(j.appId,".applicationPermissions"),isFetching:H,options:((null==L?void 0:null===(s=L.Results)||void 0===s?void 0:s.appRoles)||[]).filter(e=>!(null==N?void 0:N.find(i=>i.id===e.id))).map(e=>({label:e.value,value:e.id})),formControl:f,multiple:!1})}),(0,n.jsx)(g.A,{children:(0,n.jsx)(c.A,{title:"Add Permission",children:(0,n.jsx)("div",{onClick:()=>K("applicationPermissions",W),children:(0,n.jsx)(p.A,{variant:"outlined",disabled:!W,children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(y.A,{})})})})})})]}),(0,n.jsx)(b.x,{title:"".concat(j.displayName," Application Permissions"),noCard:!0,data:null!=N?N:[],simpleColumns:["value","description"],actions:[{label:"Delete Permission",icon:(0,n.jsx)(z.A,{}),noConfirm:!0,customFunction:e=>_("applicationPermissions",e)}],isFetching:H})]})}):(0,n.jsx)(m.A,{color:"warning",icon:(0,n.jsx)(w.A,{}),sx:{mb:3},children:"No Application Permissions found."})}),(0,n.jsx)(T.K,{value:S,index:1,children:(0,n.jsxs)(d.A,{spacing:2,children:[(null==L?void 0:null===(h=L.Results)||void 0===h?void 0:null===(v=h.publishedPermissionScopes)||void 0===v?void 0:v.length)===0&&(0,n.jsx)(m.A,{color:"warning",icon:(0,n.jsx)(w.A,{}),children:"No Published Delegated Permissions found."}),(0,n.jsxs)(g.A,{container:!0,sx:{display:"flex",alignItems:"center"},spacing:2,children:[(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsx)(I.A,{type:"autoComplete",label:"Delegated Permissions",name:"Permissions.".concat(j.appId,".delegatedPermissions"),isFetching:H,options:((null==L?void 0:null===(x=L.Results)||void 0===x?void 0:x.publishedPermissionScopes)||[]).filter(e=>!(null==F?void 0:F.find(i=>i.id===e.id))).map(e=>({label:e.value,value:e.id})),formControl:f,multiple:!1})}),(0,n.jsx)(g.A,{sx:{ms:2},children:(0,n.jsx)(c.A,{title:"Add Permission",children:(0,n.jsx)("div",{onClick:()=>K("delegatedPermissions",V),children:(0,n.jsx)(p.A,{variant:"outlined",disabled:!V,children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(y.A,{})})})})})})]}),(0,n.jsx)(b.x,{noCard:!0,sx:{width:"100%"},title:"".concat(j.displayName," Delegated Permissions"),data:null!=F?F:[],simpleColumns:["value","description"],actions:[{label:"Delete Permission",icon:(0,n.jsx)(z.A,{}),noConfirm:!0,customFunction:e=>_("delegatedPermissions",e)}],isFetching:H})]})}),(0,n.jsx)(p.A,{variant:"contained",startIcon:(0,n.jsx)(k.A,{}),onClick:()=>{var e,i;eE(j.appId,null!==(e=null==N?void 0:N.map(e=>({id:e.id,value:e.value})))&&void 0!==e?e:[],null!==(i=null==F?void 0:F.map(e=>({id:e.id,value:e.value})))&&void 0!==i?i:[])},disabled:!E,children:"Save Changes"})]})]})};return(0,n.jsxs)(n.Fragment,{children:[eM&&(0,n.jsx)(v.A,{variant:"rectangle",height:300}),ek&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.A,{container:!0,children:[(0,n.jsxs)(g.A,{size:{xl:12,md:12},sx:{mb:3},children:[(0,n.jsxs)(g.A,{container:!0,spacing:2,sx:{display:"flex",alignItems:"center"},justifyContent:"space-between",children:[(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsxs)(d.A,{direction:"row",spacing:1,children:[(null==ew?void 0:null===(i=ew.Metadata)||void 0===i?void 0:i.Success)&&(0,n.jsx)(r.A,{width:"100%",children:(0,n.jsx)(I.A,{type:"autoComplete",fullWidth:!0,label:"Add a Service Principal (optional)",placeholder:"Select a Service Principal or enter an AppId if not listed",name:"servicePrincipal",createOption:!0,onCreateOption:e=>{e.value&&eF.mutate({url:"/api/ExecServicePrincipals?Action=Create&AppId="+e.value,data:{}})},isFetching:eR,options:null==ew?void 0:ew.Results.map(e=>({label:"".concat(e.displayName," (").concat(e.appId,")"),value:e.appId})),formControl:Y,multiple:!1})}),(0,n.jsx)(h.A,{onClick:()=>eN(),disabled:ew.isFetching,children:(0,n.jsx)(R.A,{})})]})}),(0,n.jsx)(g.A,{children:(0,n.jsxs)(d.A,{direction:"row",spacing:1,children:[(0,n.jsx)(c.A,{title:ez?"This service principal is deprecated and cannot be added":"Add Service Principal",children:(0,n.jsx)("div",{onClick:e=>{if(!ez){var i;$([...Q,null==ew?void 0:null===(i=ew.Results)||void 0===i?void 0:i.find(e=>e.appId===eI.value)]),Y.setValue("servicePrincipal",null)}},children:(0,n.jsx)(p.A,{variant:"contained",component:(null==eI?void 0:eI.value)?void 0:"span",disabled:!(null==eI?void 0:eI.value)||ez,children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(y.A,{})})})})}),(0,n.jsx)(c.A,{title:"Reset to Default",children:(0,n.jsx)(p.A,{onClick:()=>{eD()},variant:"outlined",children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(N,{})})})}),(0,n.jsx)(c.A,{title:"Download Manifest",children:(0,n.jsx)(p.A,{variant:"outlined",onClick:()=>{eJ({appDisplayName:G})},children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(O.A,{})})})}),(0,n.jsx)(c.A,{title:"Import Manifest",children:(0,n.jsx)(p.A,{variant:"outlined",onClick:()=>{er(!0)},children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(F.A,{})})})})]})})]}),(0,n.jsx)(g.A,{size:12,sx:{mt:eF.isSuccess||eF.isPending?3:0},children:(0,n.jsx)(q.v,{apiObject:eF})}),(0,n.jsxs)(K.w,{visible:eo,size:"lg",onClose:()=>{er(!1)},children:[(0,n.jsx)(g.A,{container:!0,children:(0,n.jsxs)(g.A,{size:12,children:[(0,n.jsx)(o.A,{variant:"h4",sx:{mb:2},children:"Import Permission Manifest"}),(0,n.jsx)(o.A,{variant:"body2",sx:{mb:3},children:"Import a JSON application manifest to set permissions. This will overwrite any existing permissions. You can obtain one from an App Registration in the Entra portal. Just click on Manifest and download the JSON file."})]})}),(0,n.jsx)(g.A,{container:!0,children:(0,n.jsx)(g.A,{size:12,children:(0,n.jsx)(_.g,{onDrop:eU,accept:{"application/json":[".json"]},caption:"Drag a JSON app manifest here, or click to select one.",maxFiles:1,returnCard:!1})})}),ea&&(0,n.jsx)(m.A,{color:"error",icon:(0,n.jsx)(D.A,{}),sx:{mt:4},children:"Invalid manifest. Please ensure the manifest is in the correct format."}),en&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.A,{container:!0,sx:{mt:2},spacing:2,children:[(0,n.jsx)(g.A,{size:12,children:(0,n.jsx)(m.A,{color:"success",icon:(0,n.jsx)(E,{}),children:"Manifest is valid. Click Import to apply the permissions."})}),(0,n.jsx)(g.A,{size:12,children:(0,n.jsx)(p.A,{variant:"contained",onClick:()=>eL(),startIcon:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(k.A,{})}),children:"Import"})})]}),(0,n.jsx)(g.A,{container:!0,className:"mt-3",children:(0,n.jsxs)(g.A,{size:12,children:[(0,n.jsx)("h4",{children:"Preview"}),(0,n.jsx)(V.x,{code:JSON.stringify(en,null,2),language:"json",showLineNumbers:!1})]})})]})]}),ed&&(0,n.jsx)(g.A,{container:!0,children:(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsx)(m.A,{variant:"outlined",color:"info",onClose:()=>ec(null),children:ed})})}),ez&&(0,n.jsx)(g.A,{container:!0,children:(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsxs)(m.A,{color:"error",icon:(0,n.jsx)(w.A,{}),children:[eI.label," is deprecated and cannot be added. Please select a different service principal."]})})}),(null==ee?void 0:ee.MissingPermissions)&&(null==ee?void 0:ee.Type)==="Table"&&Object.keys(null==ee?void 0:ee.MissingPermissions).length>0&&(0,n.jsx)(g.A,{container:!0,sx:{width:"100%",mt:3},children:(0,n.jsx)(g.A,{size:{xl:8,xs:12},children:(0,n.jsxs)(m.A,{color:"warning",icon:(0,n.jsx)(w.A,{}),action:(0,n.jsx)(c.A,{title:"Add Missing Permissions",children:(0,n.jsx)(h.A,{onClick:()=>{var e=JSON.parse(JSON.stringify(ee));Object.keys(null==ee?void 0:ee.MissingPermissions).map(i=>{Object.keys(null==ee?void 0:ee.MissingPermissions[i]).map(s=>{e.Permissions[i][s]||(e.Permissions[i][s]=[]),null==ee||ee.MissingPermissions[i][s].map(n=>{e.Permissions[i][s].push(n)})})}),e.MissingPermissions={},ei(e)},children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(S.A,{})})})}),children:[(0,n.jsx)("b",{children:"New Permissions Available"}),Object.keys(null==ee?void 0:ee.MissingPermissions).map(e=>{var i,s=null==ew?void 0:null===(i=ew.Results)||void 0===i?void 0:i.find(i=>i.appId===e);return(0,n.jsxs)(o.A,{variant:"body2",textColor:"secondary",children:[null==s?void 0:s.displayName,":"," ",Object.keys(null==ee?void 0:ee.MissingPermissions[e]).map(i=>(0,n.jsx)(n.Fragment,{children:(null==ee?void 0:ee.MissingPermissions[e][i].length)>0&&(0,n.jsxs)(l.Fragment,{children:["applicationPermissions"==i?"Application":"Delegated"," ","-"," ",null==ee?void 0:ee.MissingPermissions[e][i].map(e=>e.value).join(", ")]},"missing-".concat(e,"-").concat(i))}))]},"missing-".concat(e))})]})})}),(0,n.jsx)(r.A,{sx:{mt:3},children:Q&&(null==Q?void 0:Q.length)>0&&(null==Q?void 0:Q.map((e,i)=>{var s;return(0,n.jsxs)(x.A,{expanded:ey===e.appId,variant:"outlined",onChange:eC(e.appId),slotProps:{transition:{unmountOnExit:!0}},children:[(0,n.jsx)(j.A,{expandIcon:(0,n.jsx)(J.A,{}),children:(0,n.jsxs)(d.A,{direction:"row",spacing:2,justifyContent:"space-between",alignItems:"center",sx:{width:"100%",mr:1},children:[(0,n.jsx)(o.A,{variant:"h6",children:e.displayName}),(0,n.jsxs)(d.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,n.jsx)(c.A,{title:"Copy Application ID to clipboard",children:(0,n.jsx)(A.A,{label:e.appId,variant:"outlined",size:"small",color:"info",sx:{mr:"0.25rem",fontFamily:"monospace"},icon:(0,n.jsx)(u.A,{children:(0,n.jsx)(L.A,{})}),onClick:i=>{i.stopPropagation(),navigator.clipboard.writeText(e.appId)}})}),(0,n.jsx)(c.A,{title:"Application/Delegated",children:(0,n.jsx)(A.A,{color:"info",variant:"outlined",size:"small",label:eT(e.appId),sx:{width:"100px"},icon:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(C.A,{})})})}),(0,n.jsx)(c.A,{title:"00000003-0000-0000-c000-000000000000"===e.appId?"You can't remove Microsoft Graph":"Remove ".concat(e.displayName),children:(0,n.jsx)("div",{onClick:i=>{i.stopPropagation(),eO(e.appId)},children:(0,n.jsx)(h.A,{disabled:"00000003-0000-0000-c000-000000000000"===e.appId,color:"error",children:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(z.A,{})})})})})]})]})}),(0,n.jsx)(f.A,{children:(0,n.jsx)(eq,{servicePrincipal:e,spPermissions:null==ee?void 0:null===(s=ee.Permissions)||void 0===s?void 0:s[e.appId],formControl:Y},"apirow-".concat(i))})]},"accordion-item-".concat(i,"-").concat(null==e?void 0:e.appId))}))})]}),(0,n.jsx)(g.A,{size:{xl:12,xs:12},children:(0,n.jsx)(q.v,{apiObject:M})})]}),(0,n.jsx)(g.A,{container:!0,sx:{display:"flex",alignItems:"center"},children:(0,n.jsx)(g.A,{size:{xl:1,xs:12},children:(0,n.jsx)(p.A,{variant:"contained",startIcon:(0,n.jsx)(u.A,{fontSize:"small",children:(0,n.jsx)(k.A,{})}),type:"submit",disabled:M.isPending,onClick:e=>{s&&s({Permissions:ee.Permissions})},children:"Save"})})})]}),(0,n.jsx)(es,{open:ej,title:"Remove Service Principal",message:"Are you sure you want to remove this service principal?",onConfirm:()=>{eO(ef,!0),eA(!1)},onCancel:()=>{eA(!1)}}),(0,n.jsx)(es,{open:eP,title:"Reset Permissions",message:"Are you sure you want to reset the permissions?",onConfirm:()=>{eD(!0),eb(!1)},onCancel:()=>{eb(!1)}}),(0,n.jsx)(es,{open:em,title:"Additional Permissions",message:"Some permissions are not supported in the manifest. Would you like to download them?",onConfirm:()=>{var e=new Blob([JSON.stringify(eh,null,2)],{type:"application/json"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download="AdditionalPermissions.json",s.click(),URL.revokeObjectURL(i),ev(!1)},onCancel:()=>{ev(!1)}})]})}}}]);